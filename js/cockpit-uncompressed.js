<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  

  <head>
    <title>
      /seattle/trunk/repy/apps/tryrepy/web/js/ace/cockpit-uncompressed.js – Seattle
    </title>
        <link rel="search" href="/search" />
        <link rel="help" href="/wiki/TracGuide" />
        <link rel="alternate" href="/browser/seattle/trunk/repy/apps/tryrepy/web/js/ace/cockpit-uncompressed.js?format=txt" type="text/plain" title="Plain Text" /><link rel="alternate" href="/export/7591/seattle/trunk/repy/apps/tryrepy/web/js/ace/cockpit-uncompressed.js" type="application/javascript; charset=iso-8859-15" title="Original Format" />
        <link rel="up" href="/browser/seattle/trunk/repy/apps/tryrepy/web/js/ace" title="Parent directory" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/chrome/common/css/code.css" type="text/css" /><link rel="stylesheet" href="/chrome/common/css/browser.css" type="text/css" /><link rel="stylesheet" href="/chrome/theme/pydotorg.css" type="text/css" /><link rel="stylesheet" href="/themeengine/theme.css" type="text/css" />
        <link rel="shortcut icon" href="/chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="/chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Search Seattle" />
    <script type="text/javascript" src="/chrome/common/js/jquery.js"></script><script type="text/javascript" src="/chrome/common/js/trac.js"></script><script type="text/javascript" src="/chrome/common/js/search.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $(".trac-toggledeleted").show().click(function() {
                  $(this).siblings().find(".trac-deleted").toggle();
                  return false;
        }).click();
        $("#jumploc input").hide();
        $("#jumploc select").change(function () {
          this.parentNode.parentNode.submit();
        });
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="/"><img src="/chrome/site/seattle.png" alt="Seattle" height="70" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Login</a></li><li class="last"><a href="/prefs">Preferences</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="/wiki">Home</a></li><li><a href="/wiki/ProgrammersPage">Programmer Portal</a></li><li><a href="/wiki/EducatorsPage">Educator Portal</a></li><li><a href="/wiki/ContributorsPage">Contributor Portal</a></li><li><a href="/timeline">Timeline</a></li><li><a href="/roadmap">Roadmap</a></li><li class="active"><a href="/browser">Browse Source</a></li><li><a href="/report">View Tickets</a></li><li class="last"><a href="/blog">Blog</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><a href="/changeset/4865/seattle/trunk/repy/apps/tryrepy/web/js/ace/cockpit-uncompressed.js">Last Change</a></li><li><a href="/browser/seattle/trunk/repy/apps/tryrepy/web/js/ace/cockpit-uncompressed.js?annotate=blame&amp;rev=4865" title="Annotate each line with the last changed revision (this can be time consuming...)">Annotate</a></li><li class="last"><a href="/log/seattle/trunk/repy/apps/tryrepy/web/js/ace/cockpit-uncompressed.js">Revision Log</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="browser">
      <h1>
        <p><font size="3" color="red"><b>Please note that the CVS and issue trackers have moved to <a href="https://github.com/SeattleTestbed">GitHub</a>. These Trac pages are no longer kept up-to-date.</b></font></p>
        <a class="pathentry first" title="Go to root directory" href="/browser">root</a><span class="pathentry sep">/</span><a class="pathentry" title="View seattle" href="/browser/seattle">seattle</a><span class="pathentry sep">/</span><a class="pathentry" title="View trunk" href="/browser/seattle/trunk">trunk</a><span class="pathentry sep">/</span><a class="pathentry" title="View repy" href="/browser/seattle/trunk/repy">repy</a><span class="pathentry sep">/</span><a class="pathentry" title="View apps" href="/browser/seattle/trunk/repy/apps">apps</a><span class="pathentry sep">/</span><a class="pathentry" title="View tryrepy" href="/browser/seattle/trunk/repy/apps/tryrepy">tryrepy</a><span class="pathentry sep">/</span><a class="pathentry" title="View web" href="/browser/seattle/trunk/repy/apps/tryrepy/web">web</a><span class="pathentry sep">/</span><a class="pathentry" title="View js" href="/browser/seattle/trunk/repy/apps/tryrepy/web/js">js</a><span class="pathentry sep">/</span><a class="pathentry" title="View ace" href="/browser/seattle/trunk/repy/apps/tryrepy/web/js/ace">ace</a><span class="pathentry sep">/</span><a class="pathentry" title="View cockpit-uncompressed.js" href="/browser/seattle/trunk/repy/apps/tryrepy/web/js/ace/cockpit-uncompressed.js">cockpit-uncompressed.js</a><br style="clear: both" />
        </h1>
      <div id="jumprev">
        <form action="" method="get">
          <div>
            <label for="rev">
              View revision:</label>
            <input type="text" id="rev" name="rev" size="6" />
          </div>
        </form>
      </div>
      <table id="info" summary="Revision info">
        <tr>
          <th scope="col">
            Revision <a href="/changeset/4865">4865</a>, <span title="113605 bytes">110.9 KB</span>
            (checked in by albert, <a class="timeline" href="/timeline?from=2011-10-24T06%3A41%3A12-0700&amp;precision=second" title="2011-10-24T06:41:12-0700 in Timeline">6 years</a> ago)
          </th>
        </tr>
        <tr>
          <td class="message searchable">
              <p>
First commit of Lukas Puehringer's 'Try Repy' web-based IDE<br />
</p>
          </td>
        </tr>
      </table>
      <div id="preview" class="searchable">
    <table class="code"><thead><tr><th class="lineno" title="Line numbers">Line</th><th class="content"> </th></tr></thead><tbody><tr><th id="L1"><a href="#L1">1</a></th><td>/* ***** BEGIN LICENSE BLOCK *****</td></tr><tr><th id="L2"><a href="#L2">2</a></th><td> * Version: MPL 1.1/GPL 2.0/LGPL 2.1</td></tr><tr><th id="L3"><a href="#L3">3</a></th><td> *</td></tr><tr><th id="L4"><a href="#L4">4</a></th><td> * The contents of this file are subject to the Mozilla Public License Version</td></tr><tr><th id="L5"><a href="#L5">5</a></th><td> * 1.1 (the "License"); you may not use this file except in compliance with</td></tr><tr><th id="L6"><a href="#L6">6</a></th><td> * the License. You may obtain a copy of the License at</td></tr><tr><th id="L7"><a href="#L7">7</a></th><td> * http://www.mozilla.org/MPL/</td></tr><tr><th id="L8"><a href="#L8">8</a></th><td> *</td></tr><tr><th id="L9"><a href="#L9">9</a></th><td> * Software distributed under the License is distributed on an "AS IS" basis,</td></tr><tr><th id="L10"><a href="#L10">10</a></th><td> * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</td></tr><tr><th id="L11"><a href="#L11">11</a></th><td> * for the specific language governing rights and limitations under the</td></tr><tr><th id="L12"><a href="#L12">12</a></th><td> * License.</td></tr><tr><th id="L13"><a href="#L13">13</a></th><td> *</td></tr><tr><th id="L14"><a href="#L14">14</a></th><td> * The Original Code is Mozilla Skywriter.</td></tr><tr><th id="L15"><a href="#L15">15</a></th><td> *</td></tr><tr><th id="L16"><a href="#L16">16</a></th><td> * The Initial Developer of the Original Code is</td></tr><tr><th id="L17"><a href="#L17">17</a></th><td> * Mozilla.</td></tr><tr><th id="L18"><a href="#L18">18</a></th><td> * Portions created by the Initial Developer are Copyright (C) 2009</td></tr><tr><th id="L19"><a href="#L19">19</a></th><td> * the Initial Developer. All Rights Reserved.</td></tr><tr><th id="L20"><a href="#L20">20</a></th><td> *</td></tr><tr><th id="L21"><a href="#L21">21</a></th><td> * Contributor(s):</td></tr><tr><th id="L22"><a href="#L22">22</a></th><td> *      Kevin Dangoor (kdangoor@mozilla.com)</td></tr><tr><th id="L23"><a href="#L23">23</a></th><td> *</td></tr><tr><th id="L24"><a href="#L24">24</a></th><td> * Alternatively, the contents of this file may be used under the terms of</td></tr><tr><th id="L25"><a href="#L25">25</a></th><td> * either the GNU General Public License Version 2 or later (the "GPL"), or</td></tr><tr><th id="L26"><a href="#L26">26</a></th><td> * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),</td></tr><tr><th id="L27"><a href="#L27">27</a></th><td> * in which case the provisions of the GPL or the LGPL are applicable instead</td></tr><tr><th id="L28"><a href="#L28">28</a></th><td> * of those above. If you wish to allow use of your version of this file only</td></tr><tr><th id="L29"><a href="#L29">29</a></th><td> * under the terms of either the GPL or the LGPL, and not to allow others to</td></tr><tr><th id="L30"><a href="#L30">30</a></th><td> * use your version of this file under the terms of the MPL, indicate your</td></tr><tr><th id="L31"><a href="#L31">31</a></th><td> * decision by deleting the provisions above and replace them with the notice</td></tr><tr><th id="L32"><a href="#L32">32</a></th><td> * and other provisions required by the GPL or the LGPL. If you do not delete</td></tr><tr><th id="L33"><a href="#L33">33</a></th><td> * the provisions above, a recipient may use your version of this file under</td></tr><tr><th id="L34"><a href="#L34">34</a></th><td> * the terms of any one of the MPL, the GPL or the LGPL.</td></tr><tr><th id="L35"><a href="#L35">35</a></th><td> *</td></tr><tr><th id="L36"><a href="#L36">36</a></th><td> * ***** END LICENSE BLOCK ***** */</td></tr><tr><th id="L37"><a href="#L37">37</a></th><td></td></tr><tr><th id="L38"><a href="#L38">38</a></th><td>define('cockpit/index', ['require', 'exports', 'module' , 'pilot/index', 'cockpit/cli', 'cockpit/ui/settings', 'cockpit/ui/cli_view', 'cockpit/commands/basic'], function(require, exports, module) {</td></tr><tr><th id="L39"><a href="#L39">39</a></th><td></td></tr><tr><th id="L40"><a href="#L40">40</a></th><td></td></tr><tr><th id="L41"><a href="#L41">41</a></th><td>exports.startup = function(data, reason) {</td></tr><tr><th id="L42"><a href="#L42">42</a></th><td>  require('pilot/index');</td></tr><tr><th id="L43"><a href="#L43">43</a></th><td>  require('cockpit/cli').startup(data, reason);</td></tr><tr><th id="L44"><a href="#L44">44</a></th><td>  // window.testCli = require('cockpit/test/testCli');</td></tr><tr><th id="L45"><a href="#L45">45</a></th><td></td></tr><tr><th id="L46"><a href="#L46">46</a></th><td>  require('cockpit/ui/settings').startup(data, reason);</td></tr><tr><th id="L47"><a href="#L47">47</a></th><td>  require('cockpit/ui/cli_view').startup(data, reason);</td></tr><tr><th id="L48"><a href="#L48">48</a></th><td>  require('cockpit/commands/basic').startup(data, reason);</td></tr><tr><th id="L49"><a href="#L49">49</a></th><td>};</td></tr><tr><th id="L50"><a href="#L50">50</a></th><td></td></tr><tr><th id="L51"><a href="#L51">51</a></th><td>/*</td></tr><tr><th id="L52"><a href="#L52">52</a></th><td>exports.shutdown(data, reason) {</td></tr><tr><th id="L53"><a href="#L53">53</a></th><td>};</td></tr><tr><th id="L54"><a href="#L54">54</a></th><td>*/</td></tr><tr><th id="L55"><a href="#L55">55</a></th><td></td></tr><tr><th id="L56"><a href="#L56">56</a></th><td></td></tr><tr><th id="L57"><a href="#L57">57</a></th><td>});</td></tr><tr><th id="L58"><a href="#L58">58</a></th><td>/* ***** BEGIN LICENSE BLOCK *****</td></tr><tr><th id="L59"><a href="#L59">59</a></th><td> * Version: MPL 1.1/GPL 2.0/LGPL 2.1</td></tr><tr><th id="L60"><a href="#L60">60</a></th><td> *</td></tr><tr><th id="L61"><a href="#L61">61</a></th><td> * The contents of this file are subject to the Mozilla Public License Version</td></tr><tr><th id="L62"><a href="#L62">62</a></th><td> * 1.1 (the "License"); you may not use this file except in compliance with</td></tr><tr><th id="L63"><a href="#L63">63</a></th><td> * the License. You may obtain a copy of the License at</td></tr><tr><th id="L64"><a href="#L64">64</a></th><td> * http://www.mozilla.org/MPL/</td></tr><tr><th id="L65"><a href="#L65">65</a></th><td> *</td></tr><tr><th id="L66"><a href="#L66">66</a></th><td> * Software distributed under the License is distributed on an "AS IS" basis,</td></tr><tr><th id="L67"><a href="#L67">67</a></th><td> * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</td></tr><tr><th id="L68"><a href="#L68">68</a></th><td> * for the specific language governing rights and limitations under the</td></tr><tr><th id="L69"><a href="#L69">69</a></th><td> * License.</td></tr><tr><th id="L70"><a href="#L70">70</a></th><td> *</td></tr><tr><th id="L71"><a href="#L71">71</a></th><td> * The Original Code is Skywriter.</td></tr><tr><th id="L72"><a href="#L72">72</a></th><td> *</td></tr><tr><th id="L73"><a href="#L73">73</a></th><td> * The Initial Developer of the Original Code is</td></tr><tr><th id="L74"><a href="#L74">74</a></th><td> * Mozilla.</td></tr><tr><th id="L75"><a href="#L75">75</a></th><td> * Portions created by the Initial Developer are Copyright (C) 2009</td></tr><tr><th id="L76"><a href="#L76">76</a></th><td> * the Initial Developer. All Rights Reserved.</td></tr><tr><th id="L77"><a href="#L77">77</a></th><td> *</td></tr><tr><th id="L78"><a href="#L78">78</a></th><td> * Contributor(s):</td></tr><tr><th id="L79"><a href="#L79">79</a></th><td> *   Joe Walker (jwalker@mozilla.com)</td></tr><tr><th id="L80"><a href="#L80">80</a></th><td> *</td></tr><tr><th id="L81"><a href="#L81">81</a></th><td> * Alternatively, the contents of this file may be used under the terms of</td></tr><tr><th id="L82"><a href="#L82">82</a></th><td> * either the GNU General Public License Version 2 or later (the "GPL"), or</td></tr><tr><th id="L83"><a href="#L83">83</a></th><td> * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),</td></tr><tr><th id="L84"><a href="#L84">84</a></th><td> * in which case the provisions of the GPL or the LGPL are applicable instead</td></tr><tr><th id="L85"><a href="#L85">85</a></th><td> * of those above. If you wish to allow use of your version of this file only</td></tr><tr><th id="L86"><a href="#L86">86</a></th><td> * under the terms of either the GPL or the LGPL, and not to allow others to</td></tr><tr><th id="L87"><a href="#L87">87</a></th><td> * use your version of this file under the terms of the MPL, indicate your</td></tr><tr><th id="L88"><a href="#L88">88</a></th><td> * decision by deleting the provisions above and replace them with the notice</td></tr><tr><th id="L89"><a href="#L89">89</a></th><td> * and other provisions required by the GPL or the LGPL. If you do not delete</td></tr><tr><th id="L90"><a href="#L90">90</a></th><td> * the provisions above, a recipient may use your version of this file under</td></tr><tr><th id="L91"><a href="#L91">91</a></th><td> * the terms of any one of the MPL, the GPL or the LGPL.</td></tr><tr><th id="L92"><a href="#L92">92</a></th><td> *</td></tr><tr><th id="L93"><a href="#L93">93</a></th><td> * ***** END LICENSE BLOCK ***** */</td></tr><tr><th id="L94"><a href="#L94">94</a></th><td></td></tr><tr><th id="L95"><a href="#L95">95</a></th><td>define('cockpit/cli', ['require', 'exports', 'module' , 'pilot/console', 'pilot/lang', 'pilot/oop', 'pilot/event_emitter', 'pilot/types', 'pilot/canon'], function(require, exports, module) {</td></tr><tr><th id="L96"><a href="#L96">96</a></th><td></td></tr><tr><th id="L97"><a href="#L97">97</a></th><td></td></tr><tr><th id="L98"><a href="#L98">98</a></th><td>var console = require('pilot/console');</td></tr><tr><th id="L99"><a href="#L99">99</a></th><td>var lang = require('pilot/lang');</td></tr><tr><th id="L100"><a href="#L100">100</a></th><td>var oop = require('pilot/oop');</td></tr><tr><th id="L101"><a href="#L101">101</a></th><td>var EventEmitter = require('pilot/event_emitter').EventEmitter;</td></tr><tr><th id="L102"><a href="#L102">102</a></th><td></td></tr><tr><th id="L103"><a href="#L103">103</a></th><td>//var keyboard = require('keyboard/keyboard');</td></tr><tr><th id="L104"><a href="#L104">104</a></th><td>var types = require('pilot/types');</td></tr><tr><th id="L105"><a href="#L105">105</a></th><td>var Status = require('pilot/types').Status;</td></tr><tr><th id="L106"><a href="#L106">106</a></th><td>var Conversion = require('pilot/types').Conversion;</td></tr><tr><th id="L107"><a href="#L107">107</a></th><td>var canon = require('pilot/canon');</td></tr><tr><th id="L108"><a href="#L108">108</a></th><td></td></tr><tr><th id="L109"><a href="#L109">109</a></th><td>/**</td></tr><tr><th id="L110"><a href="#L110">110</a></th><td> * Normally type upgrade is done when the owning command is registered, but</td></tr><tr><th id="L111"><a href="#L111">111</a></th><td> * out commandParam isn't part of a command, so it misses out.</td></tr><tr><th id="L112"><a href="#L112">112</a></th><td> */</td></tr><tr><th id="L113"><a href="#L113">113</a></th><td>exports.startup = function(data, reason) {</td></tr><tr><th id="L114"><a href="#L114">114</a></th><td>    canon.upgradeType('command', commandParam);</td></tr><tr><th id="L115"><a href="#L115">115</a></th><td>};</td></tr><tr><th id="L116"><a href="#L116">116</a></th><td></td></tr><tr><th id="L117"><a href="#L117">117</a></th><td>/**</td></tr><tr><th id="L118"><a href="#L118">118</a></th><td> * The information required to tell the user there is a problem with their</td></tr><tr><th id="L119"><a href="#L119">119</a></th><td> * input.</td></tr><tr><th id="L120"><a href="#L120">120</a></th><td> * TODO: There a several places where {start,end} crop up. Perhaps we should</td></tr><tr><th id="L121"><a href="#L121">121</a></th><td> * have a Cursor object.</td></tr><tr><th id="L122"><a href="#L122">122</a></th><td> */</td></tr><tr><th id="L123"><a href="#L123">123</a></th><td>function Hint(status, message, start, end, predictions) {</td></tr><tr><th id="L124"><a href="#L124">124</a></th><td>    this.status = status;</td></tr><tr><th id="L125"><a href="#L125">125</a></th><td>    this.message = message;</td></tr><tr><th id="L126"><a href="#L126">126</a></th><td></td></tr><tr><th id="L127"><a href="#L127">127</a></th><td>    if (typeof start === 'number') {</td></tr><tr><th id="L128"><a href="#L128">128</a></th><td>        this.start = start;</td></tr><tr><th id="L129"><a href="#L129">129</a></th><td>        this.end = end;</td></tr><tr><th id="L130"><a href="#L130">130</a></th><td>        this.predictions = predictions;</td></tr><tr><th id="L131"><a href="#L131">131</a></th><td>    }</td></tr><tr><th id="L132"><a href="#L132">132</a></th><td>    else {</td></tr><tr><th id="L133"><a href="#L133">133</a></th><td>        var arg = start;</td></tr><tr><th id="L134"><a href="#L134">134</a></th><td>        this.start = arg.start;</td></tr><tr><th id="L135"><a href="#L135">135</a></th><td>        this.end = arg.end;</td></tr><tr><th id="L136"><a href="#L136">136</a></th><td>        this.predictions = arg.predictions;</td></tr><tr><th id="L137"><a href="#L137">137</a></th><td>    }</td></tr><tr><th id="L138"><a href="#L138">138</a></th><td>}</td></tr><tr><th id="L139"><a href="#L139">139</a></th><td>Hint.prototype = {</td></tr><tr><th id="L140"><a href="#L140">140</a></th><td>};</td></tr><tr><th id="L141"><a href="#L141">141</a></th><td>/**</td></tr><tr><th id="L142"><a href="#L142">142</a></th><td> * Loop over the array of hints finding the one we should display.</td></tr><tr><th id="L143"><a href="#L143">143</a></th><td> * @param hints array of hints</td></tr><tr><th id="L144"><a href="#L144">144</a></th><td> */</td></tr><tr><th id="L145"><a href="#L145">145</a></th><td>Hint.sort = function(hints, cursor) {</td></tr><tr><th id="L146"><a href="#L146">146</a></th><td>    // Calculate 'distance from cursor'</td></tr><tr><th id="L147"><a href="#L147">147</a></th><td>    if (cursor !== undefined) {</td></tr><tr><th id="L148"><a href="#L148">148</a></th><td>        hints.forEach(function(hint) {</td></tr><tr><th id="L149"><a href="#L149">149</a></th><td>            if (hint.start === Argument.AT_CURSOR) {</td></tr><tr><th id="L150"><a href="#L150">150</a></th><td>                hint.distance = 0;</td></tr><tr><th id="L151"><a href="#L151">151</a></th><td>            }</td></tr><tr><th id="L152"><a href="#L152">152</a></th><td>            else if (cursor &lt; hint.start) {</td></tr><tr><th id="L153"><a href="#L153">153</a></th><td>                hint.distance = hint.start - cursor;</td></tr><tr><th id="L154"><a href="#L154">154</a></th><td>            }</td></tr><tr><th id="L155"><a href="#L155">155</a></th><td>            else if (cursor &gt; hint.end) {</td></tr><tr><th id="L156"><a href="#L156">156</a></th><td>                hint.distance = cursor - hint.end;</td></tr><tr><th id="L157"><a href="#L157">157</a></th><td>            }</td></tr><tr><th id="L158"><a href="#L158">158</a></th><td>            else {</td></tr><tr><th id="L159"><a href="#L159">159</a></th><td>                hint.distance = 0;</td></tr><tr><th id="L160"><a href="#L160">160</a></th><td>            }</td></tr><tr><th id="L161"><a href="#L161">161</a></th><td>        }, this);</td></tr><tr><th id="L162"><a href="#L162">162</a></th><td>    }</td></tr><tr><th id="L163"><a href="#L163">163</a></th><td>    // Sort</td></tr><tr><th id="L164"><a href="#L164">164</a></th><td>    hints.sort(function(hint1, hint2) {</td></tr><tr><th id="L165"><a href="#L165">165</a></th><td>        // Compare first based on distance from cursor</td></tr><tr><th id="L166"><a href="#L166">166</a></th><td>        if (cursor !== undefined) {</td></tr><tr><th id="L167"><a href="#L167">167</a></th><td>            var diff = hint1.distance - hint2.distance;</td></tr><tr><th id="L168"><a href="#L168">168</a></th><td>            if (diff != 0) {</td></tr><tr><th id="L169"><a href="#L169">169</a></th><td>                return diff;</td></tr><tr><th id="L170"><a href="#L170">170</a></th><td>            }</td></tr><tr><th id="L171"><a href="#L171">171</a></th><td>        }</td></tr><tr><th id="L172"><a href="#L172">172</a></th><td>        // otherwise go with hint severity</td></tr><tr><th id="L173"><a href="#L173">173</a></th><td>        return hint2.status - hint1.status;</td></tr><tr><th id="L174"><a href="#L174">174</a></th><td>    });</td></tr><tr><th id="L175"><a href="#L175">175</a></th><td>    // tidy-up</td></tr><tr><th id="L176"><a href="#L176">176</a></th><td>    if (cursor !== undefined) {</td></tr><tr><th id="L177"><a href="#L177">177</a></th><td>        hints.forEach(function(hint) {</td></tr><tr><th id="L178"><a href="#L178">178</a></th><td>            delete hint.distance;</td></tr><tr><th id="L179"><a href="#L179">179</a></th><td>        }, this);</td></tr><tr><th id="L180"><a href="#L180">180</a></th><td>    }</td></tr><tr><th id="L181"><a href="#L181">181</a></th><td>    return hints;</td></tr><tr><th id="L182"><a href="#L182">182</a></th><td>};</td></tr><tr><th id="L183"><a href="#L183">183</a></th><td>exports.Hint = Hint;</td></tr><tr><th id="L184"><a href="#L184">184</a></th><td></td></tr><tr><th id="L185"><a href="#L185">185</a></th><td>/**</td></tr><tr><th id="L186"><a href="#L186">186</a></th><td> * A Hint that arose as a result of a Conversion</td></tr><tr><th id="L187"><a href="#L187">187</a></th><td> */</td></tr><tr><th id="L188"><a href="#L188">188</a></th><td>function ConversionHint(conversion, arg) {</td></tr><tr><th id="L189"><a href="#L189">189</a></th><td>    this.status = conversion.status;</td></tr><tr><th id="L190"><a href="#L190">190</a></th><td>    this.message = conversion.message;</td></tr><tr><th id="L191"><a href="#L191">191</a></th><td>    if (arg) {</td></tr><tr><th id="L192"><a href="#L192">192</a></th><td>        this.start = arg.start;</td></tr><tr><th id="L193"><a href="#L193">193</a></th><td>        this.end = arg.end;</td></tr><tr><th id="L194"><a href="#L194">194</a></th><td>    }</td></tr><tr><th id="L195"><a href="#L195">195</a></th><td>    else {</td></tr><tr><th id="L196"><a href="#L196">196</a></th><td>        this.start = 0;</td></tr><tr><th id="L197"><a href="#L197">197</a></th><td>        this.end = 0;</td></tr><tr><th id="L198"><a href="#L198">198</a></th><td>    }</td></tr><tr><th id="L199"><a href="#L199">199</a></th><td>    this.predictions = conversion.predictions;</td></tr><tr><th id="L200"><a href="#L200">200</a></th><td>};</td></tr><tr><th id="L201"><a href="#L201">201</a></th><td>oop.inherits(ConversionHint, Hint);</td></tr><tr><th id="L202"><a href="#L202">202</a></th><td></td></tr><tr><th id="L203"><a href="#L203">203</a></th><td></td></tr><tr><th id="L204"><a href="#L204">204</a></th><td>/**</td></tr><tr><th id="L205"><a href="#L205">205</a></th><td> * We record where in the input string an argument comes so we can report errors</td></tr><tr><th id="L206"><a href="#L206">206</a></th><td> * against those string positions.</td></tr><tr><th id="L207"><a href="#L207">207</a></th><td> * We publish a 'change' event when-ever the text changes</td></tr><tr><th id="L208"><a href="#L208">208</a></th><td> * @param emitter Arguments use something else to pass on change events.</td></tr><tr><th id="L209"><a href="#L209">209</a></th><td> * Currently this will be the creating Requisition. This prevents dependency</td></tr><tr><th id="L210"><a href="#L210">210</a></th><td> * loops and prevents us from needing to merge listener lists.</td></tr><tr><th id="L211"><a href="#L211">211</a></th><td> * @param text The string (trimmed) that contains the argument</td></tr><tr><th id="L212"><a href="#L212">212</a></th><td> * @param start The position of the text in the original input string</td></tr><tr><th id="L213"><a href="#L213">213</a></th><td> * @param end See start</td></tr><tr><th id="L214"><a href="#L214">214</a></th><td> * @param prefix Knowledge of quotation marks and whitespace used prior to the</td></tr><tr><th id="L215"><a href="#L215">215</a></th><td> * text in the input string allows us to re-generate the original input from</td></tr><tr><th id="L216"><a href="#L216">216</a></th><td> * the arguments.</td></tr><tr><th id="L217"><a href="#L217">217</a></th><td> * @param suffix Any quotation marks and whitespace used after the text.</td></tr><tr><th id="L218"><a href="#L218">218</a></th><td> * Whitespace is normally placed in the prefix to the succeeding argument, but</td></tr><tr><th id="L219"><a href="#L219">219</a></th><td> * can be used here when this is the last argument.</td></tr><tr><th id="L220"><a href="#L220">220</a></th><td> * @constructor</td></tr><tr><th id="L221"><a href="#L221">221</a></th><td> */</td></tr><tr><th id="L222"><a href="#L222">222</a></th><td>function Argument(emitter, text, start, end, prefix, suffix) {</td></tr><tr><th id="L223"><a href="#L223">223</a></th><td>    this.emitter = emitter;</td></tr><tr><th id="L224"><a href="#L224">224</a></th><td>    this.setText(text);</td></tr><tr><th id="L225"><a href="#L225">225</a></th><td>    this.start = start;</td></tr><tr><th id="L226"><a href="#L226">226</a></th><td>    this.end = end;</td></tr><tr><th id="L227"><a href="#L227">227</a></th><td>    this.prefix = prefix;</td></tr><tr><th id="L228"><a href="#L228">228</a></th><td>    this.suffix = suffix;</td></tr><tr><th id="L229"><a href="#L229">229</a></th><td>}</td></tr><tr><th id="L230"><a href="#L230">230</a></th><td>Argument.prototype = {</td></tr><tr><th id="L231"><a href="#L231">231</a></th><td>    /**</td></tr><tr><th id="L232"><a href="#L232">232</a></th><td>     * Return the result of merging these arguments.</td></tr><tr><th id="L233"><a href="#L233">233</a></th><td>     * TODO: What happens when we're merging arguments for the single string</td></tr><tr><th id="L234"><a href="#L234">234</a></th><td>     * case and some of the arguments are in quotation marks?</td></tr><tr><th id="L235"><a href="#L235">235</a></th><td>     */</td></tr><tr><th id="L236"><a href="#L236">236</a></th><td>    merge: function(following) {</td></tr><tr><th id="L237"><a href="#L237">237</a></th><td>        if (following.emitter != this.emitter) {</td></tr><tr><th id="L238"><a href="#L238">238</a></th><td>            throw new Error('Can\'t merge Arguments from different EventEmitters');</td></tr><tr><th id="L239"><a href="#L239">239</a></th><td>        }</td></tr><tr><th id="L240"><a href="#L240">240</a></th><td>        return new Argument(</td></tr><tr><th id="L241"><a href="#L241">241</a></th><td>            this.emitter,</td></tr><tr><th id="L242"><a href="#L242">242</a></th><td>            this.text + this.suffix + following.prefix + following.text,</td></tr><tr><th id="L243"><a href="#L243">243</a></th><td>            this.start, following.end,</td></tr><tr><th id="L244"><a href="#L244">244</a></th><td>            this.prefix,</td></tr><tr><th id="L245"><a href="#L245">245</a></th><td>            following.suffix);</td></tr><tr><th id="L246"><a href="#L246">246</a></th><td>    },</td></tr><tr><th id="L247"><a href="#L247">247</a></th><td></td></tr><tr><th id="L248"><a href="#L248">248</a></th><td>    /**</td></tr><tr><th id="L249"><a href="#L249">249</a></th><td>     * See notes on events in Assignment. We might need to hook changes here</td></tr><tr><th id="L250"><a href="#L250">250</a></th><td>     * into a CliRequisition so they appear of the command line.</td></tr><tr><th id="L251"><a href="#L251">251</a></th><td>     */</td></tr><tr><th id="L252"><a href="#L252">252</a></th><td>    setText: function(text) {</td></tr><tr><th id="L253"><a href="#L253">253</a></th><td>        if (text == null) {</td></tr><tr><th id="L254"><a href="#L254">254</a></th><td>            throw new Error('Illegal text for Argument: ' + text);</td></tr><tr><th id="L255"><a href="#L255">255</a></th><td>        }</td></tr><tr><th id="L256"><a href="#L256">256</a></th><td>        var ev = { argument: this, oldText: this.text, text: text };</td></tr><tr><th id="L257"><a href="#L257">257</a></th><td>        this.text = text;</td></tr><tr><th id="L258"><a href="#L258">258</a></th><td>        this.emitter._dispatchEvent('argumentChange', ev);</td></tr><tr><th id="L259"><a href="#L259">259</a></th><td>    },</td></tr><tr><th id="L260"><a href="#L260">260</a></th><td></td></tr><tr><th id="L261"><a href="#L261">261</a></th><td>    /**</td></tr><tr><th id="L262"><a href="#L262">262</a></th><td>     * Helper when we're putting arguments back together</td></tr><tr><th id="L263"><a href="#L263">263</a></th><td>     */</td></tr><tr><th id="L264"><a href="#L264">264</a></th><td>    toString: function() {</td></tr><tr><th id="L265"><a href="#L265">265</a></th><td>        // TODO: There is a bug here - we should re-escape escaped characters</td></tr><tr><th id="L266"><a href="#L266">266</a></th><td>        // But can we do that reliably?</td></tr><tr><th id="L267"><a href="#L267">267</a></th><td>        return this.prefix + this.text + this.suffix;</td></tr><tr><th id="L268"><a href="#L268">268</a></th><td>    }</td></tr><tr><th id="L269"><a href="#L269">269</a></th><td>};</td></tr><tr><th id="L270"><a href="#L270">270</a></th><td></td></tr><tr><th id="L271"><a href="#L271">271</a></th><td>/**</td></tr><tr><th id="L272"><a href="#L272">272</a></th><td> * Merge an array of arguments into a single argument.</td></tr><tr><th id="L273"><a href="#L273">273</a></th><td> * All Arguments in the array are expected to have the same emitter</td></tr><tr><th id="L274"><a href="#L274">274</a></th><td> */</td></tr><tr><th id="L275"><a href="#L275">275</a></th><td>Argument.merge = function(argArray, start, end) {</td></tr><tr><th id="L276"><a href="#L276">276</a></th><td>    start = (start === undefined) ? 0 : start;</td></tr><tr><th id="L277"><a href="#L277">277</a></th><td>    end = (end === undefined) ? argArray.length : end;</td></tr><tr><th id="L278"><a href="#L278">278</a></th><td></td></tr><tr><th id="L279"><a href="#L279">279</a></th><td>    var joined;</td></tr><tr><th id="L280"><a href="#L280">280</a></th><td>    for (var i = start; i &lt; end; i++) {</td></tr><tr><th id="L281"><a href="#L281">281</a></th><td>        var arg = argArray[i];</td></tr><tr><th id="L282"><a href="#L282">282</a></th><td>        if (!joined) {</td></tr><tr><th id="L283"><a href="#L283">283</a></th><td>            joined = arg;</td></tr><tr><th id="L284"><a href="#L284">284</a></th><td>        }</td></tr><tr><th id="L285"><a href="#L285">285</a></th><td>        else {</td></tr><tr><th id="L286"><a href="#L286">286</a></th><td>            joined = joined.merge(arg);</td></tr><tr><th id="L287"><a href="#L287">287</a></th><td>        }</td></tr><tr><th id="L288"><a href="#L288">288</a></th><td>    }</td></tr><tr><th id="L289"><a href="#L289">289</a></th><td>    return joined;</td></tr><tr><th id="L290"><a href="#L290">290</a></th><td>};</td></tr><tr><th id="L291"><a href="#L291">291</a></th><td></td></tr><tr><th id="L292"><a href="#L292">292</a></th><td>/**</td></tr><tr><th id="L293"><a href="#L293">293</a></th><td> * We sometimes need a way to say 'this error occurs where ever the cursor is'</td></tr><tr><th id="L294"><a href="#L294">294</a></th><td> */</td></tr><tr><th id="L295"><a href="#L295">295</a></th><td>Argument.AT_CURSOR = -1;</td></tr><tr><th id="L296"><a href="#L296">296</a></th><td></td></tr><tr><th id="L297"><a href="#L297">297</a></th><td></td></tr><tr><th id="L298"><a href="#L298">298</a></th><td>/**</td></tr><tr><th id="L299"><a href="#L299">299</a></th><td> * A link between a parameter and the data for that parameter.</td></tr><tr><th id="L300"><a href="#L300">300</a></th><td> * The data for the parameter is available as in the preferred type and as</td></tr><tr><th id="L301"><a href="#L301">301</a></th><td> * an Argument for the CLI.</td></tr><tr><th id="L302"><a href="#L302">302</a></th><td> * &lt;p&gt;We also record validity information where applicable.</td></tr><tr><th id="L303"><a href="#L303">303</a></th><td> * &lt;p&gt;For values, null and undefined have distinct definitions. null means</td></tr><tr><th id="L304"><a href="#L304">304</a></th><td> * that a value has been provided, undefined means that it has not.</td></tr><tr><th id="L305"><a href="#L305">305</a></th><td> * Thus, null is a valid default value, and common because it identifies an</td></tr><tr><th id="L306"><a href="#L306">306</a></th><td> * parameter that is optional. undefined means there is no value from</td></tr><tr><th id="L307"><a href="#L307">307</a></th><td> * the command line.</td></tr><tr><th id="L308"><a href="#L308">308</a></th><td> * @constructor</td></tr><tr><th id="L309"><a href="#L309">309</a></th><td> */</td></tr><tr><th id="L310"><a href="#L310">310</a></th><td>function Assignment(param, requisition) {</td></tr><tr><th id="L311"><a href="#L311">311</a></th><td>    this.param = param;</td></tr><tr><th id="L312"><a href="#L312">312</a></th><td>    this.requisition = requisition;</td></tr><tr><th id="L313"><a href="#L313">313</a></th><td>    this.setValue(param.defaultValue);</td></tr><tr><th id="L314"><a href="#L314">314</a></th><td>};</td></tr><tr><th id="L315"><a href="#L315">315</a></th><td>Assignment.prototype = {</td></tr><tr><th id="L316"><a href="#L316">316</a></th><td>    /**</td></tr><tr><th id="L317"><a href="#L317">317</a></th><td>     * The parameter that we are assigning to</td></tr><tr><th id="L318"><a href="#L318">318</a></th><td>     * @readonly</td></tr><tr><th id="L319"><a href="#L319">319</a></th><td>     */</td></tr><tr><th id="L320"><a href="#L320">320</a></th><td>    param: undefined,</td></tr><tr><th id="L321"><a href="#L321">321</a></th><td></td></tr><tr><th id="L322"><a href="#L322">322</a></th><td>    /**</td></tr><tr><th id="L323"><a href="#L323">323</a></th><td>     * Report on the status of the last parse() conversion.</td></tr><tr><th id="L324"><a href="#L324">324</a></th><td>     * @see types.Conversion</td></tr><tr><th id="L325"><a href="#L325">325</a></th><td>     */</td></tr><tr><th id="L326"><a href="#L326">326</a></th><td>    conversion: undefined,</td></tr><tr><th id="L327"><a href="#L327">327</a></th><td></td></tr><tr><th id="L328"><a href="#L328">328</a></th><td>    /**</td></tr><tr><th id="L329"><a href="#L329">329</a></th><td>     * The current value in a type as specified by param.type</td></tr><tr><th id="L330"><a href="#L330">330</a></th><td>     */</td></tr><tr><th id="L331"><a href="#L331">331</a></th><td>    value: undefined,</td></tr><tr><th id="L332"><a href="#L332">332</a></th><td></td></tr><tr><th id="L333"><a href="#L333">333</a></th><td>    /**</td></tr><tr><th id="L334"><a href="#L334">334</a></th><td>     * The string version of the current value</td></tr><tr><th id="L335"><a href="#L335">335</a></th><td>     */</td></tr><tr><th id="L336"><a href="#L336">336</a></th><td>    arg: undefined,</td></tr><tr><th id="L337"><a href="#L337">337</a></th><td></td></tr><tr><th id="L338"><a href="#L338">338</a></th><td>    /**</td></tr><tr><th id="L339"><a href="#L339">339</a></th><td>     * The current value (i.e. not the string representation)</td></tr><tr><th id="L340"><a href="#L340">340</a></th><td>     * Use setValue() to mutate</td></tr><tr><th id="L341"><a href="#L341">341</a></th><td>     */</td></tr><tr><th id="L342"><a href="#L342">342</a></th><td>    value: undefined,</td></tr><tr><th id="L343"><a href="#L343">343</a></th><td>    setValue: function(value) {</td></tr><tr><th id="L344"><a href="#L344">344</a></th><td>        if (this.value === value) {</td></tr><tr><th id="L345"><a href="#L345">345</a></th><td>            return;</td></tr><tr><th id="L346"><a href="#L346">346</a></th><td>        }</td></tr><tr><th id="L347"><a href="#L347">347</a></th><td></td></tr><tr><th id="L348"><a href="#L348">348</a></th><td>        if (value === undefined) {</td></tr><tr><th id="L349"><a href="#L349">349</a></th><td>            this.value = this.param.defaultValue;</td></tr><tr><th id="L350"><a href="#L350">350</a></th><td>            this.conversion = this.param.getDefault ?</td></tr><tr><th id="L351"><a href="#L351">351</a></th><td>                    this.param.getDefault() :</td></tr><tr><th id="L352"><a href="#L352">352</a></th><td>                    this.param.type.getDefault();</td></tr><tr><th id="L353"><a href="#L353">353</a></th><td>            this.arg = undefined;</td></tr><tr><th id="L354"><a href="#L354">354</a></th><td>        } else {</td></tr><tr><th id="L355"><a href="#L355">355</a></th><td>            this.value = value;</td></tr><tr><th id="L356"><a href="#L356">356</a></th><td>            this.conversion = undefined;</td></tr><tr><th id="L357"><a href="#L357">357</a></th><td>            var text = (value == null) ? '' : this.param.type.stringify(value);</td></tr><tr><th id="L358"><a href="#L358">358</a></th><td>            if (this.arg) {</td></tr><tr><th id="L359"><a href="#L359">359</a></th><td>                this.arg.setText(text);</td></tr><tr><th id="L360"><a href="#L360">360</a></th><td>            }</td></tr><tr><th id="L361"><a href="#L361">361</a></th><td>        }</td></tr><tr><th id="L362"><a href="#L362">362</a></th><td></td></tr><tr><th id="L363"><a href="#L363">363</a></th><td>        this.requisition._assignmentChanged(this);</td></tr><tr><th id="L364"><a href="#L364">364</a></th><td>    },</td></tr><tr><th id="L365"><a href="#L365">365</a></th><td></td></tr><tr><th id="L366"><a href="#L366">366</a></th><td>    /**</td></tr><tr><th id="L367"><a href="#L367">367</a></th><td>     * The textual representation of the current value</td></tr><tr><th id="L368"><a href="#L368">368</a></th><td>     * Use setValue() to mutate</td></tr><tr><th id="L369"><a href="#L369">369</a></th><td>     */</td></tr><tr><th id="L370"><a href="#L370">370</a></th><td>    arg: undefined,</td></tr><tr><th id="L371"><a href="#L371">371</a></th><td>    setArgument: function(arg) {</td></tr><tr><th id="L372"><a href="#L372">372</a></th><td>        if (this.arg === arg) {</td></tr><tr><th id="L373"><a href="#L373">373</a></th><td>            return;</td></tr><tr><th id="L374"><a href="#L374">374</a></th><td>        }</td></tr><tr><th id="L375"><a href="#L375">375</a></th><td>        this.arg = arg;</td></tr><tr><th id="L376"><a href="#L376">376</a></th><td>        this.conversion = this.param.type.parse(arg.text);</td></tr><tr><th id="L377"><a href="#L377">377</a></th><td>        this.conversion.arg = arg; // TODO: make this automatic?</td></tr><tr><th id="L378"><a href="#L378">378</a></th><td>        this.value = this.conversion.value;</td></tr><tr><th id="L379"><a href="#L379">379</a></th><td>        this.requisition._assignmentChanged(this);</td></tr><tr><th id="L380"><a href="#L380">380</a></th><td>    },</td></tr><tr><th id="L381"><a href="#L381">381</a></th><td></td></tr><tr><th id="L382"><a href="#L382">382</a></th><td>    /**</td></tr><tr><th id="L383"><a href="#L383">383</a></th><td>     * Create a list of the hints associated with this parameter assignment.</td></tr><tr><th id="L384"><a href="#L384">384</a></th><td>     * Generally there will be only one hint generated because we're currently</td></tr><tr><th id="L385"><a href="#L385">385</a></th><td>     * only displaying one hint at a time, ordering by distance from cursor</td></tr><tr><th id="L386"><a href="#L386">386</a></th><td>     * and severity. Since distance from cursor will be the same for all hints</td></tr><tr><th id="L387"><a href="#L387">387</a></th><td>     * from this assignment all but the most severe will ever be used. It might</td></tr><tr><th id="L388"><a href="#L388">388</a></th><td>     * make sense with more experience to alter this to function to be getHint()</td></tr><tr><th id="L389"><a href="#L389">389</a></th><td>     */</td></tr><tr><th id="L390"><a href="#L390">390</a></th><td>    getHint: function() {</td></tr><tr><th id="L391"><a href="#L391">391</a></th><td>        // Allow the parameter to provide documentation</td></tr><tr><th id="L392"><a href="#L392">392</a></th><td>        if (this.param.getCustomHint &amp;&amp; this.value &amp;&amp; this.arg) {</td></tr><tr><th id="L393"><a href="#L393">393</a></th><td>            var hint = this.param.getCustomHint(this.value, this.arg);</td></tr><tr><th id="L394"><a href="#L394">394</a></th><td>            if (hint) {</td></tr><tr><th id="L395"><a href="#L395">395</a></th><td>                return hint;</td></tr><tr><th id="L396"><a href="#L396">396</a></th><td>            }</td></tr><tr><th id="L397"><a href="#L397">397</a></th><td>        }</td></tr><tr><th id="L398"><a href="#L398">398</a></th><td></td></tr><tr><th id="L399"><a href="#L399">399</a></th><td>        // If there is no argument, use the cursor position</td></tr><tr><th id="L400"><a href="#L400">400</a></th><td>        var message = '&lt;strong&gt;' + this.param.name + '&lt;/strong&gt;: ';</td></tr><tr><th id="L401"><a href="#L401">401</a></th><td>        if (this.param.description) {</td></tr><tr><th id="L402"><a href="#L402">402</a></th><td>            // TODO: This should be a short description - do we need to trim?</td></tr><tr><th id="L403"><a href="#L403">403</a></th><td>            message += this.param.description.trim();</td></tr><tr><th id="L404"><a href="#L404">404</a></th><td></td></tr><tr><th id="L405"><a href="#L405">405</a></th><td>            // Ensure the help text ends with '. '</td></tr><tr><th id="L406"><a href="#L406">406</a></th><td>            if (message.charAt(message.length - 1) !== '.') {</td></tr><tr><th id="L407"><a href="#L407">407</a></th><td>                message += '.';</td></tr><tr><th id="L408"><a href="#L408">408</a></th><td>            }</td></tr><tr><th id="L409"><a href="#L409">409</a></th><td>            if (message.charAt(message.length - 1) !== ' ') {</td></tr><tr><th id="L410"><a href="#L410">410</a></th><td>                message += ' ';</td></tr><tr><th id="L411"><a href="#L411">411</a></th><td>            }</td></tr><tr><th id="L412"><a href="#L412">412</a></th><td>        }</td></tr><tr><th id="L413"><a href="#L413">413</a></th><td>        var status = Status.VALID;</td></tr><tr><th id="L414"><a href="#L414">414</a></th><td>        var start = this.arg ? this.arg.start : Argument.AT_CURSOR;</td></tr><tr><th id="L415"><a href="#L415">415</a></th><td>        var end = this.arg ? this.arg.end : Argument.AT_CURSOR;</td></tr><tr><th id="L416"><a href="#L416">416</a></th><td>        var predictions;</td></tr><tr><th id="L417"><a href="#L417">417</a></th><td></td></tr><tr><th id="L418"><a href="#L418">418</a></th><td>        // Non-valid conversions will have useful information to pass on</td></tr><tr><th id="L419"><a href="#L419">419</a></th><td>        if (this.conversion) {</td></tr><tr><th id="L420"><a href="#L420">420</a></th><td>            status = this.conversion.status;</td></tr><tr><th id="L421"><a href="#L421">421</a></th><td>            if (this.conversion.message) {</td></tr><tr><th id="L422"><a href="#L422">422</a></th><td>                message += this.conversion.message;</td></tr><tr><th id="L423"><a href="#L423">423</a></th><td>            }</td></tr><tr><th id="L424"><a href="#L424">424</a></th><td>            predictions = this.conversion.predictions;</td></tr><tr><th id="L425"><a href="#L425">425</a></th><td>        }</td></tr><tr><th id="L426"><a href="#L426">426</a></th><td></td></tr><tr><th id="L427"><a href="#L427">427</a></th><td>        // Hint if the param is required, but not provided</td></tr><tr><th id="L428"><a href="#L428">428</a></th><td>        var argProvided = this.arg &amp;&amp; this.arg.text !== '';</td></tr><tr><th id="L429"><a href="#L429">429</a></th><td>        var dataProvided = this.value !== undefined || argProvided;</td></tr><tr><th id="L430"><a href="#L430">430</a></th><td>        if (this.param.defaultValue === undefined &amp;&amp; !dataProvided) {</td></tr><tr><th id="L431"><a href="#L431">431</a></th><td>            status = Status.INVALID;</td></tr><tr><th id="L432"><a href="#L432">432</a></th><td>            message += '&lt;strong&gt;Required&lt;\strong&gt;';</td></tr><tr><th id="L433"><a href="#L433">433</a></th><td>        }</td></tr><tr><th id="L434"><a href="#L434">434</a></th><td></td></tr><tr><th id="L435"><a href="#L435">435</a></th><td>        return new Hint(status, message, start, end, predictions);</td></tr><tr><th id="L436"><a href="#L436">436</a></th><td>    },</td></tr><tr><th id="L437"><a href="#L437">437</a></th><td></td></tr><tr><th id="L438"><a href="#L438">438</a></th><td>    /**</td></tr><tr><th id="L439"><a href="#L439">439</a></th><td>     * Basically &lt;tt&gt;setValue(conversion.predictions[0])&lt;/tt&gt; done in a safe</td></tr><tr><th id="L440"><a href="#L440">440</a></th><td>     * way.</td></tr><tr><th id="L441"><a href="#L441">441</a></th><td>     */</td></tr><tr><th id="L442"><a href="#L442">442</a></th><td>    complete: function() {</td></tr><tr><th id="L443"><a href="#L443">443</a></th><td>        if (this.conversion &amp;&amp; this.conversion.predictions &amp;&amp;</td></tr><tr><th id="L444"><a href="#L444">444</a></th><td>                this.conversion.predictions.length &gt; 0) {</td></tr><tr><th id="L445"><a href="#L445">445</a></th><td>            this.setValue(this.conversion.predictions[0]);</td></tr><tr><th id="L446"><a href="#L446">446</a></th><td>        }</td></tr><tr><th id="L447"><a href="#L447">447</a></th><td>    },</td></tr><tr><th id="L448"><a href="#L448">448</a></th><td></td></tr><tr><th id="L449"><a href="#L449">449</a></th><td>    /**</td></tr><tr><th id="L450"><a href="#L450">450</a></th><td>     * If the cursor is at 'position', do we have sufficient data to start</td></tr><tr><th id="L451"><a href="#L451">451</a></th><td>     * displaying the next hint. This is both complex and important.</td></tr><tr><th id="L452"><a href="#L452">452</a></th><td>     * For example, if the user has just typed:&lt;ul&gt;</td></tr><tr><th id="L453"><a href="#L453">453</a></th><td>     * &lt;li&gt;'set tabstop ' then they clearly want to know about the valid</td></tr><tr><th id="L454"><a href="#L454">454</a></th><td>     *     values for the tabstop setting, so the hint is based on the next</td></tr><tr><th id="L455"><a href="#L455">455</a></th><td>     *     parameter.</td></tr><tr><th id="L456"><a href="#L456">456</a></th><td>     * &lt;li&gt;'set tabstop' (without trailing space) - they will probably still</td></tr><tr><th id="L457"><a href="#L457">457</a></th><td>     *     want to know about the valid values for the tabstop setting because</td></tr><tr><th id="L458"><a href="#L458">458</a></th><td>     *     there is no confusion about the setting in question.</td></tr><tr><th id="L459"><a href="#L459">459</a></th><td>     * &lt;li&gt;'set tabsto' they've not finished typing a setting name so the hint</td></tr><tr><th id="L460"><a href="#L460">460</a></th><td>     *     should be based on the current parameter.</td></tr><tr><th id="L461"><a href="#L461">461</a></th><td>     * &lt;li&gt;'set tabstop' (when there is an additional tabstopstyle setting) we</td></tr><tr><th id="L462"><a href="#L462">462</a></th><td>     *     can't make assumptions about the setting - we're not finished.</td></tr><tr><th id="L463"><a href="#L463">463</a></th><td>     * &lt;/ul&gt;</td></tr><tr><th id="L464"><a href="#L464">464</a></th><td>     * &lt;p&gt;Note that the input for 2 and 4 is identical, only the configuration</td></tr><tr><th id="L465"><a href="#L465">465</a></th><td>     * has changed, so hint display is environmental.</td></tr><tr><th id="L466"><a href="#L466">466</a></th><td>     *</td></tr><tr><th id="L467"><a href="#L467">467</a></th><td>     * &lt;p&gt;This function works out if the cursor is before the end of this</td></tr><tr><th id="L468"><a href="#L468">468</a></th><td>     * assignment (assuming that we've asked the same thing of the previous</td></tr><tr><th id="L469"><a href="#L469">469</a></th><td>     * assignment) and then attempts to work out if we should use the hint from</td></tr><tr><th id="L470"><a href="#L470">470</a></th><td>     * the next assignment even though technically the cursor is still inside</td></tr><tr><th id="L471"><a href="#L471">471</a></th><td>     * this one due to the rules above.</td></tr><tr><th id="L472"><a href="#L472">472</a></th><td>     */</td></tr><tr><th id="L473"><a href="#L473">473</a></th><td>    isPositionCaptured: function(position) {</td></tr><tr><th id="L474"><a href="#L474">474</a></th><td>        if (!this.arg) {</td></tr><tr><th id="L475"><a href="#L475">475</a></th><td>            return false;</td></tr><tr><th id="L476"><a href="#L476">476</a></th><td>        }</td></tr><tr><th id="L477"><a href="#L477">477</a></th><td></td></tr><tr><th id="L478"><a href="#L478">478</a></th><td>        // Note we don't check if position &gt;= this.arg.start because that's</td></tr><tr><th id="L479"><a href="#L479">479</a></th><td>        // implied by the fact that we're asking the assignments in turn, and</td></tr><tr><th id="L480"><a href="#L480">480</a></th><td>        // we want to avoid thing falling between the cracks, but we do need</td></tr><tr><th id="L481"><a href="#L481">481</a></th><td>        // to check that the argument does have a position</td></tr><tr><th id="L482"><a href="#L482">482</a></th><td>        if (this.arg.start === -1) {</td></tr><tr><th id="L483"><a href="#L483">483</a></th><td>            return false;</td></tr><tr><th id="L484"><a href="#L484">484</a></th><td>        }</td></tr><tr><th id="L485"><a href="#L485">485</a></th><td></td></tr><tr><th id="L486"><a href="#L486">486</a></th><td>        // We're clearly done if the position is past the end of the text</td></tr><tr><th id="L487"><a href="#L487">487</a></th><td>        if (position &gt; this.arg.end) {</td></tr><tr><th id="L488"><a href="#L488">488</a></th><td>            return false;</td></tr><tr><th id="L489"><a href="#L489">489</a></th><td>        }</td></tr><tr><th id="L490"><a href="#L490">490</a></th><td></td></tr><tr><th id="L491"><a href="#L491">491</a></th><td>        // If we're AT the end, the position is captured if either the status</td></tr><tr><th id="L492"><a href="#L492">492</a></th><td>        // is not valid or if there are other valid options including current</td></tr><tr><th id="L493"><a href="#L493">493</a></th><td>        if (position === this.arg.end) {</td></tr><tr><th id="L494"><a href="#L494">494</a></th><td>            return this.conversion.status !== Status.VALID ||</td></tr><tr><th id="L495"><a href="#L495">495</a></th><td>                    this.conversion.predictions.length !== 0;</td></tr><tr><th id="L496"><a href="#L496">496</a></th><td>        }</td></tr><tr><th id="L497"><a href="#L497">497</a></th><td></td></tr><tr><th id="L498"><a href="#L498">498</a></th><td>        // Otherwise we're clearly inside</td></tr><tr><th id="L499"><a href="#L499">499</a></th><td>        return true;</td></tr><tr><th id="L500"><a href="#L500">500</a></th><td>    },</td></tr><tr><th id="L501"><a href="#L501">501</a></th><td></td></tr><tr><th id="L502"><a href="#L502">502</a></th><td>    /**</td></tr><tr><th id="L503"><a href="#L503">503</a></th><td>     * Replace the current value with the lower value if such a concept</td></tr><tr><th id="L504"><a href="#L504">504</a></th><td>     * exists.</td></tr><tr><th id="L505"><a href="#L505">505</a></th><td>     */</td></tr><tr><th id="L506"><a href="#L506">506</a></th><td>    decrement: function() {</td></tr><tr><th id="L507"><a href="#L507">507</a></th><td>        var replacement = this.param.type.decrement(this.value);</td></tr><tr><th id="L508"><a href="#L508">508</a></th><td>        if (replacement != null) {</td></tr><tr><th id="L509"><a href="#L509">509</a></th><td>            this.setValue(replacement);</td></tr><tr><th id="L510"><a href="#L510">510</a></th><td>        }</td></tr><tr><th id="L511"><a href="#L511">511</a></th><td>    },</td></tr><tr><th id="L512"><a href="#L512">512</a></th><td></td></tr><tr><th id="L513"><a href="#L513">513</a></th><td>    /**</td></tr><tr><th id="L514"><a href="#L514">514</a></th><td>     * Replace the current value with the higher value if such a concept</td></tr><tr><th id="L515"><a href="#L515">515</a></th><td>     * exists.</td></tr><tr><th id="L516"><a href="#L516">516</a></th><td>     */</td></tr><tr><th id="L517"><a href="#L517">517</a></th><td>    increment: function() {</td></tr><tr><th id="L518"><a href="#L518">518</a></th><td>        var replacement = this.param.type.increment(this.value);</td></tr><tr><th id="L519"><a href="#L519">519</a></th><td>        if (replacement != null) {</td></tr><tr><th id="L520"><a href="#L520">520</a></th><td>            this.setValue(replacement);</td></tr><tr><th id="L521"><a href="#L521">521</a></th><td>        }</td></tr><tr><th id="L522"><a href="#L522">522</a></th><td>    },</td></tr><tr><th id="L523"><a href="#L523">523</a></th><td></td></tr><tr><th id="L524"><a href="#L524">524</a></th><td>    /**</td></tr><tr><th id="L525"><a href="#L525">525</a></th><td>     * Helper when we're rebuilding command lines.</td></tr><tr><th id="L526"><a href="#L526">526</a></th><td>     */</td></tr><tr><th id="L527"><a href="#L527">527</a></th><td>    toString: function() {</td></tr><tr><th id="L528"><a href="#L528">528</a></th><td>        return this.arg ? this.arg.toString() : '';</td></tr><tr><th id="L529"><a href="#L529">529</a></th><td>    }</td></tr><tr><th id="L530"><a href="#L530">530</a></th><td>};</td></tr><tr><th id="L531"><a href="#L531">531</a></th><td>exports.Assignment = Assignment;</td></tr><tr><th id="L532"><a href="#L532">532</a></th><td></td></tr><tr><th id="L533"><a href="#L533">533</a></th><td></td></tr><tr><th id="L534"><a href="#L534">534</a></th><td>/**</td></tr><tr><th id="L535"><a href="#L535">535</a></th><td> * This is a special parameter to reflect the command itself.</td></tr><tr><th id="L536"><a href="#L536">536</a></th><td> */</td></tr><tr><th id="L537"><a href="#L537">537</a></th><td>var commandParam = {</td></tr><tr><th id="L538"><a href="#L538">538</a></th><td>    name: '__command',</td></tr><tr><th id="L539"><a href="#L539">539</a></th><td>    type: 'command',</td></tr><tr><th id="L540"><a href="#L540">540</a></th><td>    description: 'The command to execute',</td></tr><tr><th id="L541"><a href="#L541">541</a></th><td></td></tr><tr><th id="L542"><a href="#L542">542</a></th><td>    /**</td></tr><tr><th id="L543"><a href="#L543">543</a></th><td>     * Provide some documentation for a command.</td></tr><tr><th id="L544"><a href="#L544">544</a></th><td>     */</td></tr><tr><th id="L545"><a href="#L545">545</a></th><td>    getCustomHint: function(command, arg) {</td></tr><tr><th id="L546"><a href="#L546">546</a></th><td>        var docs = [];</td></tr><tr><th id="L547"><a href="#L547">547</a></th><td>        docs.push('&lt;strong&gt;&lt;tt&gt; &amp;gt; ');</td></tr><tr><th id="L548"><a href="#L548">548</a></th><td>        docs.push(command.name);</td></tr><tr><th id="L549"><a href="#L549">549</a></th><td>        if (command.params &amp;&amp; command.params.length &gt; 0) {</td></tr><tr><th id="L550"><a href="#L550">550</a></th><td>            command.params.forEach(function(param) {</td></tr><tr><th id="L551"><a href="#L551">551</a></th><td>                if (param.defaultValue === undefined) {</td></tr><tr><th id="L552"><a href="#L552">552</a></th><td>                    docs.push(' [' + param.name + ']');</td></tr><tr><th id="L553"><a href="#L553">553</a></th><td>                }</td></tr><tr><th id="L554"><a href="#L554">554</a></th><td>                else {</td></tr><tr><th id="L555"><a href="#L555">555</a></th><td>                    docs.push(' &lt;em&gt;[' + param.name + ']&lt;/em&gt;');</td></tr><tr><th id="L556"><a href="#L556">556</a></th><td>                }</td></tr><tr><th id="L557"><a href="#L557">557</a></th><td>            }, this);</td></tr><tr><th id="L558"><a href="#L558">558</a></th><td>        }</td></tr><tr><th id="L559"><a href="#L559">559</a></th><td>        docs.push('&lt;/tt&gt;&lt;/strong&gt;&lt;br/&gt;');</td></tr><tr><th id="L560"><a href="#L560">560</a></th><td></td></tr><tr><th id="L561"><a href="#L561">561</a></th><td>        docs.push(command.description ? command.description : '(No description)');</td></tr><tr><th id="L562"><a href="#L562">562</a></th><td>        docs.push('&lt;br/&gt;');</td></tr><tr><th id="L563"><a href="#L563">563</a></th><td></td></tr><tr><th id="L564"><a href="#L564">564</a></th><td>        if (command.params &amp;&amp; command.params.length &gt; 0) {</td></tr><tr><th id="L565"><a href="#L565">565</a></th><td>            docs.push('&lt;ul&gt;');</td></tr><tr><th id="L566"><a href="#L566">566</a></th><td>            command.params.forEach(function(param) {</td></tr><tr><th id="L567"><a href="#L567">567</a></th><td>                docs.push('&lt;li&gt;');</td></tr><tr><th id="L568"><a href="#L568">568</a></th><td>                docs.push('&lt;strong&gt;&lt;tt&gt;' + param.name + '&lt;/tt&gt;&lt;/strong&gt;: ');</td></tr><tr><th id="L569"><a href="#L569">569</a></th><td>                docs.push(param.description ? param.description : '(No description)');</td></tr><tr><th id="L570"><a href="#L570">570</a></th><td>                if (param.defaultValue === undefined) {</td></tr><tr><th id="L571"><a href="#L571">571</a></th><td>                    docs.push(' &lt;em&gt;[Required]&lt;/em&gt;');</td></tr><tr><th id="L572"><a href="#L572">572</a></th><td>                }</td></tr><tr><th id="L573"><a href="#L573">573</a></th><td>                else if (param.defaultValue === null) {</td></tr><tr><th id="L574"><a href="#L574">574</a></th><td>                    docs.push(' &lt;em&gt;[Optional]&lt;/em&gt;');</td></tr><tr><th id="L575"><a href="#L575">575</a></th><td>                }</td></tr><tr><th id="L576"><a href="#L576">576</a></th><td>                else {</td></tr><tr><th id="L577"><a href="#L577">577</a></th><td>                    docs.push(' &lt;em&gt;[Default: ' + param.defaultValue + ']&lt;/em&gt;');</td></tr><tr><th id="L578"><a href="#L578">578</a></th><td>                }</td></tr><tr><th id="L579"><a href="#L579">579</a></th><td>                docs.push('&lt;/li&gt;');</td></tr><tr><th id="L580"><a href="#L580">580</a></th><td>            }, this);</td></tr><tr><th id="L581"><a href="#L581">581</a></th><td>            docs.push('&lt;/ul&gt;');</td></tr><tr><th id="L582"><a href="#L582">582</a></th><td>        }</td></tr><tr><th id="L583"><a href="#L583">583</a></th><td></td></tr><tr><th id="L584"><a href="#L584">584</a></th><td>        return new Hint(Status.VALID, docs.join(''), arg);</td></tr><tr><th id="L585"><a href="#L585">585</a></th><td>    }</td></tr><tr><th id="L586"><a href="#L586">586</a></th><td>};</td></tr><tr><th id="L587"><a href="#L587">587</a></th><td></td></tr><tr><th id="L588"><a href="#L588">588</a></th><td>/**</td></tr><tr><th id="L589"><a href="#L589">589</a></th><td> * A Requisition collects the information needed to execute a command.</td></tr><tr><th id="L590"><a href="#L590">590</a></th><td> * There is no point in a requisition for parameter-less commands because there</td></tr><tr><th id="L591"><a href="#L591">591</a></th><td> * is no information to collect. A Requisition is a collection of assignments</td></tr><tr><th id="L592"><a href="#L592">592</a></th><td> * of values to parameters, each handled by an instance of Assignment.</td></tr><tr><th id="L593"><a href="#L593">593</a></th><td> * CliRequisition adds functions for parsing input from a command line to this</td></tr><tr><th id="L594"><a href="#L594">594</a></th><td> * class.</td></tr><tr><th id="L595"><a href="#L595">595</a></th><td> * &lt;h2&gt;Events&lt;h2&gt;</td></tr><tr><th id="L596"><a href="#L596">596</a></th><td> * We publish the following events:&lt;ul&gt;</td></tr><tr><th id="L597"><a href="#L597">597</a></th><td> * &lt;li&gt;argumentChange: The text of some argument has changed. It is likely that</td></tr><tr><th id="L598"><a href="#L598">598</a></th><td> * any UI component displaying this argument will need to be updated. (Note that</td></tr><tr><th id="L599"><a href="#L599">599</a></th><td> * this event is actually published by the Argument itself - see the docs for</td></tr><tr><th id="L600"><a href="#L600">600</a></th><td> * Argument for more details)</td></tr><tr><th id="L601"><a href="#L601">601</a></th><td> * The event object looks like: { argument: A, oldText: B, text: B }</td></tr><tr><th id="L602"><a href="#L602">602</a></th><td> * &lt;li&gt;commandChange: The command has changed. It is likely that a UI</td></tr><tr><th id="L603"><a href="#L603">603</a></th><td> * structure will need updating to match the parameters of the new command.</td></tr><tr><th id="L604"><a href="#L604">604</a></th><td> * The event object looks like { command: A }</td></tr><tr><th id="L605"><a href="#L605">605</a></th><td> * @constructor</td></tr><tr><th id="L606"><a href="#L606">606</a></th><td> */</td></tr><tr><th id="L607"><a href="#L607">607</a></th><td>function Requisition(env) {</td></tr><tr><th id="L608"><a href="#L608">608</a></th><td>    this.env = env;</td></tr><tr><th id="L609"><a href="#L609">609</a></th><td>    this.commandAssignment = new Assignment(commandParam, this);</td></tr><tr><th id="L610"><a href="#L610">610</a></th><td>}</td></tr><tr><th id="L611"><a href="#L611">611</a></th><td></td></tr><tr><th id="L612"><a href="#L612">612</a></th><td>Requisition.prototype = {</td></tr><tr><th id="L613"><a href="#L613">613</a></th><td>    /**</td></tr><tr><th id="L614"><a href="#L614">614</a></th><td>     * The command that we are about to execute.</td></tr><tr><th id="L615"><a href="#L615">615</a></th><td>     * @see setCommandConversion()</td></tr><tr><th id="L616"><a href="#L616">616</a></th><td>     * @readonly</td></tr><tr><th id="L617"><a href="#L617">617</a></th><td>     */</td></tr><tr><th id="L618"><a href="#L618">618</a></th><td>    commandAssignment: undefined,</td></tr><tr><th id="L619"><a href="#L619">619</a></th><td></td></tr><tr><th id="L620"><a href="#L620">620</a></th><td>    /**</td></tr><tr><th id="L621"><a href="#L621">621</a></th><td>     * The count of assignments. Excludes the commandAssignment</td></tr><tr><th id="L622"><a href="#L622">622</a></th><td>     * @readonly</td></tr><tr><th id="L623"><a href="#L623">623</a></th><td>     */</td></tr><tr><th id="L624"><a href="#L624">624</a></th><td>    assignmentCount: undefined,</td></tr><tr><th id="L625"><a href="#L625">625</a></th><td></td></tr><tr><th id="L626"><a href="#L626">626</a></th><td>    /**</td></tr><tr><th id="L627"><a href="#L627">627</a></th><td>     * The object that stores of Assignment objects that we are filling out.</td></tr><tr><th id="L628"><a href="#L628">628</a></th><td>     * The Assignment objects are stored under their param.name for named</td></tr><tr><th id="L629"><a href="#L629">629</a></th><td>     * lookup. Note: We make use of the property of Javascript objects that</td></tr><tr><th id="L630"><a href="#L630">630</a></th><td>     * they are not just hashmaps, but linked-list hashmaps which iterate in</td></tr><tr><th id="L631"><a href="#L631">631</a></th><td>     * insertion order.</td></tr><tr><th id="L632"><a href="#L632">632</a></th><td>     * Excludes the commandAssignment.</td></tr><tr><th id="L633"><a href="#L633">633</a></th><td>     */</td></tr><tr><th id="L634"><a href="#L634">634</a></th><td>    _assignments: undefined,</td></tr><tr><th id="L635"><a href="#L635">635</a></th><td></td></tr><tr><th id="L636"><a href="#L636">636</a></th><td>    /**</td></tr><tr><th id="L637"><a href="#L637">637</a></th><td>     * The store of hints generated by the assignments. We are trying to prevent</td></tr><tr><th id="L638"><a href="#L638">638</a></th><td>     * the UI from needing to access this in broad form, but instead use</td></tr><tr><th id="L639"><a href="#L639">639</a></th><td>     * methods that query part of this structure.</td></tr><tr><th id="L640"><a href="#L640">640</a></th><td>     */</td></tr><tr><th id="L641"><a href="#L641">641</a></th><td>    _hints: undefined,</td></tr><tr><th id="L642"><a href="#L642">642</a></th><td></td></tr><tr><th id="L643"><a href="#L643">643</a></th><td>    /**</td></tr><tr><th id="L644"><a href="#L644">644</a></th><td>     * When the command changes, we need to keep a bunch of stuff in sync</td></tr><tr><th id="L645"><a href="#L645">645</a></th><td>     */</td></tr><tr><th id="L646"><a href="#L646">646</a></th><td>    _assignmentChanged: function(assignment) {</td></tr><tr><th id="L647"><a href="#L647">647</a></th><td>        // This is all about re-creating Assignments</td></tr><tr><th id="L648"><a href="#L648">648</a></th><td>        if (assignment.param.name !== '__command') {</td></tr><tr><th id="L649"><a href="#L649">649</a></th><td>            return;</td></tr><tr><th id="L650"><a href="#L650">650</a></th><td>        }</td></tr><tr><th id="L651"><a href="#L651">651</a></th><td></td></tr><tr><th id="L652"><a href="#L652">652</a></th><td>        this._assignments = {};</td></tr><tr><th id="L653"><a href="#L653">653</a></th><td></td></tr><tr><th id="L654"><a href="#L654">654</a></th><td>        if (assignment.value) {</td></tr><tr><th id="L655"><a href="#L655">655</a></th><td>            assignment.value.params.forEach(function(param) {</td></tr><tr><th id="L656"><a href="#L656">656</a></th><td>                this._assignments[param.name] = new Assignment(param, this);</td></tr><tr><th id="L657"><a href="#L657">657</a></th><td>            }, this);</td></tr><tr><th id="L658"><a href="#L658">658</a></th><td>        }</td></tr><tr><th id="L659"><a href="#L659">659</a></th><td></td></tr><tr><th id="L660"><a href="#L660">660</a></th><td>        this.assignmentCount = Object.keys(this._assignments).length;</td></tr><tr><th id="L661"><a href="#L661">661</a></th><td>        this._dispatchEvent('commandChange', { command: assignment.value });</td></tr><tr><th id="L662"><a href="#L662">662</a></th><td>    },</td></tr><tr><th id="L663"><a href="#L663">663</a></th><td></td></tr><tr><th id="L664"><a href="#L664">664</a></th><td>    /**</td></tr><tr><th id="L665"><a href="#L665">665</a></th><td>     * Assignments have an order, so we need to store them in an array.</td></tr><tr><th id="L666"><a href="#L666">666</a></th><td>     * But we also need named access ...</td></tr><tr><th id="L667"><a href="#L667">667</a></th><td>     */</td></tr><tr><th id="L668"><a href="#L668">668</a></th><td>    getAssignment: function(nameOrNumber) {</td></tr><tr><th id="L669"><a href="#L669">669</a></th><td>        var name = (typeof nameOrNumber === 'string') ?</td></tr><tr><th id="L670"><a href="#L670">670</a></th><td>            nameOrNumber :</td></tr><tr><th id="L671"><a href="#L671">671</a></th><td>            Object.keys(this._assignments)[nameOrNumber];</td></tr><tr><th id="L672"><a href="#L672">672</a></th><td>        return this._assignments[name];</td></tr><tr><th id="L673"><a href="#L673">673</a></th><td>    },</td></tr><tr><th id="L674"><a href="#L674">674</a></th><td></td></tr><tr><th id="L675"><a href="#L675">675</a></th><td>    /**</td></tr><tr><th id="L676"><a href="#L676">676</a></th><td>     * Where parameter name == assignment names - they are the same.</td></tr><tr><th id="L677"><a href="#L677">677</a></th><td>     */</td></tr><tr><th id="L678"><a href="#L678">678</a></th><td>    getParameterNames: function() {</td></tr><tr><th id="L679"><a href="#L679">679</a></th><td>        return Object.keys(this._assignments);</td></tr><tr><th id="L680"><a href="#L680">680</a></th><td>    },</td></tr><tr><th id="L681"><a href="#L681">681</a></th><td></td></tr><tr><th id="L682"><a href="#L682">682</a></th><td>    /**</td></tr><tr><th id="L683"><a href="#L683">683</a></th><td>     * A *shallow* clone of the assignments.</td></tr><tr><th id="L684"><a href="#L684">684</a></th><td>     * This is useful for systems that wish to go over all the assignments</td></tr><tr><th id="L685"><a href="#L685">685</a></th><td>     * finding values one way or another and wish to trim an array as they go.</td></tr><tr><th id="L686"><a href="#L686">686</a></th><td>     */</td></tr><tr><th id="L687"><a href="#L687">687</a></th><td>    cloneAssignments: function() {</td></tr><tr><th id="L688"><a href="#L688">688</a></th><td>        return Object.keys(this._assignments).map(function(name) {</td></tr><tr><th id="L689"><a href="#L689">689</a></th><td>            return this._assignments[name];</td></tr><tr><th id="L690"><a href="#L690">690</a></th><td>        }, this);</td></tr><tr><th id="L691"><a href="#L691">691</a></th><td>    },</td></tr><tr><th id="L692"><a href="#L692">692</a></th><td></td></tr><tr><th id="L693"><a href="#L693">693</a></th><td>    /**</td></tr><tr><th id="L694"><a href="#L694">694</a></th><td>     * Collect the statuses from the Assignments.</td></tr><tr><th id="L695"><a href="#L695">695</a></th><td>     * The hints returned are sorted by severity</td></tr><tr><th id="L696"><a href="#L696">696</a></th><td>     */</td></tr><tr><th id="L697"><a href="#L697">697</a></th><td>    _updateHints: function() {</td></tr><tr><th id="L698"><a href="#L698">698</a></th><td>        // TODO: work out when to clear this out for the plain Requisition case</td></tr><tr><th id="L699"><a href="#L699">699</a></th><td>        // this._hints = [];</td></tr><tr><th id="L700"><a href="#L700">700</a></th><td>        this.getAssignments(true).forEach(function(assignment) {</td></tr><tr><th id="L701"><a href="#L701">701</a></th><td>            this._hints.push(assignment.getHint());</td></tr><tr><th id="L702"><a href="#L702">702</a></th><td>        }, this);</td></tr><tr><th id="L703"><a href="#L703">703</a></th><td>        Hint.sort(this._hints);</td></tr><tr><th id="L704"><a href="#L704">704</a></th><td></td></tr><tr><th id="L705"><a href="#L705">705</a></th><td>        // We would like to put some initial help here, but for anyone but</td></tr><tr><th id="L706"><a href="#L706">706</a></th><td>        // a complete novice a 'type help' message is very annoying, so we</td></tr><tr><th id="L707"><a href="#L707">707</a></th><td>        // need to find a way to only display this message once, or for</td></tr><tr><th id="L708"><a href="#L708">708</a></th><td>        // until the user click a 'close' button or similar</td></tr><tr><th id="L709"><a href="#L709">709</a></th><td>        // TODO: Add special case for '' input</td></tr><tr><th id="L710"><a href="#L710">710</a></th><td>    },</td></tr><tr><th id="L711"><a href="#L711">711</a></th><td></td></tr><tr><th id="L712"><a href="#L712">712</a></th><td>    /**</td></tr><tr><th id="L713"><a href="#L713">713</a></th><td>     * Returns the most severe status</td></tr><tr><th id="L714"><a href="#L714">714</a></th><td>     */</td></tr><tr><th id="L715"><a href="#L715">715</a></th><td>    getWorstHint: function() {</td></tr><tr><th id="L716"><a href="#L716">716</a></th><td>        return this._hints[0];</td></tr><tr><th id="L717"><a href="#L717">717</a></th><td>    },</td></tr><tr><th id="L718"><a href="#L718">718</a></th><td></td></tr><tr><th id="L719"><a href="#L719">719</a></th><td>    /**</td></tr><tr><th id="L720"><a href="#L720">720</a></th><td>     * Extract the names and values of all the assignments, and return as</td></tr><tr><th id="L721"><a href="#L721">721</a></th><td>     * an object.</td></tr><tr><th id="L722"><a href="#L722">722</a></th><td>     */</td></tr><tr><th id="L723"><a href="#L723">723</a></th><td>    getArgsObject: function() {</td></tr><tr><th id="L724"><a href="#L724">724</a></th><td>        var args = {};</td></tr><tr><th id="L725"><a href="#L725">725</a></th><td>        this.getAssignments().forEach(function(assignment) {</td></tr><tr><th id="L726"><a href="#L726">726</a></th><td>            args[assignment.param.name] = assignment.value;</td></tr><tr><th id="L727"><a href="#L727">727</a></th><td>        }, this);</td></tr><tr><th id="L728"><a href="#L728">728</a></th><td>        return args;</td></tr><tr><th id="L729"><a href="#L729">729</a></th><td>    },</td></tr><tr><th id="L730"><a href="#L730">730</a></th><td></td></tr><tr><th id="L731"><a href="#L731">731</a></th><td>    /**</td></tr><tr><th id="L732"><a href="#L732">732</a></th><td>     * Access the arguments as an array.</td></tr><tr><th id="L733"><a href="#L733">733</a></th><td>     * @param includeCommand By default only the parameter arguments are</td></tr><tr><th id="L734"><a href="#L734">734</a></th><td>     * returned unless (includeCommand === true), in which case the list is</td></tr><tr><th id="L735"><a href="#L735">735</a></th><td>     * prepended with commandAssignment.arg</td></tr><tr><th id="L736"><a href="#L736">736</a></th><td>     */</td></tr><tr><th id="L737"><a href="#L737">737</a></th><td>    getAssignments: function(includeCommand) {</td></tr><tr><th id="L738"><a href="#L738">738</a></th><td>        var args = [];</td></tr><tr><th id="L739"><a href="#L739">739</a></th><td>        if (includeCommand === true) {</td></tr><tr><th id="L740"><a href="#L740">740</a></th><td>            args.push(this.commandAssignment);</td></tr><tr><th id="L741"><a href="#L741">741</a></th><td>        }</td></tr><tr><th id="L742"><a href="#L742">742</a></th><td>        Object.keys(this._assignments).forEach(function(name) {</td></tr><tr><th id="L743"><a href="#L743">743</a></th><td>            args.push(this.getAssignment(name));</td></tr><tr><th id="L744"><a href="#L744">744</a></th><td>        }, this);</td></tr><tr><th id="L745"><a href="#L745">745</a></th><td>        return args;</td></tr><tr><th id="L746"><a href="#L746">746</a></th><td>    },</td></tr><tr><th id="L747"><a href="#L747">747</a></th><td></td></tr><tr><th id="L748"><a href="#L748">748</a></th><td>    /**</td></tr><tr><th id="L749"><a href="#L749">749</a></th><td>     * Reset all the assignments to their default values</td></tr><tr><th id="L750"><a href="#L750">750</a></th><td>     */</td></tr><tr><th id="L751"><a href="#L751">751</a></th><td>    setDefaultValues: function() {</td></tr><tr><th id="L752"><a href="#L752">752</a></th><td>        this.getAssignments().forEach(function(assignment) {</td></tr><tr><th id="L753"><a href="#L753">753</a></th><td>            assignment.setValue(undefined);</td></tr><tr><th id="L754"><a href="#L754">754</a></th><td>        }, this);</td></tr><tr><th id="L755"><a href="#L755">755</a></th><td>    },</td></tr><tr><th id="L756"><a href="#L756">756</a></th><td></td></tr><tr><th id="L757"><a href="#L757">757</a></th><td>    /**</td></tr><tr><th id="L758"><a href="#L758">758</a></th><td>     * Helper to call canon.exec</td></tr><tr><th id="L759"><a href="#L759">759</a></th><td>     */</td></tr><tr><th id="L760"><a href="#L760">760</a></th><td>    exec: function() {</td></tr><tr><th id="L761"><a href="#L761">761</a></th><td>        canon.exec(this.commandAssignment.value,</td></tr><tr><th id="L762"><a href="#L762">762</a></th><td>              this.env,</td></tr><tr><th id="L763"><a href="#L763">763</a></th><td>              "cli",</td></tr><tr><th id="L764"><a href="#L764">764</a></th><td>              this.getArgsObject(),</td></tr><tr><th id="L765"><a href="#L765">765</a></th><td>              this.toCanonicalString());</td></tr><tr><th id="L766"><a href="#L766">766</a></th><td>    },</td></tr><tr><th id="L767"><a href="#L767">767</a></th><td></td></tr><tr><th id="L768"><a href="#L768">768</a></th><td>    /**</td></tr><tr><th id="L769"><a href="#L769">769</a></th><td>     * Extract a canonical version of the input</td></tr><tr><th id="L770"><a href="#L770">770</a></th><td>     */</td></tr><tr><th id="L771"><a href="#L771">771</a></th><td>    toCanonicalString: function() {</td></tr><tr><th id="L772"><a href="#L772">772</a></th><td>        var line = [];</td></tr><tr><th id="L773"><a href="#L773">773</a></th><td>        line.push(this.commandAssignment.value.name);</td></tr><tr><th id="L774"><a href="#L774">774</a></th><td>        Object.keys(this._assignments).forEach(function(name) {</td></tr><tr><th id="L775"><a href="#L775">775</a></th><td>            var assignment = this._assignments[name];</td></tr><tr><th id="L776"><a href="#L776">776</a></th><td>            var type = assignment.param.type;</td></tr><tr><th id="L777"><a href="#L777">777</a></th><td>            // TODO: This will cause problems if there is a non-default value</td></tr><tr><th id="L778"><a href="#L778">778</a></th><td>            // after a default value. Also we need to decide when to use</td></tr><tr><th id="L779"><a href="#L779">779</a></th><td>            // named parameters in place of positional params. Both can wait.</td></tr><tr><th id="L780"><a href="#L780">780</a></th><td>            if (assignment.value !== assignment.param.defaultValue) {</td></tr><tr><th id="L781"><a href="#L781">781</a></th><td>                line.push(' ');</td></tr><tr><th id="L782"><a href="#L782">782</a></th><td>                line.push(type.stringify(assignment.value));</td></tr><tr><th id="L783"><a href="#L783">783</a></th><td>            }</td></tr><tr><th id="L784"><a href="#L784">784</a></th><td>        }, this);</td></tr><tr><th id="L785"><a href="#L785">785</a></th><td>        return line.join('');</td></tr><tr><th id="L786"><a href="#L786">786</a></th><td>    }</td></tr><tr><th id="L787"><a href="#L787">787</a></th><td>};</td></tr><tr><th id="L788"><a href="#L788">788</a></th><td>oop.implement(Requisition.prototype, EventEmitter);</td></tr><tr><th id="L789"><a href="#L789">789</a></th><td>exports.Requisition = Requisition;</td></tr><tr><th id="L790"><a href="#L790">790</a></th><td></td></tr><tr><th id="L791"><a href="#L791">791</a></th><td></td></tr><tr><th id="L792"><a href="#L792">792</a></th><td>/**</td></tr><tr><th id="L793"><a href="#L793">793</a></th><td> * An object used during command line parsing to hold the various intermediate</td></tr><tr><th id="L794"><a href="#L794">794</a></th><td> * data steps.</td></tr><tr><th id="L795"><a href="#L795">795</a></th><td> * &lt;p&gt;The 'output' of the update is held in 2 objects: input.hints which is an</td></tr><tr><th id="L796"><a href="#L796">796</a></th><td> * array of hints to display to the user. In the future this will become a</td></tr><tr><th id="L797"><a href="#L797">797</a></th><td> * single value.</td></tr><tr><th id="L798"><a href="#L798">798</a></th><td> * &lt;p&gt;The other output value is input.requisition which gives access to an</td></tr><tr><th id="L799"><a href="#L799">799</a></th><td> * args object for use in executing the final command.</td></tr><tr><th id="L800"><a href="#L800">800</a></th><td> *</td></tr><tr><th id="L801"><a href="#L801">801</a></th><td> * &lt;p&gt;The majority of the functions in this class are called in sequence by the</td></tr><tr><th id="L802"><a href="#L802">802</a></th><td> * constructor. Their task is to add to &lt;tt&gt;hints&lt;/tt&gt; fill out the requisition.</td></tr><tr><th id="L803"><a href="#L803">803</a></th><td> * &lt;p&gt;The general sequence is:&lt;ul&gt;</td></tr><tr><th id="L804"><a href="#L804">804</a></th><td> * &lt;li&gt;_tokenize(): convert _typed into _parts</td></tr><tr><th id="L805"><a href="#L805">805</a></th><td> * &lt;li&gt;_split(): convert _parts into _command and _unparsedArgs</td></tr><tr><th id="L806"><a href="#L806">806</a></th><td> * &lt;li&gt;_assign(): convert _unparsedArgs into requisition</td></tr><tr><th id="L807"><a href="#L807">807</a></th><td> * &lt;/ul&gt;</td></tr><tr><th id="L808"><a href="#L808">808</a></th><td> *</td></tr><tr><th id="L809"><a href="#L809">809</a></th><td> * @param typed {string} The instruction as typed by the user so far</td></tr><tr><th id="L810"><a href="#L810">810</a></th><td> * @param options {object} A list of optional named parameters. Can be any of:</td></tr><tr><th id="L811"><a href="#L811">811</a></th><td> * &lt;b&gt;flags&lt;/b&gt;: Flags for us to check against the predicates specified with the</td></tr><tr><th id="L812"><a href="#L812">812</a></th><td> * commands. Defaulted to &lt;tt&gt;keyboard.buildFlags({ });&lt;/tt&gt;</td></tr><tr><th id="L813"><a href="#L813">813</a></th><td> * if not specified.</td></tr><tr><th id="L814"><a href="#L814">814</a></th><td> * @constructor</td></tr><tr><th id="L815"><a href="#L815">815</a></th><td> */</td></tr><tr><th id="L816"><a href="#L816">816</a></th><td>function CliRequisition(env, options) {</td></tr><tr><th id="L817"><a href="#L817">817</a></th><td>    Requisition.call(this, env);</td></tr><tr><th id="L818"><a href="#L818">818</a></th><td></td></tr><tr><th id="L819"><a href="#L819">819</a></th><td>    if (options &amp;&amp; options.flags) {</td></tr><tr><th id="L820"><a href="#L820">820</a></th><td>        /**</td></tr><tr><th id="L821"><a href="#L821">821</a></th><td>         * TODO: We were using a default of keyboard.buildFlags({ });</td></tr><tr><th id="L822"><a href="#L822">822</a></th><td>         * This allowed us to have commands that only existed in certain contexts</td></tr><tr><th id="L823"><a href="#L823">823</a></th><td>         * - i.e. Javascript specific commands.</td></tr><tr><th id="L824"><a href="#L824">824</a></th><td>         */</td></tr><tr><th id="L825"><a href="#L825">825</a></th><td>        this.flags = options.flags;</td></tr><tr><th id="L826"><a href="#L826">826</a></th><td>    }</td></tr><tr><th id="L827"><a href="#L827">827</a></th><td>}</td></tr><tr><th id="L828"><a href="#L828">828</a></th><td>oop.inherits(CliRequisition, Requisition);</td></tr><tr><th id="L829"><a href="#L829">829</a></th><td>(function() {</td></tr><tr><th id="L830"><a href="#L830">830</a></th><td>    /**</td></tr><tr><th id="L831"><a href="#L831">831</a></th><td>     * Called by the UI when ever the user interacts with a command line input</td></tr><tr><th id="L832"><a href="#L832">832</a></th><td>     * @param input A structure that details the state of the input field.</td></tr><tr><th id="L833"><a href="#L833">833</a></th><td>     * It should look something like: { typed:a, cursor: { start:b, end:c } }</td></tr><tr><th id="L834"><a href="#L834">834</a></th><td>     * Where a is the contents of the input field, and b and c are the start</td></tr><tr><th id="L835"><a href="#L835">835</a></th><td>     * and end of the cursor/selection respectively.</td></tr><tr><th id="L836"><a href="#L836">836</a></th><td>     */</td></tr><tr><th id="L837"><a href="#L837">837</a></th><td>    CliRequisition.prototype.update = function(input) {</td></tr><tr><th id="L838"><a href="#L838">838</a></th><td>        this.input = input;</td></tr><tr><th id="L839"><a href="#L839">839</a></th><td>        this._hints = [];</td></tr><tr><th id="L840"><a href="#L840">840</a></th><td></td></tr><tr><th id="L841"><a href="#L841">841</a></th><td>        var args = this._tokenize(input.typed);</td></tr><tr><th id="L842"><a href="#L842">842</a></th><td>        this._split(args);</td></tr><tr><th id="L843"><a href="#L843">843</a></th><td></td></tr><tr><th id="L844"><a href="#L844">844</a></th><td>        if (this.commandAssignment.value) {</td></tr><tr><th id="L845"><a href="#L845">845</a></th><td>            this._assign(args);</td></tr><tr><th id="L846"><a href="#L846">846</a></th><td>        }</td></tr><tr><th id="L847"><a href="#L847">847</a></th><td></td></tr><tr><th id="L848"><a href="#L848">848</a></th><td>        this._updateHints();</td></tr><tr><th id="L849"><a href="#L849">849</a></th><td>    };</td></tr><tr><th id="L850"><a href="#L850">850</a></th><td></td></tr><tr><th id="L851"><a href="#L851">851</a></th><td>    /**</td></tr><tr><th id="L852"><a href="#L852">852</a></th><td>     * Return an array of Status scores so we can create a marked up</td></tr><tr><th id="L853"><a href="#L853">853</a></th><td>     * version of the command line input.</td></tr><tr><th id="L854"><a href="#L854">854</a></th><td>     */</td></tr><tr><th id="L855"><a href="#L855">855</a></th><td>    CliRequisition.prototype.getInputStatusMarkup = function() {</td></tr><tr><th id="L856"><a href="#L856">856</a></th><td>        // 'scores' is an array which tells us what chars are errors</td></tr><tr><th id="L857"><a href="#L857">857</a></th><td>        // Initialize with everything VALID</td></tr><tr><th id="L858"><a href="#L858">858</a></th><td>        var scores = this.toString().split('').map(function(ch) {</td></tr><tr><th id="L859"><a href="#L859">859</a></th><td>            return Status.VALID;</td></tr><tr><th id="L860"><a href="#L860">860</a></th><td>        });</td></tr><tr><th id="L861"><a href="#L861">861</a></th><td>        // For all chars in all hints, check and upgrade the score</td></tr><tr><th id="L862"><a href="#L862">862</a></th><td>        this._hints.forEach(function(hint) {</td></tr><tr><th id="L863"><a href="#L863">863</a></th><td>            for (var i = hint.start; i &lt;= hint.end; i++) {</td></tr><tr><th id="L864"><a href="#L864">864</a></th><td>                if (hint.status &gt; scores[i]) {</td></tr><tr><th id="L865"><a href="#L865">865</a></th><td>                    scores[i] = hint.status;</td></tr><tr><th id="L866"><a href="#L866">866</a></th><td>                }</td></tr><tr><th id="L867"><a href="#L867">867</a></th><td>            }</td></tr><tr><th id="L868"><a href="#L868">868</a></th><td>        }, this);</td></tr><tr><th id="L869"><a href="#L869">869</a></th><td>        return scores;</td></tr><tr><th id="L870"><a href="#L870">870</a></th><td>    };</td></tr><tr><th id="L871"><a href="#L871">871</a></th><td></td></tr><tr><th id="L872"><a href="#L872">872</a></th><td>    /**</td></tr><tr><th id="L873"><a href="#L873">873</a></th><td>     * Reconstitute the input from the args</td></tr><tr><th id="L874"><a href="#L874">874</a></th><td>     */</td></tr><tr><th id="L875"><a href="#L875">875</a></th><td>    CliRequisition.prototype.toString = function() {</td></tr><tr><th id="L876"><a href="#L876">876</a></th><td>        return this.getAssignments(true).map(function(assignment) {</td></tr><tr><th id="L877"><a href="#L877">877</a></th><td>            return assignment.toString();</td></tr><tr><th id="L878"><a href="#L878">878</a></th><td>        }, this).join('');</td></tr><tr><th id="L879"><a href="#L879">879</a></th><td>    };</td></tr><tr><th id="L880"><a href="#L880">880</a></th><td></td></tr><tr><th id="L881"><a href="#L881">881</a></th><td>    var superUpdateHints = CliRequisition.prototype._updateHints;</td></tr><tr><th id="L882"><a href="#L882">882</a></th><td>    /**</td></tr><tr><th id="L883"><a href="#L883">883</a></th><td>     * Marks up hints in a number of ways:</td></tr><tr><th id="L884"><a href="#L884">884</a></th><td>     * - Makes INCOMPLETE hints that are not near the cursor INVALID since</td></tr><tr><th id="L885"><a href="#L885">885</a></th><td>     *   they can't be completed by typing</td></tr><tr><th id="L886"><a href="#L886">886</a></th><td>     * - Finds the most severe hint, and annotates the array with it</td></tr><tr><th id="L887"><a href="#L887">887</a></th><td>     * - Finds the hint to display, and also annotates the array with it</td></tr><tr><th id="L888"><a href="#L888">888</a></th><td>     * TODO: I'm wondering if array annotation is evil and we should replace</td></tr><tr><th id="L889"><a href="#L889">889</a></th><td>     * this with an object. Need to find out more.</td></tr><tr><th id="L890"><a href="#L890">890</a></th><td>     */</td></tr><tr><th id="L891"><a href="#L891">891</a></th><td>    CliRequisition.prototype._updateHints = function() {</td></tr><tr><th id="L892"><a href="#L892">892</a></th><td>        superUpdateHints.call(this);</td></tr><tr><th id="L893"><a href="#L893">893</a></th><td></td></tr><tr><th id="L894"><a href="#L894">894</a></th><td>        // Not knowing about cursor positioning, the requisition and assignments</td></tr><tr><th id="L895"><a href="#L895">895</a></th><td>        // can't know this, but anything they mark as INCOMPLETE is actually</td></tr><tr><th id="L896"><a href="#L896">896</a></th><td>        // INVALID unless the cursor is actually inside that argument.</td></tr><tr><th id="L897"><a href="#L897">897</a></th><td>        var c = this.input.cursor;</td></tr><tr><th id="L898"><a href="#L898">898</a></th><td>        this._hints.forEach(function(hint) {</td></tr><tr><th id="L899"><a href="#L899">899</a></th><td>            var startInHint = c.start &gt;= hint.start &amp;&amp; c.start &lt;= hint.end;</td></tr><tr><th id="L900"><a href="#L900">900</a></th><td>            var endInHint = c.end &gt;= hint.start &amp;&amp; c.end &lt;= hint.end;</td></tr><tr><th id="L901"><a href="#L901">901</a></th><td>            var inHint = startInHint || endInHint;</td></tr><tr><th id="L902"><a href="#L902">902</a></th><td>            if (!inHint &amp;&amp; hint.status === Status.INCOMPLETE) {</td></tr><tr><th id="L903"><a href="#L903">903</a></th><td>                 hint.status = Status.INVALID;</td></tr><tr><th id="L904"><a href="#L904">904</a></th><td>            }</td></tr><tr><th id="L905"><a href="#L905">905</a></th><td>        }, this);</td></tr><tr><th id="L906"><a href="#L906">906</a></th><td></td></tr><tr><th id="L907"><a href="#L907">907</a></th><td>        Hint.sort(this._hints);</td></tr><tr><th id="L908"><a href="#L908">908</a></th><td>    };</td></tr><tr><th id="L909"><a href="#L909">909</a></th><td></td></tr><tr><th id="L910"><a href="#L910">910</a></th><td>    /**</td></tr><tr><th id="L911"><a href="#L911">911</a></th><td>     * Accessor for the hints array.</td></tr><tr><th id="L912"><a href="#L912">912</a></th><td>     * While we could just use the hints property, using getHints() is</td></tr><tr><th id="L913"><a href="#L913">913</a></th><td>     * preferred for symmetry with Requisition where it needs a function due to</td></tr><tr><th id="L914"><a href="#L914">914</a></th><td>     * lack of an atomic update system.</td></tr><tr><th id="L915"><a href="#L915">915</a></th><td>     */</td></tr><tr><th id="L916"><a href="#L916">916</a></th><td>    CliRequisition.prototype.getHints = function() {</td></tr><tr><th id="L917"><a href="#L917">917</a></th><td>        return this._hints;</td></tr><tr><th id="L918"><a href="#L918">918</a></th><td>    };</td></tr><tr><th id="L919"><a href="#L919">919</a></th><td></td></tr><tr><th id="L920"><a href="#L920">920</a></th><td>    /**</td></tr><tr><th id="L921"><a href="#L921">921</a></th><td>     * Look through the arguments attached to our assignments for the assignment</td></tr><tr><th id="L922"><a href="#L922">922</a></th><td>     * at the given position.</td></tr><tr><th id="L923"><a href="#L923">923</a></th><td>     */</td></tr><tr><th id="L924"><a href="#L924">924</a></th><td>    CliRequisition.prototype.getAssignmentAt = function(position) {</td></tr><tr><th id="L925"><a href="#L925">925</a></th><td>        var assignments = this.getAssignments(true);</td></tr><tr><th id="L926"><a href="#L926">926</a></th><td>        for (var i = 0; i &lt; assignments.length; i++) {</td></tr><tr><th id="L927"><a href="#L927">927</a></th><td>            var assignment = assignments[i];</td></tr><tr><th id="L928"><a href="#L928">928</a></th><td>            if (!assignment.arg) {</td></tr><tr><th id="L929"><a href="#L929">929</a></th><td>                // There is no argument in this assignment, we've fallen off</td></tr><tr><th id="L930"><a href="#L930">930</a></th><td>                // the end of the obvious answers - it must be this one.</td></tr><tr><th id="L931"><a href="#L931">931</a></th><td>                return assignment;</td></tr><tr><th id="L932"><a href="#L932">932</a></th><td>            }</td></tr><tr><th id="L933"><a href="#L933">933</a></th><td>            if (assignment.isPositionCaptured(position)) {</td></tr><tr><th id="L934"><a href="#L934">934</a></th><td>                return assignment;</td></tr><tr><th id="L935"><a href="#L935">935</a></th><td>            }</td></tr><tr><th id="L936"><a href="#L936">936</a></th><td>        }</td></tr><tr><th id="L937"><a href="#L937">937</a></th><td></td></tr><tr><th id="L938"><a href="#L938">938</a></th><td>        return assignment;</td></tr><tr><th id="L939"><a href="#L939">939</a></th><td>    };</td></tr><tr><th id="L940"><a href="#L940">940</a></th><td></td></tr><tr><th id="L941"><a href="#L941">941</a></th><td>    /**</td></tr><tr><th id="L942"><a href="#L942">942</a></th><td>     * Split up the input taking into account ' and "</td></tr><tr><th id="L943"><a href="#L943">943</a></th><td>     */</td></tr><tr><th id="L944"><a href="#L944">944</a></th><td>    CliRequisition.prototype._tokenize = function(typed) {</td></tr><tr><th id="L945"><a href="#L945">945</a></th><td>        // For blank input, place a dummy empty argument into the list</td></tr><tr><th id="L946"><a href="#L946">946</a></th><td>        if (typed == null || typed.length === 0) {</td></tr><tr><th id="L947"><a href="#L947">947</a></th><td>            return [ new Argument(this, '', 0, 0, '', '') ];</td></tr><tr><th id="L948"><a href="#L948">948</a></th><td>        }</td></tr><tr><th id="L949"><a href="#L949">949</a></th><td></td></tr><tr><th id="L950"><a href="#L950">950</a></th><td>        var OUTSIDE = 1;     // The last character was whitespace</td></tr><tr><th id="L951"><a href="#L951">951</a></th><td>        var IN_SIMPLE = 2;   // The last character was part of a parameter</td></tr><tr><th id="L952"><a href="#L952">952</a></th><td>        var IN_SINGLE_Q = 3; // We're inside a single quote: '</td></tr><tr><th id="L953"><a href="#L953">953</a></th><td>        var IN_DOUBLE_Q = 4; // We're inside double quotes: "</td></tr><tr><th id="L954"><a href="#L954">954</a></th><td></td></tr><tr><th id="L955"><a href="#L955">955</a></th><td>        var mode = OUTSIDE;</td></tr><tr><th id="L956"><a href="#L956">956</a></th><td></td></tr><tr><th id="L957"><a href="#L957">957</a></th><td>        // First we un-escape. This list was taken from:</td></tr><tr><th id="L958"><a href="#L958">958</a></th><td>        // https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Core_Language_Features#Unicode</td></tr><tr><th id="L959"><a href="#L959">959</a></th><td>        // We are generally converting to their real values except for \', \"</td></tr><tr><th id="L960"><a href="#L960">960</a></th><td>        // and '\ ' which we are converting to unicode private characters so we</td></tr><tr><th id="L961"><a href="#L961">961</a></th><td>        // can distinguish them from ', " and ' ', which have special meaning.</td></tr><tr><th id="L962"><a href="#L962">962</a></th><td>        // They need swapping back post-split - see unescape2()</td></tr><tr><th id="L963"><a href="#L963">963</a></th><td>        typed = typed</td></tr><tr><th id="L964"><a href="#L964">964</a></th><td>                .replace(/\\\\/g, '\\')</td></tr><tr><th id="L965"><a href="#L965">965</a></th><td>                .replace(/\\b/g, '\b')</td></tr><tr><th id="L966"><a href="#L966">966</a></th><td>                .replace(/\\f/g, '\f')</td></tr><tr><th id="L967"><a href="#L967">967</a></th><td>                .replace(/\\n/g, '\n')</td></tr><tr><th id="L968"><a href="#L968">968</a></th><td>                .replace(/\\r/g, '\r')</td></tr><tr><th id="L969"><a href="#L969">969</a></th><td>                .replace(/\\t/g, '\t')</td></tr><tr><th id="L970"><a href="#L970">970</a></th><td>                .replace(/\\v/g, '\v')</td></tr><tr><th id="L971"><a href="#L971">971</a></th><td>                .replace(/\\n/g, '\n')</td></tr><tr><th id="L972"><a href="#L972">972</a></th><td>                .replace(/\\r/g, '\r')</td></tr><tr><th id="L973"><a href="#L973">973</a></th><td>                .replace(/\\ /g, '\uF000')</td></tr><tr><th id="L974"><a href="#L974">974</a></th><td>                .replace(/\\'/g, '\uF001')</td></tr><tr><th id="L975"><a href="#L975">975</a></th><td>                .replace(/\\"/g, '\uF002');</td></tr><tr><th id="L976"><a href="#L976">976</a></th><td></td></tr><tr><th id="L977"><a href="#L977">977</a></th><td>        function unescape2(str) {</td></tr><tr><th id="L978"><a href="#L978">978</a></th><td>            return str</td></tr><tr><th id="L979"><a href="#L979">979</a></th><td>                .replace(/\uF000/g, ' ')</td></tr><tr><th id="L980"><a href="#L980">980</a></th><td>                .replace(/\uF001/g, '\'')</td></tr><tr><th id="L981"><a href="#L981">981</a></th><td>                .replace(/\uF002/g, '"');</td></tr><tr><th id="L982"><a href="#L982">982</a></th><td>        }</td></tr><tr><th id="L983"><a href="#L983">983</a></th><td></td></tr><tr><th id="L984"><a href="#L984">984</a></th><td>        var i = 0;</td></tr><tr><th id="L985"><a href="#L985">985</a></th><td>        var start = 0; // Where did this section start?</td></tr><tr><th id="L986"><a href="#L986">986</a></th><td>        var prefix = '';</td></tr><tr><th id="L987"><a href="#L987">987</a></th><td>        var args = [];</td></tr><tr><th id="L988"><a href="#L988">988</a></th><td></td></tr><tr><th id="L989"><a href="#L989">989</a></th><td>        while (true) {</td></tr><tr><th id="L990"><a href="#L990">990</a></th><td>            if (i &gt;= typed.length) {</td></tr><tr><th id="L991"><a href="#L991">991</a></th><td>                // There is nothing else to read - tidy up</td></tr><tr><th id="L992"><a href="#L992">992</a></th><td>                if (mode !== OUTSIDE) {</td></tr><tr><th id="L993"><a href="#L993">993</a></th><td>                    var str = unescape2(typed.substring(start, i));</td></tr><tr><th id="L994"><a href="#L994">994</a></th><td>                    args.push(new Argument(this, str, start, i, prefix, ''));</td></tr><tr><th id="L995"><a href="#L995">995</a></th><td>                }</td></tr><tr><th id="L996"><a href="#L996">996</a></th><td>                else {</td></tr><tr><th id="L997"><a href="#L997">997</a></th><td>                    if (i !== start) {</td></tr><tr><th id="L998"><a href="#L998">998</a></th><td>                        // There's a bunch of whitespace at the end of the</td></tr><tr><th id="L999"><a href="#L999">999</a></th><td>                        // command add it to the last argument's suffix,</td></tr><tr><th id="L1000"><a href="#L1000">1000</a></th><td>                        // creating an empty argument if needed.</td></tr><tr><th id="L1001"><a href="#L1001">1001</a></th><td>                        var extra = typed.substring(start, i);</td></tr><tr><th id="L1002"><a href="#L1002">1002</a></th><td>                        var lastArg = args[args.length - 1];</td></tr><tr><th id="L1003"><a href="#L1003">1003</a></th><td>                        if (!lastArg) {</td></tr><tr><th id="L1004"><a href="#L1004">1004</a></th><td>                            lastArg = new Argument(this, '', i, i, extra, '');</td></tr><tr><th id="L1005"><a href="#L1005">1005</a></th><td>                            args.push(lastArg);</td></tr><tr><th id="L1006"><a href="#L1006">1006</a></th><td>                        }</td></tr><tr><th id="L1007"><a href="#L1007">1007</a></th><td>                        else {</td></tr><tr><th id="L1008"><a href="#L1008">1008</a></th><td>                            lastArg.suffix += extra;</td></tr><tr><th id="L1009"><a href="#L1009">1009</a></th><td>                        }</td></tr><tr><th id="L1010"><a href="#L1010">1010</a></th><td>                    }</td></tr><tr><th id="L1011"><a href="#L1011">1011</a></th><td>                }</td></tr><tr><th id="L1012"><a href="#L1012">1012</a></th><td>                break;</td></tr><tr><th id="L1013"><a href="#L1013">1013</a></th><td>            }</td></tr><tr><th id="L1014"><a href="#L1014">1014</a></th><td></td></tr><tr><th id="L1015"><a href="#L1015">1015</a></th><td>            var c = typed[i];</td></tr><tr><th id="L1016"><a href="#L1016">1016</a></th><td>            switch (mode) {</td></tr><tr><th id="L1017"><a href="#L1017">1017</a></th><td>                case OUTSIDE:</td></tr><tr><th id="L1018"><a href="#L1018">1018</a></th><td>                    if (c === '\'') {</td></tr><tr><th id="L1019"><a href="#L1019">1019</a></th><td>                        prefix = typed.substring(start, i + 1);</td></tr><tr><th id="L1020"><a href="#L1020">1020</a></th><td>                        mode = IN_SINGLE_Q;</td></tr><tr><th id="L1021"><a href="#L1021">1021</a></th><td>                        start = i + 1;</td></tr><tr><th id="L1022"><a href="#L1022">1022</a></th><td>                    }</td></tr><tr><th id="L1023"><a href="#L1023">1023</a></th><td>                    else if (c === '"') {</td></tr><tr><th id="L1024"><a href="#L1024">1024</a></th><td>                        prefix = typed.substring(start, i + 1);</td></tr><tr><th id="L1025"><a href="#L1025">1025</a></th><td>                        mode = IN_DOUBLE_Q;</td></tr><tr><th id="L1026"><a href="#L1026">1026</a></th><td>                        start = i + 1;</td></tr><tr><th id="L1027"><a href="#L1027">1027</a></th><td>                    }</td></tr><tr><th id="L1028"><a href="#L1028">1028</a></th><td>                    else if (/ /.test(c)) {</td></tr><tr><th id="L1029"><a href="#L1029">1029</a></th><td>                        // Still whitespace, do nothing</td></tr><tr><th id="L1030"><a href="#L1030">1030</a></th><td>                    }</td></tr><tr><th id="L1031"><a href="#L1031">1031</a></th><td>                    else {</td></tr><tr><th id="L1032"><a href="#L1032">1032</a></th><td>                        prefix = typed.substring(start, i);</td></tr><tr><th id="L1033"><a href="#L1033">1033</a></th><td>                        mode = IN_SIMPLE;</td></tr><tr><th id="L1034"><a href="#L1034">1034</a></th><td>                        start = i;</td></tr><tr><th id="L1035"><a href="#L1035">1035</a></th><td>                    }</td></tr><tr><th id="L1036"><a href="#L1036">1036</a></th><td>                    break;</td></tr><tr><th id="L1037"><a href="#L1037">1037</a></th><td></td></tr><tr><th id="L1038"><a href="#L1038">1038</a></th><td>                case IN_SIMPLE:</td></tr><tr><th id="L1039"><a href="#L1039">1039</a></th><td>                    // There is an edge case of xx'xx which we are assuming to</td></tr><tr><th id="L1040"><a href="#L1040">1040</a></th><td>                    // be a single parameter (and same with ")</td></tr><tr><th id="L1041"><a href="#L1041">1041</a></th><td>                    if (c === ' ') {</td></tr><tr><th id="L1042"><a href="#L1042">1042</a></th><td>                        var str = unescape2(typed.substring(start, i));</td></tr><tr><th id="L1043"><a href="#L1043">1043</a></th><td>                        args.push(new Argument(this, str,</td></tr><tr><th id="L1044"><a href="#L1044">1044</a></th><td>                                start, i, prefix, ''));</td></tr><tr><th id="L1045"><a href="#L1045">1045</a></th><td>                        mode = OUTSIDE;</td></tr><tr><th id="L1046"><a href="#L1046">1046</a></th><td>                        start = i;</td></tr><tr><th id="L1047"><a href="#L1047">1047</a></th><td>                        prefix = '';</td></tr><tr><th id="L1048"><a href="#L1048">1048</a></th><td>                    }</td></tr><tr><th id="L1049"><a href="#L1049">1049</a></th><td>                    break;</td></tr><tr><th id="L1050"><a href="#L1050">1050</a></th><td></td></tr><tr><th id="L1051"><a href="#L1051">1051</a></th><td>                case IN_SINGLE_Q:</td></tr><tr><th id="L1052"><a href="#L1052">1052</a></th><td>                    if (c === '\'') {</td></tr><tr><th id="L1053"><a href="#L1053">1053</a></th><td>                        var str = unescape2(typed.substring(start, i));</td></tr><tr><th id="L1054"><a href="#L1054">1054</a></th><td>                        args.push(new Argument(this, str,</td></tr><tr><th id="L1055"><a href="#L1055">1055</a></th><td>                                start - 1, i + 1, prefix, c));</td></tr><tr><th id="L1056"><a href="#L1056">1056</a></th><td>                        mode = OUTSIDE;</td></tr><tr><th id="L1057"><a href="#L1057">1057</a></th><td>                        start = i + 1;</td></tr><tr><th id="L1058"><a href="#L1058">1058</a></th><td>                        prefix = '';</td></tr><tr><th id="L1059"><a href="#L1059">1059</a></th><td>                    }</td></tr><tr><th id="L1060"><a href="#L1060">1060</a></th><td>                    break;</td></tr><tr><th id="L1061"><a href="#L1061">1061</a></th><td></td></tr><tr><th id="L1062"><a href="#L1062">1062</a></th><td>                case IN_DOUBLE_Q:</td></tr><tr><th id="L1063"><a href="#L1063">1063</a></th><td>                    if (c === '"') {</td></tr><tr><th id="L1064"><a href="#L1064">1064</a></th><td>                        var str = unescape2(typed.substring(start, i));</td></tr><tr><th id="L1065"><a href="#L1065">1065</a></th><td>                        args.push(new Argument(this, str,</td></tr><tr><th id="L1066"><a href="#L1066">1066</a></th><td>                                start - 1, i + 1, prefix, c));</td></tr><tr><th id="L1067"><a href="#L1067">1067</a></th><td>                        mode = OUTSIDE;</td></tr><tr><th id="L1068"><a href="#L1068">1068</a></th><td>                        start = i + 1;</td></tr><tr><th id="L1069"><a href="#L1069">1069</a></th><td>                        prefix = '';</td></tr><tr><th id="L1070"><a href="#L1070">1070</a></th><td>                    }</td></tr><tr><th id="L1071"><a href="#L1071">1071</a></th><td>                    break;</td></tr><tr><th id="L1072"><a href="#L1072">1072</a></th><td>            }</td></tr><tr><th id="L1073"><a href="#L1073">1073</a></th><td></td></tr><tr><th id="L1074"><a href="#L1074">1074</a></th><td>            i++;</td></tr><tr><th id="L1075"><a href="#L1075">1075</a></th><td>        }</td></tr><tr><th id="L1076"><a href="#L1076">1076</a></th><td></td></tr><tr><th id="L1077"><a href="#L1077">1077</a></th><td>        return args;</td></tr><tr><th id="L1078"><a href="#L1078">1078</a></th><td>    };</td></tr><tr><th id="L1079"><a href="#L1079">1079</a></th><td></td></tr><tr><th id="L1080"><a href="#L1080">1080</a></th><td>    /**</td></tr><tr><th id="L1081"><a href="#L1081">1081</a></th><td>     * Looks in the canon for a command extension that matches what has been</td></tr><tr><th id="L1082"><a href="#L1082">1082</a></th><td>     * typed at the command line.</td></tr><tr><th id="L1083"><a href="#L1083">1083</a></th><td>     */</td></tr><tr><th id="L1084"><a href="#L1084">1084</a></th><td>    CliRequisition.prototype._split = function(args) {</td></tr><tr><th id="L1085"><a href="#L1085">1085</a></th><td>        var argsUsed = 1;</td></tr><tr><th id="L1086"><a href="#L1086">1086</a></th><td>        var arg;</td></tr><tr><th id="L1087"><a href="#L1087">1087</a></th><td></td></tr><tr><th id="L1088"><a href="#L1088">1088</a></th><td>        while (argsUsed &lt;= args.length) {</td></tr><tr><th id="L1089"><a href="#L1089">1089</a></th><td>            var arg = Argument.merge(args, 0, argsUsed);</td></tr><tr><th id="L1090"><a href="#L1090">1090</a></th><td>            this.commandAssignment.setArgument(arg);</td></tr><tr><th id="L1091"><a href="#L1091">1091</a></th><td></td></tr><tr><th id="L1092"><a href="#L1092">1092</a></th><td>            if (!this.commandAssignment.value) {</td></tr><tr><th id="L1093"><a href="#L1093">1093</a></th><td>                // Not found. break with value == null</td></tr><tr><th id="L1094"><a href="#L1094">1094</a></th><td>                break;</td></tr><tr><th id="L1095"><a href="#L1095">1095</a></th><td>            }</td></tr><tr><th id="L1096"><a href="#L1096">1096</a></th><td></td></tr><tr><th id="L1097"><a href="#L1097">1097</a></th><td>            /*</td></tr><tr><th id="L1098"><a href="#L1098">1098</a></th><td>            // Previously we needed a way to hide commands depending context.</td></tr><tr><th id="L1099"><a href="#L1099">1099</a></th><td>            // We have not resurrected that feature yet.</td></tr><tr><th id="L1100"><a href="#L1100">1100</a></th><td>            if (!keyboard.flagsMatch(command.predicates, this.flags)) {</td></tr><tr><th id="L1101"><a href="#L1101">1101</a></th><td>                // If the predicates say 'no match' then go LA LA LA</td></tr><tr><th id="L1102"><a href="#L1102">1102</a></th><td>                command = null;</td></tr><tr><th id="L1103"><a href="#L1103">1103</a></th><td>                break;</td></tr><tr><th id="L1104"><a href="#L1104">1104</a></th><td>            }</td></tr><tr><th id="L1105"><a href="#L1105">1105</a></th><td>            */</td></tr><tr><th id="L1106"><a href="#L1106">1106</a></th><td></td></tr><tr><th id="L1107"><a href="#L1107">1107</a></th><td>            if (this.commandAssignment.value.exec) {</td></tr><tr><th id="L1108"><a href="#L1108">1108</a></th><td>                // Valid command, break with command valid</td></tr><tr><th id="L1109"><a href="#L1109">1109</a></th><td>                for (var i = 0; i &lt; argsUsed; i++) {</td></tr><tr><th id="L1110"><a href="#L1110">1110</a></th><td>                    args.shift();</td></tr><tr><th id="L1111"><a href="#L1111">1111</a></th><td>                }</td></tr><tr><th id="L1112"><a href="#L1112">1112</a></th><td>                break;</td></tr><tr><th id="L1113"><a href="#L1113">1113</a></th><td>            }</td></tr><tr><th id="L1114"><a href="#L1114">1114</a></th><td></td></tr><tr><th id="L1115"><a href="#L1115">1115</a></th><td>            argsUsed++;</td></tr><tr><th id="L1116"><a href="#L1116">1116</a></th><td>        }</td></tr><tr><th id="L1117"><a href="#L1117">1117</a></th><td>    };</td></tr><tr><th id="L1118"><a href="#L1118">1118</a></th><td></td></tr><tr><th id="L1119"><a href="#L1119">1119</a></th><td>    /**</td></tr><tr><th id="L1120"><a href="#L1120">1120</a></th><td>     * Work out which arguments are applicable to which parameters.</td></tr><tr><th id="L1121"><a href="#L1121">1121</a></th><td>     * &lt;p&gt;This takes #_command.params and #_unparsedArgs and creates a map of</td></tr><tr><th id="L1122"><a href="#L1122">1122</a></th><td>     * param names to 'assignment' objects, which have the following properties:</td></tr><tr><th id="L1123"><a href="#L1123">1123</a></th><td>     * &lt;ul&gt;</td></tr><tr><th id="L1124"><a href="#L1124">1124</a></th><td>     * &lt;li&gt;param - The matching parameter.</td></tr><tr><th id="L1125"><a href="#L1125">1125</a></th><td>     * &lt;li&gt;index - Zero based index into where the match came from on the input</td></tr><tr><th id="L1126"><a href="#L1126">1126</a></th><td>     * &lt;li&gt;value - The matching input</td></tr><tr><th id="L1127"><a href="#L1127">1127</a></th><td>     * &lt;/ul&gt;</td></tr><tr><th id="L1128"><a href="#L1128">1128</a></th><td>     */</td></tr><tr><th id="L1129"><a href="#L1129">1129</a></th><td>    CliRequisition.prototype._assign = function(args) {</td></tr><tr><th id="L1130"><a href="#L1130">1130</a></th><td>        if (args.length === 0) {</td></tr><tr><th id="L1131"><a href="#L1131">1131</a></th><td>            this.setDefaultValues();</td></tr><tr><th id="L1132"><a href="#L1132">1132</a></th><td>            return;</td></tr><tr><th id="L1133"><a href="#L1133">1133</a></th><td>        }</td></tr><tr><th id="L1134"><a href="#L1134">1134</a></th><td></td></tr><tr><th id="L1135"><a href="#L1135">1135</a></th><td>        // Create an error if the command does not take parameters, but we have</td></tr><tr><th id="L1136"><a href="#L1136">1136</a></th><td>        // been given them ...</td></tr><tr><th id="L1137"><a href="#L1137">1137</a></th><td>        if (this.assignmentCount === 0) {</td></tr><tr><th id="L1138"><a href="#L1138">1138</a></th><td>            // TODO: previously we were doing some extra work to avoid this if</td></tr><tr><th id="L1139"><a href="#L1139">1139</a></th><td>            // we determined that we had args that were all whitespace, but</td></tr><tr><th id="L1140"><a href="#L1140">1140</a></th><td>            // probably given our tighter tokenize() this won't be an issue?</td></tr><tr><th id="L1141"><a href="#L1141">1141</a></th><td>            this._hints.push(new Hint(Status.INVALID,</td></tr><tr><th id="L1142"><a href="#L1142">1142</a></th><td>                    this.commandAssignment.value.name +</td></tr><tr><th id="L1143"><a href="#L1143">1143</a></th><td>                    ' does not take any parameters',</td></tr><tr><th id="L1144"><a href="#L1144">1144</a></th><td>                    Argument.merge(args)));</td></tr><tr><th id="L1145"><a href="#L1145">1145</a></th><td>            return;</td></tr><tr><th id="L1146"><a href="#L1146">1146</a></th><td>        }</td></tr><tr><th id="L1147"><a href="#L1147">1147</a></th><td></td></tr><tr><th id="L1148"><a href="#L1148">1148</a></th><td>        // Special case: if there is only 1 parameter, and that's of type</td></tr><tr><th id="L1149"><a href="#L1149">1149</a></th><td>        // text we put all the params into the first param</td></tr><tr><th id="L1150"><a href="#L1150">1150</a></th><td>        if (this.assignmentCount === 1) {</td></tr><tr><th id="L1151"><a href="#L1151">1151</a></th><td>            var assignment = this.getAssignment(0);</td></tr><tr><th id="L1152"><a href="#L1152">1152</a></th><td>            if (assignment.param.type.name === 'text') {</td></tr><tr><th id="L1153"><a href="#L1153">1153</a></th><td>                assignment.setArgument(Argument.merge(args));</td></tr><tr><th id="L1154"><a href="#L1154">1154</a></th><td>                return;</td></tr><tr><th id="L1155"><a href="#L1155">1155</a></th><td>            }</td></tr><tr><th id="L1156"><a href="#L1156">1156</a></th><td>        }</td></tr><tr><th id="L1157"><a href="#L1157">1157</a></th><td></td></tr><tr><th id="L1158"><a href="#L1158">1158</a></th><td>        var assignments = this.cloneAssignments();</td></tr><tr><th id="L1159"><a href="#L1159">1159</a></th><td>        var names = this.getParameterNames();</td></tr><tr><th id="L1160"><a href="#L1160">1160</a></th><td></td></tr><tr><th id="L1161"><a href="#L1161">1161</a></th><td>        // Extract all the named parameters</td></tr><tr><th id="L1162"><a href="#L1162">1162</a></th><td>        var used = [];</td></tr><tr><th id="L1163"><a href="#L1163">1163</a></th><td>        assignments.forEach(function(assignment) {</td></tr><tr><th id="L1164"><a href="#L1164">1164</a></th><td>            var namedArgText = '--' + assignment.name;</td></tr><tr><th id="L1165"><a href="#L1165">1165</a></th><td></td></tr><tr><th id="L1166"><a href="#L1166">1166</a></th><td>            var i = 0;</td></tr><tr><th id="L1167"><a href="#L1167">1167</a></th><td>            while (true) {</td></tr><tr><th id="L1168"><a href="#L1168">1168</a></th><td>                var arg = args[i];</td></tr><tr><th id="L1169"><a href="#L1169">1169</a></th><td>                if (namedArgText !== arg.text) {</td></tr><tr><th id="L1170"><a href="#L1170">1170</a></th><td>                    i++;</td></tr><tr><th id="L1171"><a href="#L1171">1171</a></th><td>                    if (i &gt;= args.length) {</td></tr><tr><th id="L1172"><a href="#L1172">1172</a></th><td>                        break;</td></tr><tr><th id="L1173"><a href="#L1173">1173</a></th><td>                    }</td></tr><tr><th id="L1174"><a href="#L1174">1174</a></th><td>                    continue;</td></tr><tr><th id="L1175"><a href="#L1175">1175</a></th><td>                }</td></tr><tr><th id="L1176"><a href="#L1176">1176</a></th><td></td></tr><tr><th id="L1177"><a href="#L1177">1177</a></th><td>                // boolean parameters don't have values, default to false</td></tr><tr><th id="L1178"><a href="#L1178">1178</a></th><td>                if (assignment.param.type.name === 'boolean') {</td></tr><tr><th id="L1179"><a href="#L1179">1179</a></th><td>                    assignment.setValue(true);</td></tr><tr><th id="L1180"><a href="#L1180">1180</a></th><td>                }</td></tr><tr><th id="L1181"><a href="#L1181">1181</a></th><td>                else {</td></tr><tr><th id="L1182"><a href="#L1182">1182</a></th><td>                    if (i + 1 &lt; args.length) {</td></tr><tr><th id="L1183"><a href="#L1183">1183</a></th><td>                        // Missing value portion of this named param</td></tr><tr><th id="L1184"><a href="#L1184">1184</a></th><td>                        this._hints.push(new Hint(Status.INCOMPLETE,</td></tr><tr><th id="L1185"><a href="#L1185">1185</a></th><td>                                'Missing value for: ' + namedArgText,</td></tr><tr><th id="L1186"><a href="#L1186">1186</a></th><td>                                args[i]));</td></tr><tr><th id="L1187"><a href="#L1187">1187</a></th><td>                    }</td></tr><tr><th id="L1188"><a href="#L1188">1188</a></th><td>                    else {</td></tr><tr><th id="L1189"><a href="#L1189">1189</a></th><td>                        args.splice(i + 1, 1);</td></tr><tr><th id="L1190"><a href="#L1190">1190</a></th><td>                        assignment.setArgument(args[i + 1]);</td></tr><tr><th id="L1191"><a href="#L1191">1191</a></th><td>                    }</td></tr><tr><th id="L1192"><a href="#L1192">1192</a></th><td>                }</td></tr><tr><th id="L1193"><a href="#L1193">1193</a></th><td></td></tr><tr><th id="L1194"><a href="#L1194">1194</a></th><td>                lang.arrayRemove(names, assignment.name);</td></tr><tr><th id="L1195"><a href="#L1195">1195</a></th><td>                args.splice(i, 1);</td></tr><tr><th id="L1196"><a href="#L1196">1196</a></th><td>                // We don't need to i++ if we splice</td></tr><tr><th id="L1197"><a href="#L1197">1197</a></th><td>            }</td></tr><tr><th id="L1198"><a href="#L1198">1198</a></th><td>        }, this);</td></tr><tr><th id="L1199"><a href="#L1199">1199</a></th><td></td></tr><tr><th id="L1200"><a href="#L1200">1200</a></th><td>        // What's left are positional parameters assign in order</td></tr><tr><th id="L1201"><a href="#L1201">1201</a></th><td>        names.forEach(function(name) {</td></tr><tr><th id="L1202"><a href="#L1202">1202</a></th><td>            var assignment = this.getAssignment(name);</td></tr><tr><th id="L1203"><a href="#L1203">1203</a></th><td>            if (args.length === 0) {</td></tr><tr><th id="L1204"><a href="#L1204">1204</a></th><td>                // No more values</td></tr><tr><th id="L1205"><a href="#L1205">1205</a></th><td>                assignment.setValue(undefined); // i.e. default</td></tr><tr><th id="L1206"><a href="#L1206">1206</a></th><td>            }</td></tr><tr><th id="L1207"><a href="#L1207">1207</a></th><td>            else {</td></tr><tr><th id="L1208"><a href="#L1208">1208</a></th><td>                var arg = args[0];</td></tr><tr><th id="L1209"><a href="#L1209">1209</a></th><td>                args.splice(0, 1);</td></tr><tr><th id="L1210"><a href="#L1210">1210</a></th><td>                assignment.setArgument(arg);</td></tr><tr><th id="L1211"><a href="#L1211">1211</a></th><td>            }</td></tr><tr><th id="L1212"><a href="#L1212">1212</a></th><td>        }, this);</td></tr><tr><th id="L1213"><a href="#L1213">1213</a></th><td></td></tr><tr><th id="L1214"><a href="#L1214">1214</a></th><td>        if (args.length &gt; 0) {</td></tr><tr><th id="L1215"><a href="#L1215">1215</a></th><td>            var remaining = Argument.merge(args);</td></tr><tr><th id="L1216"><a href="#L1216">1216</a></th><td>            this._hints.push(new Hint(Status.INVALID,</td></tr><tr><th id="L1217"><a href="#L1217">1217</a></th><td>                    'Input \'' + remaining.text + '\' makes no sense.',</td></tr><tr><th id="L1218"><a href="#L1218">1218</a></th><td>                    remaining));</td></tr><tr><th id="L1219"><a href="#L1219">1219</a></th><td>        }</td></tr><tr><th id="L1220"><a href="#L1220">1220</a></th><td>    };</td></tr><tr><th id="L1221"><a href="#L1221">1221</a></th><td></td></tr><tr><th id="L1222"><a href="#L1222">1222</a></th><td>})();</td></tr><tr><th id="L1223"><a href="#L1223">1223</a></th><td>exports.CliRequisition = CliRequisition;</td></tr><tr><th id="L1224"><a href="#L1224">1224</a></th><td></td></tr><tr><th id="L1225"><a href="#L1225">1225</a></th><td></td></tr><tr><th id="L1226"><a href="#L1226">1226</a></th><td>});</td></tr><tr><th id="L1227"><a href="#L1227">1227</a></th><td>/* ***** BEGIN LICENSE BLOCK *****</td></tr><tr><th id="L1228"><a href="#L1228">1228</a></th><td> * Version: MPL 1.1/GPL 2.0/LGPL 2.1</td></tr><tr><th id="L1229"><a href="#L1229">1229</a></th><td> *</td></tr><tr><th id="L1230"><a href="#L1230">1230</a></th><td> * The contents of this file are subject to the Mozilla Public License Version</td></tr><tr><th id="L1231"><a href="#L1231">1231</a></th><td> * 1.1 (the "License"); you may not use this file except in compliance with</td></tr><tr><th id="L1232"><a href="#L1232">1232</a></th><td> * the License. You may obtain a copy of the License at</td></tr><tr><th id="L1233"><a href="#L1233">1233</a></th><td> * http://www.mozilla.org/MPL/</td></tr><tr><th id="L1234"><a href="#L1234">1234</a></th><td> *</td></tr><tr><th id="L1235"><a href="#L1235">1235</a></th><td> * Software distributed under the License is distributed on an "AS IS" basis,</td></tr><tr><th id="L1236"><a href="#L1236">1236</a></th><td> * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</td></tr><tr><th id="L1237"><a href="#L1237">1237</a></th><td> * for the specific language governing rights and limitations under the</td></tr><tr><th id="L1238"><a href="#L1238">1238</a></th><td> * License.</td></tr><tr><th id="L1239"><a href="#L1239">1239</a></th><td> *</td></tr><tr><th id="L1240"><a href="#L1240">1240</a></th><td> * The Original Code is Mozilla Skywriter.</td></tr><tr><th id="L1241"><a href="#L1241">1241</a></th><td> *</td></tr><tr><th id="L1242"><a href="#L1242">1242</a></th><td> * The Initial Developer of the Original Code is</td></tr><tr><th id="L1243"><a href="#L1243">1243</a></th><td> * Mozilla.</td></tr><tr><th id="L1244"><a href="#L1244">1244</a></th><td> * Portions created by the Initial Developer are Copyright (C) 2009</td></tr><tr><th id="L1245"><a href="#L1245">1245</a></th><td> * the Initial Developer. All Rights Reserved.</td></tr><tr><th id="L1246"><a href="#L1246">1246</a></th><td> *</td></tr><tr><th id="L1247"><a href="#L1247">1247</a></th><td> * Contributor(s):</td></tr><tr><th id="L1248"><a href="#L1248">1248</a></th><td> *   Joe Walker (jwalker@mozilla.com)</td></tr><tr><th id="L1249"><a href="#L1249">1249</a></th><td> *</td></tr><tr><th id="L1250"><a href="#L1250">1250</a></th><td> * Alternatively, the contents of this file may be used under the terms of</td></tr><tr><th id="L1251"><a href="#L1251">1251</a></th><td> * either the GNU General Public License Version 2 or later (the "GPL"), or</td></tr><tr><th id="L1252"><a href="#L1252">1252</a></th><td> * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),</td></tr><tr><th id="L1253"><a href="#L1253">1253</a></th><td> * in which case the provisions of the GPL or the LGPL are applicable instead</td></tr><tr><th id="L1254"><a href="#L1254">1254</a></th><td> * of those above. If you wish to allow use of your version of this file only</td></tr><tr><th id="L1255"><a href="#L1255">1255</a></th><td> * under the terms of either the GPL or the LGPL, and not to allow others to</td></tr><tr><th id="L1256"><a href="#L1256">1256</a></th><td> * use your version of this file under the terms of the MPL, indicate your</td></tr><tr><th id="L1257"><a href="#L1257">1257</a></th><td> * decision by deleting the provisions above and replace them with the notice</td></tr><tr><th id="L1258"><a href="#L1258">1258</a></th><td> * and other provisions required by the GPL or the LGPL. If you do not delete</td></tr><tr><th id="L1259"><a href="#L1259">1259</a></th><td> * the provisions above, a recipient may use your version of this file under</td></tr><tr><th id="L1260"><a href="#L1260">1260</a></th><td> * the terms of any one of the MPL, the GPL or the LGPL.</td></tr><tr><th id="L1261"><a href="#L1261">1261</a></th><td> *</td></tr><tr><th id="L1262"><a href="#L1262">1262</a></th><td> * ***** END LICENSE BLOCK ***** */</td></tr><tr><th id="L1263"><a href="#L1263">1263</a></th><td></td></tr><tr><th id="L1264"><a href="#L1264">1264</a></th><td>define('cockpit/ui/settings', ['require', 'exports', 'module' , 'pilot/types', 'pilot/types/basic'], function(require, exports, module) {</td></tr><tr><th id="L1265"><a href="#L1265">1265</a></th><td></td></tr><tr><th id="L1266"><a href="#L1266">1266</a></th><td></td></tr><tr><th id="L1267"><a href="#L1267">1267</a></th><td>var types = require("pilot/types");</td></tr><tr><th id="L1268"><a href="#L1268">1268</a></th><td>var SelectionType = require('pilot/types/basic').SelectionType;</td></tr><tr><th id="L1269"><a href="#L1269">1269</a></th><td></td></tr><tr><th id="L1270"><a href="#L1270">1270</a></th><td>var direction = new SelectionType({</td></tr><tr><th id="L1271"><a href="#L1271">1271</a></th><td>    name: 'direction',</td></tr><tr><th id="L1272"><a href="#L1272">1272</a></th><td>    data: [ 'above', 'below' ]</td></tr><tr><th id="L1273"><a href="#L1273">1273</a></th><td>});</td></tr><tr><th id="L1274"><a href="#L1274">1274</a></th><td></td></tr><tr><th id="L1275"><a href="#L1275">1275</a></th><td>var hintDirectionSetting = {</td></tr><tr><th id="L1276"><a href="#L1276">1276</a></th><td>    name: "hintDirection",</td></tr><tr><th id="L1277"><a href="#L1277">1277</a></th><td>    description: "Are hints shown above or below the command line?",</td></tr><tr><th id="L1278"><a href="#L1278">1278</a></th><td>    type: "direction",</td></tr><tr><th id="L1279"><a href="#L1279">1279</a></th><td>    defaultValue: "above"</td></tr><tr><th id="L1280"><a href="#L1280">1280</a></th><td>};</td></tr><tr><th id="L1281"><a href="#L1281">1281</a></th><td></td></tr><tr><th id="L1282"><a href="#L1282">1282</a></th><td>var outputDirectionSetting = {</td></tr><tr><th id="L1283"><a href="#L1283">1283</a></th><td>    name: "outputDirection",</td></tr><tr><th id="L1284"><a href="#L1284">1284</a></th><td>    description: "Is the output window shown above or below the command line?",</td></tr><tr><th id="L1285"><a href="#L1285">1285</a></th><td>    type: "direction",</td></tr><tr><th id="L1286"><a href="#L1286">1286</a></th><td>    defaultValue: "above"</td></tr><tr><th id="L1287"><a href="#L1287">1287</a></th><td>};</td></tr><tr><th id="L1288"><a href="#L1288">1288</a></th><td></td></tr><tr><th id="L1289"><a href="#L1289">1289</a></th><td>var outputHeightSetting = {</td></tr><tr><th id="L1290"><a href="#L1290">1290</a></th><td>    name: "outputHeight",</td></tr><tr><th id="L1291"><a href="#L1291">1291</a></th><td>    description: "What height should the output panel be?",</td></tr><tr><th id="L1292"><a href="#L1292">1292</a></th><td>    type: "number",</td></tr><tr><th id="L1293"><a href="#L1293">1293</a></th><td>    defaultValue: 300</td></tr><tr><th id="L1294"><a href="#L1294">1294</a></th><td>};</td></tr><tr><th id="L1295"><a href="#L1295">1295</a></th><td></td></tr><tr><th id="L1296"><a href="#L1296">1296</a></th><td>exports.startup = function(data, reason) {</td></tr><tr><th id="L1297"><a href="#L1297">1297</a></th><td>    types.registerType(direction);</td></tr><tr><th id="L1298"><a href="#L1298">1298</a></th><td>    data.env.settings.addSetting(hintDirectionSetting);</td></tr><tr><th id="L1299"><a href="#L1299">1299</a></th><td>    data.env.settings.addSetting(outputDirectionSetting);</td></tr><tr><th id="L1300"><a href="#L1300">1300</a></th><td>    data.env.settings.addSetting(outputHeightSetting);</td></tr><tr><th id="L1301"><a href="#L1301">1301</a></th><td>};</td></tr><tr><th id="L1302"><a href="#L1302">1302</a></th><td></td></tr><tr><th id="L1303"><a href="#L1303">1303</a></th><td>exports.shutdown = function(data, reason) {</td></tr><tr><th id="L1304"><a href="#L1304">1304</a></th><td>    types.unregisterType(direction);</td></tr><tr><th id="L1305"><a href="#L1305">1305</a></th><td>    data.env.settings.removeSetting(hintDirectionSetting);</td></tr><tr><th id="L1306"><a href="#L1306">1306</a></th><td>    data.env.settings.removeSetting(outputDirectionSetting);</td></tr><tr><th id="L1307"><a href="#L1307">1307</a></th><td>    data.env.settings.removeSetting(outputHeightSetting);</td></tr><tr><th id="L1308"><a href="#L1308">1308</a></th><td>};</td></tr><tr><th id="L1309"><a href="#L1309">1309</a></th><td></td></tr><tr><th id="L1310"><a href="#L1310">1310</a></th><td></td></tr><tr><th id="L1311"><a href="#L1311">1311</a></th><td>});</td></tr><tr><th id="L1312"><a href="#L1312">1312</a></th><td>/* ***** BEGIN LICENSE BLOCK *****</td></tr><tr><th id="L1313"><a href="#L1313">1313</a></th><td> * Version: MPL 1.1/GPL 2.0/LGPL 2.1</td></tr><tr><th id="L1314"><a href="#L1314">1314</a></th><td> *</td></tr><tr><th id="L1315"><a href="#L1315">1315</a></th><td> * The contents of this file are subject to the Mozilla Public License Version</td></tr><tr><th id="L1316"><a href="#L1316">1316</a></th><td> * 1.1 (the "License"); you may not use this file except in compliance with</td></tr><tr><th id="L1317"><a href="#L1317">1317</a></th><td> * the License. You may obtain a copy of the License at</td></tr><tr><th id="L1318"><a href="#L1318">1318</a></th><td> * http://www.mozilla.org/MPL/</td></tr><tr><th id="L1319"><a href="#L1319">1319</a></th><td> *</td></tr><tr><th id="L1320"><a href="#L1320">1320</a></th><td> * Software distributed under the License is distributed on an "AS IS" basis,</td></tr><tr><th id="L1321"><a href="#L1321">1321</a></th><td> * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</td></tr><tr><th id="L1322"><a href="#L1322">1322</a></th><td> * for the specific language governing rights and limitations under the</td></tr><tr><th id="L1323"><a href="#L1323">1323</a></th><td> * License.</td></tr><tr><th id="L1324"><a href="#L1324">1324</a></th><td> *</td></tr><tr><th id="L1325"><a href="#L1325">1325</a></th><td> * The Original Code is Skywriter.</td></tr><tr><th id="L1326"><a href="#L1326">1326</a></th><td> *</td></tr><tr><th id="L1327"><a href="#L1327">1327</a></th><td> * The Initial Developer of the Original Code is</td></tr><tr><th id="L1328"><a href="#L1328">1328</a></th><td> * Mozilla.</td></tr><tr><th id="L1329"><a href="#L1329">1329</a></th><td> * Portions created by the Initial Developer are Copyright (C) 2009</td></tr><tr><th id="L1330"><a href="#L1330">1330</a></th><td> * the Initial Developer. All Rights Reserved.</td></tr><tr><th id="L1331"><a href="#L1331">1331</a></th><td> *</td></tr><tr><th id="L1332"><a href="#L1332">1332</a></th><td> * Contributor(s):</td></tr><tr><th id="L1333"><a href="#L1333">1333</a></th><td> *   Joe Walker (jwalker@mozilla.com)</td></tr><tr><th id="L1334"><a href="#L1334">1334</a></th><td> *</td></tr><tr><th id="L1335"><a href="#L1335">1335</a></th><td> * Alternatively, the contents of this file may be used under the terms of</td></tr><tr><th id="L1336"><a href="#L1336">1336</a></th><td> * either the GNU General Public License Version 2 or later (the "GPL"), or</td></tr><tr><th id="L1337"><a href="#L1337">1337</a></th><td> * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),</td></tr><tr><th id="L1338"><a href="#L1338">1338</a></th><td> * in which case the provisions of the GPL or the LGPL are applicable instead</td></tr><tr><th id="L1339"><a href="#L1339">1339</a></th><td> * of those above. If you wish to allow use of your version of this file only</td></tr><tr><th id="L1340"><a href="#L1340">1340</a></th><td> * under the terms of either the GPL or the LGPL, and not to allow others to</td></tr><tr><th id="L1341"><a href="#L1341">1341</a></th><td> * use your version of this file under the terms of the MPL, indicate your</td></tr><tr><th id="L1342"><a href="#L1342">1342</a></th><td> * decision by deleting the provisions above and replace them with the notice</td></tr><tr><th id="L1343"><a href="#L1343">1343</a></th><td> * and other provisions required by the GPL or the LGPL. If you do not delete</td></tr><tr><th id="L1344"><a href="#L1344">1344</a></th><td> * the provisions above, a recipient may use your version of this file under</td></tr><tr><th id="L1345"><a href="#L1345">1345</a></th><td> * the terms of any one of the MPL, the GPL or the LGPL.</td></tr><tr><th id="L1346"><a href="#L1346">1346</a></th><td> *</td></tr><tr><th id="L1347"><a href="#L1347">1347</a></th><td> * ***** END LICENSE BLOCK ***** */</td></tr><tr><th id="L1348"><a href="#L1348">1348</a></th><td></td></tr><tr><th id="L1349"><a href="#L1349">1349</a></th><td>define('cockpit/ui/cli_view', ['require', 'exports', 'module' , 'text!cockpit/ui/cli_view.css', 'pilot/event', 'pilot/dom', 'pilot/keys', 'pilot/canon', 'pilot/types', 'cockpit/cli', 'cockpit/ui/request_view'], function(require, exports, module) {</td></tr><tr><th id="L1350"><a href="#L1350">1350</a></th><td></td></tr><tr><th id="L1351"><a href="#L1351">1351</a></th><td></td></tr><tr><th id="L1352"><a href="#L1352">1352</a></th><td>var editorCss = require("text!cockpit/ui/cli_view.css");</td></tr><tr><th id="L1353"><a href="#L1353">1353</a></th><td>var event = require("pilot/event");</td></tr><tr><th id="L1354"><a href="#L1354">1354</a></th><td>var dom = require("pilot/dom");</td></tr><tr><th id="L1355"><a href="#L1355">1355</a></th><td></td></tr><tr><th id="L1356"><a href="#L1356">1356</a></th><td>dom.importCssString(editorCss);</td></tr><tr><th id="L1357"><a href="#L1357">1357</a></th><td></td></tr><tr><th id="L1358"><a href="#L1358">1358</a></th><td>var event = require("pilot/event");</td></tr><tr><th id="L1359"><a href="#L1359">1359</a></th><td>var keys = require("pilot/keys");</td></tr><tr><th id="L1360"><a href="#L1360">1360</a></th><td>var canon = require("pilot/canon");</td></tr><tr><th id="L1361"><a href="#L1361">1361</a></th><td>var Status = require('pilot/types').Status;</td></tr><tr><th id="L1362"><a href="#L1362">1362</a></th><td></td></tr><tr><th id="L1363"><a href="#L1363">1363</a></th><td>var CliRequisition = require('cockpit/cli').CliRequisition;</td></tr><tr><th id="L1364"><a href="#L1364">1364</a></th><td>var Hint = require('cockpit/cli').Hint;</td></tr><tr><th id="L1365"><a href="#L1365">1365</a></th><td>var RequestView = require('cockpit/ui/request_view').RequestView;</td></tr><tr><th id="L1366"><a href="#L1366">1366</a></th><td></td></tr><tr><th id="L1367"><a href="#L1367">1367</a></th><td>var NO_HINT = new Hint(Status.VALID, '', 0, 0);</td></tr><tr><th id="L1368"><a href="#L1368">1368</a></th><td></td></tr><tr><th id="L1369"><a href="#L1369">1369</a></th><td>/**</td></tr><tr><th id="L1370"><a href="#L1370">1370</a></th><td> * On startup we need to:</td></tr><tr><th id="L1371"><a href="#L1371">1371</a></th><td> * 1. Add 3 sets of elements to the DOM for:</td></tr><tr><th id="L1372"><a href="#L1372">1372</a></th><td> * - command line output</td></tr><tr><th id="L1373"><a href="#L1373">1373</a></th><td> * - input hints</td></tr><tr><th id="L1374"><a href="#L1374">1374</a></th><td> * - completion</td></tr><tr><th id="L1375"><a href="#L1375">1375</a></th><td> * 2. Attach a set of events so the command line works</td></tr><tr><th id="L1376"><a href="#L1376">1376</a></th><td> */</td></tr><tr><th id="L1377"><a href="#L1377">1377</a></th><td>exports.startup = function(data, reason) {</td></tr><tr><th id="L1378"><a href="#L1378">1378</a></th><td>    var cli = new CliRequisition(data.env);</td></tr><tr><th id="L1379"><a href="#L1379">1379</a></th><td>    var cliView = new CliView(cli, data.env);</td></tr><tr><th id="L1380"><a href="#L1380">1380</a></th><td>    data.env.cli = cli;</td></tr><tr><th id="L1381"><a href="#L1381">1381</a></th><td>};</td></tr><tr><th id="L1382"><a href="#L1382">1382</a></th><td></td></tr><tr><th id="L1383"><a href="#L1383">1383</a></th><td>/**</td></tr><tr><th id="L1384"><a href="#L1384">1384</a></th><td> * A class to handle the simplest UI implementation</td></tr><tr><th id="L1385"><a href="#L1385">1385</a></th><td> */</td></tr><tr><th id="L1386"><a href="#L1386">1386</a></th><td>function CliView(cli, env) {</td></tr><tr><th id="L1387"><a href="#L1387">1387</a></th><td>    cli.cliView = this;</td></tr><tr><th id="L1388"><a href="#L1388">1388</a></th><td>    this.cli = cli;</td></tr><tr><th id="L1389"><a href="#L1389">1389</a></th><td>    this.doc = document;</td></tr><tr><th id="L1390"><a href="#L1390">1390</a></th><td>    this.win = dom.getParentWindow(this.doc);</td></tr><tr><th id="L1391"><a href="#L1391">1391</a></th><td>    this.env = env;</td></tr><tr><th id="L1392"><a href="#L1392">1392</a></th><td></td></tr><tr><th id="L1393"><a href="#L1393">1393</a></th><td>    // TODO: we should have a better way to specify command lines???</td></tr><tr><th id="L1394"><a href="#L1394">1394</a></th><td>    this.element = this.doc.getElementById('cockpitInput');</td></tr><tr><th id="L1395"><a href="#L1395">1395</a></th><td>    if (!this.element) {</td></tr><tr><th id="L1396"><a href="#L1396">1396</a></th><td>        // console.log('No element with an id of cockpit. Bailing on cli');</td></tr><tr><th id="L1397"><a href="#L1397">1397</a></th><td>        return;</td></tr><tr><th id="L1398"><a href="#L1398">1398</a></th><td>    }</td></tr><tr><th id="L1399"><a href="#L1399">1399</a></th><td></td></tr><tr><th id="L1400"><a href="#L1400">1400</a></th><td>    this.settings = env.settings;</td></tr><tr><th id="L1401"><a href="#L1401">1401</a></th><td>    this.hintDirection = this.settings.getSetting('hintDirection');</td></tr><tr><th id="L1402"><a href="#L1402">1402</a></th><td>    this.outputDirection = this.settings.getSetting('outputDirection');</td></tr><tr><th id="L1403"><a href="#L1403">1403</a></th><td>    this.outputHeight = this.settings.getSetting('outputHeight');</td></tr><tr><th id="L1404"><a href="#L1404">1404</a></th><td></td></tr><tr><th id="L1405"><a href="#L1405">1405</a></th><td>    // If the requisition tells us something has changed, we use this to know</td></tr><tr><th id="L1406"><a href="#L1406">1406</a></th><td>    // if we should ignore it</td></tr><tr><th id="L1407"><a href="#L1407">1407</a></th><td>    this.isUpdating = false;</td></tr><tr><th id="L1408"><a href="#L1408">1408</a></th><td></td></tr><tr><th id="L1409"><a href="#L1409">1409</a></th><td>    this.createElements();</td></tr><tr><th id="L1410"><a href="#L1410">1410</a></th><td>    this.update();</td></tr><tr><th id="L1411"><a href="#L1411">1411</a></th><td>}</td></tr><tr><th id="L1412"><a href="#L1412">1412</a></th><td>CliView.prototype = {</td></tr><tr><th id="L1413"><a href="#L1413">1413</a></th><td>    /**</td></tr><tr><th id="L1414"><a href="#L1414">1414</a></th><td>     * Create divs for completion, hints and output</td></tr><tr><th id="L1415"><a href="#L1415">1415</a></th><td>     */</td></tr><tr><th id="L1416"><a href="#L1416">1416</a></th><td>    createElements: function() {</td></tr><tr><th id="L1417"><a href="#L1417">1417</a></th><td>        var input = this.element;</td></tr><tr><th id="L1418"><a href="#L1418">1418</a></th><td></td></tr><tr><th id="L1419"><a href="#L1419">1419</a></th><td>        this.element.spellcheck = false;</td></tr><tr><th id="L1420"><a href="#L1420">1420</a></th><td></td></tr><tr><th id="L1421"><a href="#L1421">1421</a></th><td>        this.output = this.doc.getElementById('cockpitOutput');</td></tr><tr><th id="L1422"><a href="#L1422">1422</a></th><td>        this.popupOutput = (this.output == null);</td></tr><tr><th id="L1423"><a href="#L1423">1423</a></th><td>        if (!this.output) {</td></tr><tr><th id="L1424"><a href="#L1424">1424</a></th><td>            this.output = this.doc.createElement('div');</td></tr><tr><th id="L1425"><a href="#L1425">1425</a></th><td>            this.output.id = 'cockpitOutput';</td></tr><tr><th id="L1426"><a href="#L1426">1426</a></th><td>            this.output.className = 'cptOutput';</td></tr><tr><th id="L1427"><a href="#L1427">1427</a></th><td>            input.parentNode.insertBefore(this.output, input.nextSibling);</td></tr><tr><th id="L1428"><a href="#L1428">1428</a></th><td></td></tr><tr><th id="L1429"><a href="#L1429">1429</a></th><td>            var setMaxOutputHeight = function() {</td></tr><tr><th id="L1430"><a href="#L1430">1430</a></th><td>                this.output.style.maxHeight = this.outputHeight.get() + 'px';</td></tr><tr><th id="L1431"><a href="#L1431">1431</a></th><td>            }.bind(this);</td></tr><tr><th id="L1432"><a href="#L1432">1432</a></th><td>            this.outputHeight.addEventListener('change', setMaxOutputHeight);</td></tr><tr><th id="L1433"><a href="#L1433">1433</a></th><td>            setMaxOutputHeight();</td></tr><tr><th id="L1434"><a href="#L1434">1434</a></th><td>        }</td></tr><tr><th id="L1435"><a href="#L1435">1435</a></th><td></td></tr><tr><th id="L1436"><a href="#L1436">1436</a></th><td>        this.completer = this.doc.createElement('div');</td></tr><tr><th id="L1437"><a href="#L1437">1437</a></th><td>        this.completer.className = 'cptCompletion VALID';</td></tr><tr><th id="L1438"><a href="#L1438">1438</a></th><td></td></tr><tr><th id="L1439"><a href="#L1439">1439</a></th><td>        this.completer.style.color = dom.computedStyle(input, "color");</td></tr><tr><th id="L1440"><a href="#L1440">1440</a></th><td>        this.completer.style.fontSize = dom.computedStyle(input, "fontSize");</td></tr><tr><th id="L1441"><a href="#L1441">1441</a></th><td>        this.completer.style.fontFamily = dom.computedStyle(input, "fontFamily");</td></tr><tr><th id="L1442"><a href="#L1442">1442</a></th><td>        this.completer.style.fontWeight = dom.computedStyle(input, "fontWeight");</td></tr><tr><th id="L1443"><a href="#L1443">1443</a></th><td>        this.completer.style.fontStyle = dom.computedStyle(input, "fontStyle");</td></tr><tr><th id="L1444"><a href="#L1444">1444</a></th><td>        input.parentNode.insertBefore(this.completer, input.nextSibling);</td></tr><tr><th id="L1445"><a href="#L1445">1445</a></th><td></td></tr><tr><th id="L1446"><a href="#L1446">1446</a></th><td>        // Transfer background styling to the completer.</td></tr><tr><th id="L1447"><a href="#L1447">1447</a></th><td>        this.completer.style.backgroundColor = input.style.backgroundColor;</td></tr><tr><th id="L1448"><a href="#L1448">1448</a></th><td>        input.style.backgroundColor = 'transparent';</td></tr><tr><th id="L1449"><a href="#L1449">1449</a></th><td></td></tr><tr><th id="L1450"><a href="#L1450">1450</a></th><td>        this.hinter = this.doc.createElement('div');</td></tr><tr><th id="L1451"><a href="#L1451">1451</a></th><td>        this.hinter.className = 'cptHints';</td></tr><tr><th id="L1452"><a href="#L1452">1452</a></th><td>        input.parentNode.insertBefore(this.hinter, input.nextSibling);</td></tr><tr><th id="L1453"><a href="#L1453">1453</a></th><td></td></tr><tr><th id="L1454"><a href="#L1454">1454</a></th><td>        var resizer = this.resizer.bind(this);</td></tr><tr><th id="L1455"><a href="#L1455">1455</a></th><td>        event.addListener(this.win, 'resize', resizer);</td></tr><tr><th id="L1456"><a href="#L1456">1456</a></th><td>        this.hintDirection.addEventListener('change', resizer);</td></tr><tr><th id="L1457"><a href="#L1457">1457</a></th><td>        this.outputDirection.addEventListener('change', resizer);</td></tr><tr><th id="L1458"><a href="#L1458">1458</a></th><td>        resizer();</td></tr><tr><th id="L1459"><a href="#L1459">1459</a></th><td></td></tr><tr><th id="L1460"><a href="#L1460">1460</a></th><td>        canon.addEventListener('output',  function(ev) {</td></tr><tr><th id="L1461"><a href="#L1461">1461</a></th><td>            new RequestView(ev.request, this);</td></tr><tr><th id="L1462"><a href="#L1462">1462</a></th><td>        }.bind(this));</td></tr><tr><th id="L1463"><a href="#L1463">1463</a></th><td>        event.addCommandKeyListener(input, this.onCommandKey.bind(this));</td></tr><tr><th id="L1464"><a href="#L1464">1464</a></th><td>        event.addListener(input, 'keyup', this.onKeyUp.bind(this));</td></tr><tr><th id="L1465"><a href="#L1465">1465</a></th><td></td></tr><tr><th id="L1466"><a href="#L1466">1466</a></th><td>        // cursor position affects hint severity. TODO: shortcuts for speed</td></tr><tr><th id="L1467"><a href="#L1467">1467</a></th><td>        event.addListener(input, 'mouseup', function(ev) {</td></tr><tr><th id="L1468"><a href="#L1468">1468</a></th><td>            this.isUpdating = true;</td></tr><tr><th id="L1469"><a href="#L1469">1469</a></th><td>            this.update();</td></tr><tr><th id="L1470"><a href="#L1470">1470</a></th><td>            this.isUpdating = false;</td></tr><tr><th id="L1471"><a href="#L1471">1471</a></th><td>        }.bind(this));</td></tr><tr><th id="L1472"><a href="#L1472">1472</a></th><td></td></tr><tr><th id="L1473"><a href="#L1473">1473</a></th><td>        this.cli.addEventListener('argumentChange', this.onArgChange.bind(this));</td></tr><tr><th id="L1474"><a href="#L1474">1474</a></th><td></td></tr><tr><th id="L1475"><a href="#L1475">1475</a></th><td>        event.addListener(input, "focus", function() {</td></tr><tr><th id="L1476"><a href="#L1476">1476</a></th><td>            dom.addCssClass(this.output, "cptFocusPopup");</td></tr><tr><th id="L1477"><a href="#L1477">1477</a></th><td>            dom.addCssClass(this.hinter, "cptFocusPopup");</td></tr><tr><th id="L1478"><a href="#L1478">1478</a></th><td>        }.bind(this));</td></tr><tr><th id="L1479"><a href="#L1479">1479</a></th><td></td></tr><tr><th id="L1480"><a href="#L1480">1480</a></th><td>        function hideOutput() {</td></tr><tr><th id="L1481"><a href="#L1481">1481</a></th><td>            dom.removeCssClass(this.output, "cptFocusPopup");</td></tr><tr><th id="L1482"><a href="#L1482">1482</a></th><td>            dom.removeCssClass(this.hinter, "cptFocusPopup");</td></tr><tr><th id="L1483"><a href="#L1483">1483</a></th><td>        };</td></tr><tr><th id="L1484"><a href="#L1484">1484</a></th><td>        event.addListener(input, "blur", hideOutput.bind(this));</td></tr><tr><th id="L1485"><a href="#L1485">1485</a></th><td>        hideOutput.call(this);</td></tr><tr><th id="L1486"><a href="#L1486">1486</a></th><td>    },</td></tr><tr><th id="L1487"><a href="#L1487">1487</a></th><td></td></tr><tr><th id="L1488"><a href="#L1488">1488</a></th><td>    /**</td></tr><tr><th id="L1489"><a href="#L1489">1489</a></th><td>     * We need to see the output of the latest command entered</td></tr><tr><th id="L1490"><a href="#L1490">1490</a></th><td>     */</td></tr><tr><th id="L1491"><a href="#L1491">1491</a></th><td>    scrollOutputToBottom: function() {</td></tr><tr><th id="L1492"><a href="#L1492">1492</a></th><td>        // Certain browsers have a bug such that scrollHeight is too small</td></tr><tr><th id="L1493"><a href="#L1493">1493</a></th><td>        // when content does not fill the client area of the element</td></tr><tr><th id="L1494"><a href="#L1494">1494</a></th><td>        var scrollHeight = Math.max(this.output.scrollHeight, this.output.clientHeight);</td></tr><tr><th id="L1495"><a href="#L1495">1495</a></th><td>        this.output.scrollTop = scrollHeight - this.output.clientHeight;</td></tr><tr><th id="L1496"><a href="#L1496">1496</a></th><td>    },</td></tr><tr><th id="L1497"><a href="#L1497">1497</a></th><td></td></tr><tr><th id="L1498"><a href="#L1498">1498</a></th><td>    /**</td></tr><tr><th id="L1499"><a href="#L1499">1499</a></th><td>     * To be called on window resize or any time we want to align the elements</td></tr><tr><th id="L1500"><a href="#L1500">1500</a></th><td>     * with the input box.</td></tr><tr><th id="L1501"><a href="#L1501">1501</a></th><td>     */</td></tr><tr><th id="L1502"><a href="#L1502">1502</a></th><td>    resizer: function() {</td></tr><tr><th id="L1503"><a href="#L1503">1503</a></th><td>        var rect = this.element.getClientRects()[0];</td></tr><tr><th id="L1504"><a href="#L1504">1504</a></th><td></td></tr><tr><th id="L1505"><a href="#L1505">1505</a></th><td>        this.completer.style.top = rect.top + 'px';</td></tr><tr><th id="L1506"><a href="#L1506">1506</a></th><td>        var height = rect.bottom - rect.top;</td></tr><tr><th id="L1507"><a href="#L1507">1507</a></th><td>        this.completer.style.height = height + 'px';</td></tr><tr><th id="L1508"><a href="#L1508">1508</a></th><td>        this.completer.style.lineHeight = height + 'px';</td></tr><tr><th id="L1509"><a href="#L1509">1509</a></th><td>        this.completer.style.left = rect.left + 'px';</td></tr><tr><th id="L1510"><a href="#L1510">1510</a></th><td>        var width = rect.right - rect.left;</td></tr><tr><th id="L1511"><a href="#L1511">1511</a></th><td>        this.completer.style.width = width + 'px';</td></tr><tr><th id="L1512"><a href="#L1512">1512</a></th><td></td></tr><tr><th id="L1513"><a href="#L1513">1513</a></th><td>        if (this.hintDirection.get() === 'below') {</td></tr><tr><th id="L1514"><a href="#L1514">1514</a></th><td>            this.hinter.style.top = rect.bottom + 'px';</td></tr><tr><th id="L1515"><a href="#L1515">1515</a></th><td>            this.hinter.style.bottom = 'auto';</td></tr><tr><th id="L1516"><a href="#L1516">1516</a></th><td>        }</td></tr><tr><th id="L1517"><a href="#L1517">1517</a></th><td>        else {</td></tr><tr><th id="L1518"><a href="#L1518">1518</a></th><td>            this.hinter.style.top = 'auto';</td></tr><tr><th id="L1519"><a href="#L1519">1519</a></th><td>            this.hinter.style.bottom = (this.doc.documentElement.clientHeight - rect.top) + 'px';</td></tr><tr><th id="L1520"><a href="#L1520">1520</a></th><td>        }</td></tr><tr><th id="L1521"><a href="#L1521">1521</a></th><td>        this.hinter.style.left = (rect.left + 30) + 'px';</td></tr><tr><th id="L1522"><a href="#L1522">1522</a></th><td>        this.hinter.style.maxWidth = (width - 110) + 'px';</td></tr><tr><th id="L1523"><a href="#L1523">1523</a></th><td></td></tr><tr><th id="L1524"><a href="#L1524">1524</a></th><td>        if (this.popupOutput) {</td></tr><tr><th id="L1525"><a href="#L1525">1525</a></th><td>            if (this.outputDirection.get() === 'below') {</td></tr><tr><th id="L1526"><a href="#L1526">1526</a></th><td>                this.output.style.top = rect.bottom + 'px';</td></tr><tr><th id="L1527"><a href="#L1527">1527</a></th><td>                this.output.style.bottom = 'auto';</td></tr><tr><th id="L1528"><a href="#L1528">1528</a></th><td>            }</td></tr><tr><th id="L1529"><a href="#L1529">1529</a></th><td>            else {</td></tr><tr><th id="L1530"><a href="#L1530">1530</a></th><td>                this.output.style.top = 'auto';</td></tr><tr><th id="L1531"><a href="#L1531">1531</a></th><td>                this.output.style.bottom = (this.doc.documentElement.clientHeight - rect.top) + 'px';</td></tr><tr><th id="L1532"><a href="#L1532">1532</a></th><td>            }</td></tr><tr><th id="L1533"><a href="#L1533">1533</a></th><td>            this.output.style.left = rect.left + 'px';</td></tr><tr><th id="L1534"><a href="#L1534">1534</a></th><td>            this.output.style.width = (width - 80) + 'px';</td></tr><tr><th id="L1535"><a href="#L1535">1535</a></th><td>        }</td></tr><tr><th id="L1536"><a href="#L1536">1536</a></th><td>    },</td></tr><tr><th id="L1537"><a href="#L1537">1537</a></th><td></td></tr><tr><th id="L1538"><a href="#L1538">1538</a></th><td>    /**</td></tr><tr><th id="L1539"><a href="#L1539">1539</a></th><td>     * Ensure that TAB isn't handled by the browser</td></tr><tr><th id="L1540"><a href="#L1540">1540</a></th><td>     */</td></tr><tr><th id="L1541"><a href="#L1541">1541</a></th><td>onCommandKey: function(ev, hashId, keyCode) {</td></tr><tr><th id="L1542"><a href="#L1542">1542</a></th><td>        var stopEvent;</td></tr><tr><th id="L1543"><a href="#L1543">1543</a></th><td>        if (keyCode === keys.TAB ||</td></tr><tr><th id="L1544"><a href="#L1544">1544</a></th><td>                keyCode === keys.UP ||</td></tr><tr><th id="L1545"><a href="#L1545">1545</a></th><td>                keyCode === keys.DOWN) {</td></tr><tr><th id="L1546"><a href="#L1546">1546</a></th><td>            stopEvent = true;</td></tr><tr><th id="L1547"><a href="#L1547">1547</a></th><td>        } else if (hashId != 0 || keyCode != 0) {</td></tr><tr><th id="L1548"><a href="#L1548">1548</a></th><td>            stopEvent = canon.execKeyCommand(this.env, 'cli', hashId, keyCode);</td></tr><tr><th id="L1549"><a href="#L1549">1549</a></th><td>        }</td></tr><tr><th id="L1550"><a href="#L1550">1550</a></th><td>        stopEvent &amp;&amp; event.stopEvent(ev);</td></tr><tr><th id="L1551"><a href="#L1551">1551</a></th><td>    },</td></tr><tr><th id="L1552"><a href="#L1552">1552</a></th><td></td></tr><tr><th id="L1553"><a href="#L1553">1553</a></th><td>    /**</td></tr><tr><th id="L1554"><a href="#L1554">1554</a></th><td>     * The main keyboard processing loop</td></tr><tr><th id="L1555"><a href="#L1555">1555</a></th><td>     */</td></tr><tr><th id="L1556"><a href="#L1556">1556</a></th><td>    onKeyUp: function(ev) {</td></tr><tr><th id="L1557"><a href="#L1557">1557</a></th><td>        var handled;</td></tr><tr><th id="L1558"><a href="#L1558">1558</a></th><td>        /*</td></tr><tr><th id="L1559"><a href="#L1559">1559</a></th><td>        var handled = keyboardManager.processKeyEvent(ev, this, {</td></tr><tr><th id="L1560"><a href="#L1560">1560</a></th><td>            isCommandLine: true, isKeyUp: true</td></tr><tr><th id="L1561"><a href="#L1561">1561</a></th><td>        });</td></tr><tr><th id="L1562"><a href="#L1562">1562</a></th><td>        */</td></tr><tr><th id="L1563"><a href="#L1563">1563</a></th><td></td></tr><tr><th id="L1564"><a href="#L1564">1564</a></th><td>        // RETURN does a special exec/highlight thing</td></tr><tr><th id="L1565"><a href="#L1565">1565</a></th><td>        if (ev.keyCode === keys.RETURN) {</td></tr><tr><th id="L1566"><a href="#L1566">1566</a></th><td>            var worst = this.cli.getWorstHint();</td></tr><tr><th id="L1567"><a href="#L1567">1567</a></th><td>            // Deny RETURN unless the command might work</td></tr><tr><th id="L1568"><a href="#L1568">1568</a></th><td>            if (worst.status === Status.VALID) {</td></tr><tr><th id="L1569"><a href="#L1569">1569</a></th><td>                this.cli.exec();</td></tr><tr><th id="L1570"><a href="#L1570">1570</a></th><td>                this.element.value = '';</td></tr><tr><th id="L1571"><a href="#L1571">1571</a></th><td>            }</td></tr><tr><th id="L1572"><a href="#L1572">1572</a></th><td>            else {</td></tr><tr><th id="L1573"><a href="#L1573">1573</a></th><td>                // If we've denied RETURN because the command was not VALID,</td></tr><tr><th id="L1574"><a href="#L1574">1574</a></th><td>                // select the part of the command line that is causing problems</td></tr><tr><th id="L1575"><a href="#L1575">1575</a></th><td>                // TODO: if there are 2 errors are we picking the right one?</td></tr><tr><th id="L1576"><a href="#L1576">1576</a></th><td>                dom.setSelectionStart(this.element, worst.start);</td></tr><tr><th id="L1577"><a href="#L1577">1577</a></th><td>                dom.setSelectionEnd(this.element, worst.end);</td></tr><tr><th id="L1578"><a href="#L1578">1578</a></th><td>            }</td></tr><tr><th id="L1579"><a href="#L1579">1579</a></th><td>        }</td></tr><tr><th id="L1580"><a href="#L1580">1580</a></th><td></td></tr><tr><th id="L1581"><a href="#L1581">1581</a></th><td>        this.update();</td></tr><tr><th id="L1582"><a href="#L1582">1582</a></th><td></td></tr><tr><th id="L1583"><a href="#L1583">1583</a></th><td>        // Special actions which delegate to the assignment</td></tr><tr><th id="L1584"><a href="#L1584">1584</a></th><td>        var current = this.cli.getAssignmentAt(dom.getSelectionStart(this.element));</td></tr><tr><th id="L1585"><a href="#L1585">1585</a></th><td>        if (current) {</td></tr><tr><th id="L1586"><a href="#L1586">1586</a></th><td>            // TAB does a special complete thing</td></tr><tr><th id="L1587"><a href="#L1587">1587</a></th><td>            if (ev.keyCode === keys.TAB) {</td></tr><tr><th id="L1588"><a href="#L1588">1588</a></th><td>                current.complete();</td></tr><tr><th id="L1589"><a href="#L1589">1589</a></th><td>                this.update();</td></tr><tr><th id="L1590"><a href="#L1590">1590</a></th><td>            }</td></tr><tr><th id="L1591"><a href="#L1591">1591</a></th><td></td></tr><tr><th id="L1592"><a href="#L1592">1592</a></th><td>            // UP/DOWN look for some history</td></tr><tr><th id="L1593"><a href="#L1593">1593</a></th><td>            if (ev.keyCode === keys.UP) {</td></tr><tr><th id="L1594"><a href="#L1594">1594</a></th><td>                current.increment();</td></tr><tr><th id="L1595"><a href="#L1595">1595</a></th><td>                this.update();</td></tr><tr><th id="L1596"><a href="#L1596">1596</a></th><td>            }</td></tr><tr><th id="L1597"><a href="#L1597">1597</a></th><td>            if (ev.keyCode === keys.DOWN) {</td></tr><tr><th id="L1598"><a href="#L1598">1598</a></th><td>                current.decrement();</td></tr><tr><th id="L1599"><a href="#L1599">1599</a></th><td>                this.update();</td></tr><tr><th id="L1600"><a href="#L1600">1600</a></th><td>            }</td></tr><tr><th id="L1601"><a href="#L1601">1601</a></th><td>        }</td></tr><tr><th id="L1602"><a href="#L1602">1602</a></th><td></td></tr><tr><th id="L1603"><a href="#L1603">1603</a></th><td>        return handled;</td></tr><tr><th id="L1604"><a href="#L1604">1604</a></th><td>    },</td></tr><tr><th id="L1605"><a href="#L1605">1605</a></th><td></td></tr><tr><th id="L1606"><a href="#L1606">1606</a></th><td>    /**</td></tr><tr><th id="L1607"><a href="#L1607">1607</a></th><td>     * Actually parse the input and make sure we're all up to date</td></tr><tr><th id="L1608"><a href="#L1608">1608</a></th><td>     */</td></tr><tr><th id="L1609"><a href="#L1609">1609</a></th><td>    update: function() {</td></tr><tr><th id="L1610"><a href="#L1610">1610</a></th><td>        this.isUpdating = true;</td></tr><tr><th id="L1611"><a href="#L1611">1611</a></th><td>        var input = {</td></tr><tr><th id="L1612"><a href="#L1612">1612</a></th><td>            typed: this.element.value,</td></tr><tr><th id="L1613"><a href="#L1613">1613</a></th><td>            cursor: {</td></tr><tr><th id="L1614"><a href="#L1614">1614</a></th><td>                start: dom.getSelectionStart(this.element),</td></tr><tr><th id="L1615"><a href="#L1615">1615</a></th><td>                end: dom.getSelectionEnd(this.element.selectionEnd)</td></tr><tr><th id="L1616"><a href="#L1616">1616</a></th><td>            }</td></tr><tr><th id="L1617"><a href="#L1617">1617</a></th><td>        };</td></tr><tr><th id="L1618"><a href="#L1618">1618</a></th><td>        this.cli.update(input);</td></tr><tr><th id="L1619"><a href="#L1619">1619</a></th><td></td></tr><tr><th id="L1620"><a href="#L1620">1620</a></th><td>        var display = this.cli.getAssignmentAt(input.cursor.start).getHint();</td></tr><tr><th id="L1621"><a href="#L1621">1621</a></th><td></td></tr><tr><th id="L1622"><a href="#L1622">1622</a></th><td>        // 1. Update the completer with prompt/error marker/TAB info</td></tr><tr><th id="L1623"><a href="#L1623">1623</a></th><td>        dom.removeCssClass(this.completer, Status.VALID.toString());</td></tr><tr><th id="L1624"><a href="#L1624">1624</a></th><td>        dom.removeCssClass(this.completer, Status.INCOMPLETE.toString());</td></tr><tr><th id="L1625"><a href="#L1625">1625</a></th><td>        dom.removeCssClass(this.completer, Status.INVALID.toString());</td></tr><tr><th id="L1626"><a href="#L1626">1626</a></th><td></td></tr><tr><th id="L1627"><a href="#L1627">1627</a></th><td>        var completion = '&lt;span class="cptPrompt"&gt;&amp;gt;&lt;/span&gt; ';</td></tr><tr><th id="L1628"><a href="#L1628">1628</a></th><td>        if (this.element.value.length &gt; 0) {</td></tr><tr><th id="L1629"><a href="#L1629">1629</a></th><td>            var scores = this.cli.getInputStatusMarkup();</td></tr><tr><th id="L1630"><a href="#L1630">1630</a></th><td>            completion += this.markupStatusScore(scores);</td></tr><tr><th id="L1631"><a href="#L1631">1631</a></th><td>        }</td></tr><tr><th id="L1632"><a href="#L1632">1632</a></th><td></td></tr><tr><th id="L1633"><a href="#L1633">1633</a></th><td>        // Display the "-&gt; prediction" at the end of the completer</td></tr><tr><th id="L1634"><a href="#L1634">1634</a></th><td>        if (this.element.value.length &gt; 0 &amp;&amp;</td></tr><tr><th id="L1635"><a href="#L1635">1635</a></th><td>                display.predictions &amp;&amp; display.predictions.length &gt; 0) {</td></tr><tr><th id="L1636"><a href="#L1636">1636</a></th><td>            var tab = display.predictions[0];</td></tr><tr><th id="L1637"><a href="#L1637">1637</a></th><td>            completion += ' &amp;nbsp;&amp;#x21E5; ' + (tab.name ? tab.name : tab);</td></tr><tr><th id="L1638"><a href="#L1638">1638</a></th><td>        }</td></tr><tr><th id="L1639"><a href="#L1639">1639</a></th><td>        this.completer.innerHTML = completion;</td></tr><tr><th id="L1640"><a href="#L1640">1640</a></th><td>        dom.addCssClass(this.completer, this.cli.getWorstHint().status.toString());</td></tr><tr><th id="L1641"><a href="#L1641">1641</a></th><td></td></tr><tr><th id="L1642"><a href="#L1642">1642</a></th><td>        // 2. Update the hint element</td></tr><tr><th id="L1643"><a href="#L1643">1643</a></th><td>        var hint = '';</td></tr><tr><th id="L1644"><a href="#L1644">1644</a></th><td>        if (this.element.value.length !== 0) {</td></tr><tr><th id="L1645"><a href="#L1645">1645</a></th><td>            hint += display.message;</td></tr><tr><th id="L1646"><a href="#L1646">1646</a></th><td>            if (display.predictions &amp;&amp; display.predictions.length &gt; 0) {</td></tr><tr><th id="L1647"><a href="#L1647">1647</a></th><td>                hint += ': [ ';</td></tr><tr><th id="L1648"><a href="#L1648">1648</a></th><td>                display.predictions.forEach(function(prediction) {</td></tr><tr><th id="L1649"><a href="#L1649">1649</a></th><td>                    hint += (prediction.name ? prediction.name : prediction);</td></tr><tr><th id="L1650"><a href="#L1650">1650</a></th><td>                    hint += ' | ';</td></tr><tr><th id="L1651"><a href="#L1651">1651</a></th><td>                }, this);</td></tr><tr><th id="L1652"><a href="#L1652">1652</a></th><td>                hint = hint.replace(/\| $/, ']');</td></tr><tr><th id="L1653"><a href="#L1653">1653</a></th><td>            }</td></tr><tr><th id="L1654"><a href="#L1654">1654</a></th><td>        }</td></tr><tr><th id="L1655"><a href="#L1655">1655</a></th><td></td></tr><tr><th id="L1656"><a href="#L1656">1656</a></th><td>        this.hinter.innerHTML = hint;</td></tr><tr><th id="L1657"><a href="#L1657">1657</a></th><td>        if (hint.length === 0) {</td></tr><tr><th id="L1658"><a href="#L1658">1658</a></th><td>            dom.addCssClass(this.hinter, 'cptNoPopup');</td></tr><tr><th id="L1659"><a href="#L1659">1659</a></th><td>        }</td></tr><tr><th id="L1660"><a href="#L1660">1660</a></th><td>        else {</td></tr><tr><th id="L1661"><a href="#L1661">1661</a></th><td>            dom.removeCssClass(this.hinter, 'cptNoPopup');</td></tr><tr><th id="L1662"><a href="#L1662">1662</a></th><td>        }</td></tr><tr><th id="L1663"><a href="#L1663">1663</a></th><td></td></tr><tr><th id="L1664"><a href="#L1664">1664</a></th><td>        this.isUpdating = false;</td></tr><tr><th id="L1665"><a href="#L1665">1665</a></th><td>    },</td></tr><tr><th id="L1666"><a href="#L1666">1666</a></th><td></td></tr><tr><th id="L1667"><a href="#L1667">1667</a></th><td>    /**</td></tr><tr><th id="L1668"><a href="#L1668">1668</a></th><td>     * Markup an array of Status values with spans</td></tr><tr><th id="L1669"><a href="#L1669">1669</a></th><td>     */</td></tr><tr><th id="L1670"><a href="#L1670">1670</a></th><td>    markupStatusScore: function(scores) {</td></tr><tr><th id="L1671"><a href="#L1671">1671</a></th><td>        var completion = '';</td></tr><tr><th id="L1672"><a href="#L1672">1672</a></th><td>        // Create mark-up</td></tr><tr><th id="L1673"><a href="#L1673">1673</a></th><td>        var i = 0;</td></tr><tr><th id="L1674"><a href="#L1674">1674</a></th><td>        var lastStatus = -1;</td></tr><tr><th id="L1675"><a href="#L1675">1675</a></th><td>        while (true) {</td></tr><tr><th id="L1676"><a href="#L1676">1676</a></th><td>            if (lastStatus !== scores[i]) {</td></tr><tr><th id="L1677"><a href="#L1677">1677</a></th><td>                completion += '&lt;span class=' + scores[i].toString() + '&gt;';</td></tr><tr><th id="L1678"><a href="#L1678">1678</a></th><td>                lastStatus = scores[i];</td></tr><tr><th id="L1679"><a href="#L1679">1679</a></th><td>            }</td></tr><tr><th id="L1680"><a href="#L1680">1680</a></th><td>            completion += this.element.value[i];</td></tr><tr><th id="L1681"><a href="#L1681">1681</a></th><td>            i++;</td></tr><tr><th id="L1682"><a href="#L1682">1682</a></th><td>            if (i === this.element.value.length) {</td></tr><tr><th id="L1683"><a href="#L1683">1683</a></th><td>                completion += '&lt;/span&gt;';</td></tr><tr><th id="L1684"><a href="#L1684">1684</a></th><td>                break;</td></tr><tr><th id="L1685"><a href="#L1685">1685</a></th><td>            }</td></tr><tr><th id="L1686"><a href="#L1686">1686</a></th><td>            if (lastStatus !== scores[i]) {</td></tr><tr><th id="L1687"><a href="#L1687">1687</a></th><td>                completion += '&lt;/span&gt;';</td></tr><tr><th id="L1688"><a href="#L1688">1688</a></th><td>            }</td></tr><tr><th id="L1689"><a href="#L1689">1689</a></th><td>        }</td></tr><tr><th id="L1690"><a href="#L1690">1690</a></th><td></td></tr><tr><th id="L1691"><a href="#L1691">1691</a></th><td>        return completion;</td></tr><tr><th id="L1692"><a href="#L1692">1692</a></th><td>    },</td></tr><tr><th id="L1693"><a href="#L1693">1693</a></th><td></td></tr><tr><th id="L1694"><a href="#L1694">1694</a></th><td>    /**</td></tr><tr><th id="L1695"><a href="#L1695">1695</a></th><td>     * Update the input element to reflect the changed argument</td></tr><tr><th id="L1696"><a href="#L1696">1696</a></th><td>     */</td></tr><tr><th id="L1697"><a href="#L1697">1697</a></th><td>    onArgChange: function(ev) {</td></tr><tr><th id="L1698"><a href="#L1698">1698</a></th><td>        if (this.isUpdating) {</td></tr><tr><th id="L1699"><a href="#L1699">1699</a></th><td>            return;</td></tr><tr><th id="L1700"><a href="#L1700">1700</a></th><td>        }</td></tr><tr><th id="L1701"><a href="#L1701">1701</a></th><td></td></tr><tr><th id="L1702"><a href="#L1702">1702</a></th><td>        var prefix = this.element.value.substring(0, ev.argument.start);</td></tr><tr><th id="L1703"><a href="#L1703">1703</a></th><td>        var suffix = this.element.value.substring(ev.argument.end);</td></tr><tr><th id="L1704"><a href="#L1704">1704</a></th><td>        var insert = typeof ev.text === 'string' ? ev.text : ev.text.name;</td></tr><tr><th id="L1705"><a href="#L1705">1705</a></th><td>        this.element.value = prefix + insert + suffix;</td></tr><tr><th id="L1706"><a href="#L1706">1706</a></th><td>        // Fix the cursor.</td></tr><tr><th id="L1707"><a href="#L1707">1707</a></th><td>        var insertEnd = (prefix + insert).length;</td></tr><tr><th id="L1708"><a href="#L1708">1708</a></th><td>        this.element.selectionStart = insertEnd;</td></tr><tr><th id="L1709"><a href="#L1709">1709</a></th><td>        this.element.selectionEnd = insertEnd;</td></tr><tr><th id="L1710"><a href="#L1710">1710</a></th><td>    }</td></tr><tr><th id="L1711"><a href="#L1711">1711</a></th><td>};</td></tr><tr><th id="L1712"><a href="#L1712">1712</a></th><td>exports.CliView = CliView;</td></tr><tr><th id="L1713"><a href="#L1713">1713</a></th><td></td></tr><tr><th id="L1714"><a href="#L1714">1714</a></th><td></td></tr><tr><th id="L1715"><a href="#L1715">1715</a></th><td>});</td></tr><tr><th id="L1716"><a href="#L1716">1716</a></th><td>/* ***** BEGIN LICENSE BLOCK *****</td></tr><tr><th id="L1717"><a href="#L1717">1717</a></th><td> * Version: MPL 1.1/GPL 2.0/LGPL 2.1</td></tr><tr><th id="L1718"><a href="#L1718">1718</a></th><td> *</td></tr><tr><th id="L1719"><a href="#L1719">1719</a></th><td> * The contents of this file are subject to the Mozilla Public License Version</td></tr><tr><th id="L1720"><a href="#L1720">1720</a></th><td> * 1.1 (the "License"); you may not use this file except in compliance with</td></tr><tr><th id="L1721"><a href="#L1721">1721</a></th><td> * the License. You may obtain a copy of the License at</td></tr><tr><th id="L1722"><a href="#L1722">1722</a></th><td> * http://www.mozilla.org/MPL/</td></tr><tr><th id="L1723"><a href="#L1723">1723</a></th><td> *</td></tr><tr><th id="L1724"><a href="#L1724">1724</a></th><td> * Software distributed under the License is distributed on an "AS IS" basis,</td></tr><tr><th id="L1725"><a href="#L1725">1725</a></th><td> * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</td></tr><tr><th id="L1726"><a href="#L1726">1726</a></th><td> * for the specific language governing rights and limitations under the</td></tr><tr><th id="L1727"><a href="#L1727">1727</a></th><td> * License.</td></tr><tr><th id="L1728"><a href="#L1728">1728</a></th><td> *</td></tr><tr><th id="L1729"><a href="#L1729">1729</a></th><td> * The Original Code is Skywriter.</td></tr><tr><th id="L1730"><a href="#L1730">1730</a></th><td> *</td></tr><tr><th id="L1731"><a href="#L1731">1731</a></th><td> * The Initial Developer of the Original Code is</td></tr><tr><th id="L1732"><a href="#L1732">1732</a></th><td> * Mozilla.</td></tr><tr><th id="L1733"><a href="#L1733">1733</a></th><td> * Portions created by the Initial Developer are Copyright (C) 2009</td></tr><tr><th id="L1734"><a href="#L1734">1734</a></th><td> * the Initial Developer. All Rights Reserved.</td></tr><tr><th id="L1735"><a href="#L1735">1735</a></th><td> *</td></tr><tr><th id="L1736"><a href="#L1736">1736</a></th><td> * Contributor(s):</td></tr><tr><th id="L1737"><a href="#L1737">1737</a></th><td> *   Joe Walker (jwalker@mozilla.com)</td></tr><tr><th id="L1738"><a href="#L1738">1738</a></th><td> *</td></tr><tr><th id="L1739"><a href="#L1739">1739</a></th><td> * Alternatively, the contents of this file may be used under the terms of</td></tr><tr><th id="L1740"><a href="#L1740">1740</a></th><td> * either the GNU General Public License Version 2 or later (the "GPL"), or</td></tr><tr><th id="L1741"><a href="#L1741">1741</a></th><td> * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),</td></tr><tr><th id="L1742"><a href="#L1742">1742</a></th><td> * in which case the provisions of the GPL or the LGPL are applicable instead</td></tr><tr><th id="L1743"><a href="#L1743">1743</a></th><td> * of those above. If you wish to allow use of your version of this file only</td></tr><tr><th id="L1744"><a href="#L1744">1744</a></th><td> * under the terms of either the GPL or the LGPL, and not to allow others to</td></tr><tr><th id="L1745"><a href="#L1745">1745</a></th><td> * use your version of this file under the terms of the MPL, indicate your</td></tr><tr><th id="L1746"><a href="#L1746">1746</a></th><td> * decision by deleting the provisions above and replace them with the notice</td></tr><tr><th id="L1747"><a href="#L1747">1747</a></th><td> * and other provisions required by the GPL or the LGPL. If you do not delete</td></tr><tr><th id="L1748"><a href="#L1748">1748</a></th><td> * the provisions above, a recipient may use your version of this file under</td></tr><tr><th id="L1749"><a href="#L1749">1749</a></th><td> * the terms of any one of the MPL, the GPL or the LGPL.</td></tr><tr><th id="L1750"><a href="#L1750">1750</a></th><td> *</td></tr><tr><th id="L1751"><a href="#L1751">1751</a></th><td> * ***** END LICENSE BLOCK ***** */</td></tr><tr><th id="L1752"><a href="#L1752">1752</a></th><td></td></tr><tr><th id="L1753"><a href="#L1753">1753</a></th><td>define('cockpit/ui/request_view', ['require', 'exports', 'module' , 'pilot/dom', 'pilot/event', 'text!cockpit/ui/request_view.html', 'pilot/domtemplate', 'text!cockpit/ui/request_view.css'], function(require, exports, module) {</td></tr><tr><th id="L1754"><a href="#L1754">1754</a></th><td></td></tr><tr><th id="L1755"><a href="#L1755">1755</a></th><td>var dom = require("pilot/dom");</td></tr><tr><th id="L1756"><a href="#L1756">1756</a></th><td>var event = require("pilot/event");</td></tr><tr><th id="L1757"><a href="#L1757">1757</a></th><td>var requestViewHtml = require("text!cockpit/ui/request_view.html");</td></tr><tr><th id="L1758"><a href="#L1758">1758</a></th><td>var Templater = require("pilot/domtemplate").Templater;</td></tr><tr><th id="L1759"><a href="#L1759">1759</a></th><td></td></tr><tr><th id="L1760"><a href="#L1760">1760</a></th><td>var requestViewCss = require("text!cockpit/ui/request_view.css");</td></tr><tr><th id="L1761"><a href="#L1761">1761</a></th><td>dom.importCssString(requestViewCss);</td></tr><tr><th id="L1762"><a href="#L1762">1762</a></th><td></td></tr><tr><th id="L1763"><a href="#L1763">1763</a></th><td>/**</td></tr><tr><th id="L1764"><a href="#L1764">1764</a></th><td> * Pull the HTML into the DOM, but don't add it to the document</td></tr><tr><th id="L1765"><a href="#L1765">1765</a></th><td> */</td></tr><tr><th id="L1766"><a href="#L1766">1766</a></th><td>var templates = document.createElement('div');</td></tr><tr><th id="L1767"><a href="#L1767">1767</a></th><td>templates.innerHTML = requestViewHtml;</td></tr><tr><th id="L1768"><a href="#L1768">1768</a></th><td>var row = templates.querySelector('.cptRow');</td></tr><tr><th id="L1769"><a href="#L1769">1769</a></th><td></td></tr><tr><th id="L1770"><a href="#L1770">1770</a></th><td>/**</td></tr><tr><th id="L1771"><a href="#L1771">1771</a></th><td> * Work out the path for images.</td></tr><tr><th id="L1772"><a href="#L1772">1772</a></th><td> * TODO: This should probably live in some utility area somewhere</td></tr><tr><th id="L1773"><a href="#L1773">1773</a></th><td> */</td></tr><tr><th id="L1774"><a href="#L1774">1774</a></th><td>function imageUrl(path) {</td></tr><tr><th id="L1775"><a href="#L1775">1775</a></th><td>    var dataUrl;</td></tr><tr><th id="L1776"><a href="#L1776">1776</a></th><td>    try {</td></tr><tr><th id="L1777"><a href="#L1777">1777</a></th><td>        dataUrl = require('text!cockpit/ui/' + path);</td></tr><tr><th id="L1778"><a href="#L1778">1778</a></th><td>    } catch (e) { }</td></tr><tr><th id="L1779"><a href="#L1779">1779</a></th><td>    if (dataUrl) {</td></tr><tr><th id="L1780"><a href="#L1780">1780</a></th><td>        return dataUrl;</td></tr><tr><th id="L1781"><a href="#L1781">1781</a></th><td>    }</td></tr><tr><th id="L1782"><a href="#L1782">1782</a></th><td></td></tr><tr><th id="L1783"><a href="#L1783">1783</a></th><td>    var filename = module.id.split('/').pop() + '.js';</td></tr><tr><th id="L1784"><a href="#L1784">1784</a></th><td>    var imagePath;</td></tr><tr><th id="L1785"><a href="#L1785">1785</a></th><td></td></tr><tr><th id="L1786"><a href="#L1786">1786</a></th><td>    if (module.uri.substr(-filename.length) !== filename) {</td></tr><tr><th id="L1787"><a href="#L1787">1787</a></th><td>        console.error('Can\'t work out path from module.uri/module.id');</td></tr><tr><th id="L1788"><a href="#L1788">1788</a></th><td>        return path;</td></tr><tr><th id="L1789"><a href="#L1789">1789</a></th><td>    }</td></tr><tr><th id="L1790"><a href="#L1790">1790</a></th><td></td></tr><tr><th id="L1791"><a href="#L1791">1791</a></th><td>    if (module.uri) {</td></tr><tr><th id="L1792"><a href="#L1792">1792</a></th><td>        var end = module.uri.length - filename.length - 1;</td></tr><tr><th id="L1793"><a href="#L1793">1793</a></th><td>        return module.uri.substr(0, end) + "/" + path;</td></tr><tr><th id="L1794"><a href="#L1794">1794</a></th><td>    }</td></tr><tr><th id="L1795"><a href="#L1795">1795</a></th><td></td></tr><tr><th id="L1796"><a href="#L1796">1796</a></th><td>    return filename + path;</td></tr><tr><th id="L1797"><a href="#L1797">1797</a></th><td>}</td></tr><tr><th id="L1798"><a href="#L1798">1798</a></th><td></td></tr><tr><th id="L1799"><a href="#L1799">1799</a></th><td></td></tr><tr><th id="L1800"><a href="#L1800">1800</a></th><td>/**</td></tr><tr><th id="L1801"><a href="#L1801">1801</a></th><td> * Adds a row to the CLI output display</td></tr><tr><th id="L1802"><a href="#L1802">1802</a></th><td> */</td></tr><tr><th id="L1803"><a href="#L1803">1803</a></th><td>function RequestView(request, cliView) {</td></tr><tr><th id="L1804"><a href="#L1804">1804</a></th><td>    this.request = request;</td></tr><tr><th id="L1805"><a href="#L1805">1805</a></th><td>    this.cliView = cliView;</td></tr><tr><th id="L1806"><a href="#L1806">1806</a></th><td>    this.imageUrl = imageUrl;</td></tr><tr><th id="L1807"><a href="#L1807">1807</a></th><td></td></tr><tr><th id="L1808"><a href="#L1808">1808</a></th><td>    // Elements attached to this by the templater. For info only</td></tr><tr><th id="L1809"><a href="#L1809">1809</a></th><td>    this.rowin = null;</td></tr><tr><th id="L1810"><a href="#L1810">1810</a></th><td>    this.rowout = null;</td></tr><tr><th id="L1811"><a href="#L1811">1811</a></th><td>    this.output = null;</td></tr><tr><th id="L1812"><a href="#L1812">1812</a></th><td>    this.hide = null;</td></tr><tr><th id="L1813"><a href="#L1813">1813</a></th><td>    this.show = null;</td></tr><tr><th id="L1814"><a href="#L1814">1814</a></th><td>    this.duration = null;</td></tr><tr><th id="L1815"><a href="#L1815">1815</a></th><td>    this.throb = null;</td></tr><tr><th id="L1816"><a href="#L1816">1816</a></th><td></td></tr><tr><th id="L1817"><a href="#L1817">1817</a></th><td>    new Templater().processNode(row.cloneNode(true), this);</td></tr><tr><th id="L1818"><a href="#L1818">1818</a></th><td></td></tr><tr><th id="L1819"><a href="#L1819">1819</a></th><td>    this.cliView.output.appendChild(this.rowin);</td></tr><tr><th id="L1820"><a href="#L1820">1820</a></th><td>    this.cliView.output.appendChild(this.rowout);</td></tr><tr><th id="L1821"><a href="#L1821">1821</a></th><td></td></tr><tr><th id="L1822"><a href="#L1822">1822</a></th><td>    this.request.addEventListener('output', this.onRequestChange.bind(this));</td></tr><tr><th id="L1823"><a href="#L1823">1823</a></th><td>};</td></tr><tr><th id="L1824"><a href="#L1824">1824</a></th><td></td></tr><tr><th id="L1825"><a href="#L1825">1825</a></th><td>RequestView.prototype = {</td></tr><tr><th id="L1826"><a href="#L1826">1826</a></th><td>    /**</td></tr><tr><th id="L1827"><a href="#L1827">1827</a></th><td>     * A single click on an invocation line in the console copies the command to</td></tr><tr><th id="L1828"><a href="#L1828">1828</a></th><td>     * the command line</td></tr><tr><th id="L1829"><a href="#L1829">1829</a></th><td>     */</td></tr><tr><th id="L1830"><a href="#L1830">1830</a></th><td>    copyToInput: function() {</td></tr><tr><th id="L1831"><a href="#L1831">1831</a></th><td>        this.cliView.element.value = this.request.typed;</td></tr><tr><th id="L1832"><a href="#L1832">1832</a></th><td>    },</td></tr><tr><th id="L1833"><a href="#L1833">1833</a></th><td></td></tr><tr><th id="L1834"><a href="#L1834">1834</a></th><td>    /**</td></tr><tr><th id="L1835"><a href="#L1835">1835</a></th><td>     * A double click on an invocation line in the console executes the command</td></tr><tr><th id="L1836"><a href="#L1836">1836</a></th><td>     */</td></tr><tr><th id="L1837"><a href="#L1837">1837</a></th><td>    executeRequest: function(ev) {</td></tr><tr><th id="L1838"><a href="#L1838">1838</a></th><td>        this.cliView.cli.update({</td></tr><tr><th id="L1839"><a href="#L1839">1839</a></th><td>            typed: this.request.typed,</td></tr><tr><th id="L1840"><a href="#L1840">1840</a></th><td>            cursor: { start:0, end:0 }</td></tr><tr><th id="L1841"><a href="#L1841">1841</a></th><td>        });</td></tr><tr><th id="L1842"><a href="#L1842">1842</a></th><td>        this.cliView.cli.exec();</td></tr><tr><th id="L1843"><a href="#L1843">1843</a></th><td>    },</td></tr><tr><th id="L1844"><a href="#L1844">1844</a></th><td></td></tr><tr><th id="L1845"><a href="#L1845">1845</a></th><td>    hideOutput: function(ev) {</td></tr><tr><th id="L1846"><a href="#L1846">1846</a></th><td>        this.output.style.display = 'none';</td></tr><tr><th id="L1847"><a href="#L1847">1847</a></th><td>        dom.addCssClass(this.hide, 'cmd_hidden');</td></tr><tr><th id="L1848"><a href="#L1848">1848</a></th><td>        dom.removeCssClass(this.show, 'cmd_hidden');</td></tr><tr><th id="L1849"><a href="#L1849">1849</a></th><td></td></tr><tr><th id="L1850"><a href="#L1850">1850</a></th><td>        event.stopPropagation(ev);</td></tr><tr><th id="L1851"><a href="#L1851">1851</a></th><td>    },</td></tr><tr><th id="L1852"><a href="#L1852">1852</a></th><td></td></tr><tr><th id="L1853"><a href="#L1853">1853</a></th><td>    showOutput: function(ev) {</td></tr><tr><th id="L1854"><a href="#L1854">1854</a></th><td>        this.output.style.display = 'block';</td></tr><tr><th id="L1855"><a href="#L1855">1855</a></th><td>        dom.removeCssClass(this.hide, 'cmd_hidden');</td></tr><tr><th id="L1856"><a href="#L1856">1856</a></th><td>        dom.addCssClass(this.show, 'cmd_hidden');</td></tr><tr><th id="L1857"><a href="#L1857">1857</a></th><td></td></tr><tr><th id="L1858"><a href="#L1858">1858</a></th><td>        event.stopPropagation(ev);</td></tr><tr><th id="L1859"><a href="#L1859">1859</a></th><td>    },</td></tr><tr><th id="L1860"><a href="#L1860">1860</a></th><td></td></tr><tr><th id="L1861"><a href="#L1861">1861</a></th><td>    remove: function(ev) {</td></tr><tr><th id="L1862"><a href="#L1862">1862</a></th><td>        this.cliView.output.removeChild(this.rowin);</td></tr><tr><th id="L1863"><a href="#L1863">1863</a></th><td>        this.cliView.output.removeChild(this.rowout);</td></tr><tr><th id="L1864"><a href="#L1864">1864</a></th><td>        event.stopPropagation(ev);</td></tr><tr><th id="L1865"><a href="#L1865">1865</a></th><td>    },</td></tr><tr><th id="L1866"><a href="#L1866">1866</a></th><td></td></tr><tr><th id="L1867"><a href="#L1867">1867</a></th><td>    onRequestChange: function(ev) {</td></tr><tr><th id="L1868"><a href="#L1868">1868</a></th><td>        this.duration.innerHTML = this.request.duration ?</td></tr><tr><th id="L1869"><a href="#L1869">1869</a></th><td>            'completed in ' + (this.request.duration / 1000) + ' sec ' :</td></tr><tr><th id="L1870"><a href="#L1870">1870</a></th><td>            '';</td></tr><tr><th id="L1871"><a href="#L1871">1871</a></th><td></td></tr><tr><th id="L1872"><a href="#L1872">1872</a></th><td>        this.output.innerHTML = '';</td></tr><tr><th id="L1873"><a href="#L1873">1873</a></th><td>        this.request.outputs.forEach(function(output) {</td></tr><tr><th id="L1874"><a href="#L1874">1874</a></th><td>            var node;</td></tr><tr><th id="L1875"><a href="#L1875">1875</a></th><td>            if (typeof output == 'string') {</td></tr><tr><th id="L1876"><a href="#L1876">1876</a></th><td>                node = document.createElement('p');</td></tr><tr><th id="L1877"><a href="#L1877">1877</a></th><td>                node.innerHTML = output;</td></tr><tr><th id="L1878"><a href="#L1878">1878</a></th><td>            } else {</td></tr><tr><th id="L1879"><a href="#L1879">1879</a></th><td>                node = output;</td></tr><tr><th id="L1880"><a href="#L1880">1880</a></th><td>            }</td></tr><tr><th id="L1881"><a href="#L1881">1881</a></th><td>            this.output.appendChild(node);</td></tr><tr><th id="L1882"><a href="#L1882">1882</a></th><td>        }, this);</td></tr><tr><th id="L1883"><a href="#L1883">1883</a></th><td>        this.cliView.scrollOutputToBottom();</td></tr><tr><th id="L1884"><a href="#L1884">1884</a></th><td></td></tr><tr><th id="L1885"><a href="#L1885">1885</a></th><td>        dom.setCssClass(this.output, 'cmd_error', this.request.error);</td></tr><tr><th id="L1886"><a href="#L1886">1886</a></th><td></td></tr><tr><th id="L1887"><a href="#L1887">1887</a></th><td>        this.throb.style.display = this.request.completed ? 'none' : 'block';</td></tr><tr><th id="L1888"><a href="#L1888">1888</a></th><td>    }</td></tr><tr><th id="L1889"><a href="#L1889">1889</a></th><td>};</td></tr><tr><th id="L1890"><a href="#L1890">1890</a></th><td>exports.RequestView = RequestView;</td></tr><tr><th id="L1891"><a href="#L1891">1891</a></th><td></td></tr><tr><th id="L1892"><a href="#L1892">1892</a></th><td></td></tr><tr><th id="L1893"><a href="#L1893">1893</a></th><td>});</td></tr><tr><th id="L1894"><a href="#L1894">1894</a></th><td>/* ***** BEGIN LICENSE BLOCK *****</td></tr><tr><th id="L1895"><a href="#L1895">1895</a></th><td> * Version: MPL 1.1/GPL 2.0/LGPL 2.1</td></tr><tr><th id="L1896"><a href="#L1896">1896</a></th><td> *</td></tr><tr><th id="L1897"><a href="#L1897">1897</a></th><td> * The contents of this file are subject to the Mozilla Public License Version</td></tr><tr><th id="L1898"><a href="#L1898">1898</a></th><td> * 1.1 (the "License"); you may not use this file except in compliance with</td></tr><tr><th id="L1899"><a href="#L1899">1899</a></th><td> * the License. You may obtain a copy of the License at</td></tr><tr><th id="L1900"><a href="#L1900">1900</a></th><td> * http://www.mozilla.org/MPL/</td></tr><tr><th id="L1901"><a href="#L1901">1901</a></th><td> *</td></tr><tr><th id="L1902"><a href="#L1902">1902</a></th><td> * Software distributed under the License is distributed on an "AS IS" basis,</td></tr><tr><th id="L1903"><a href="#L1903">1903</a></th><td> * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</td></tr><tr><th id="L1904"><a href="#L1904">1904</a></th><td> * for the specific language governing rights and limitations under the</td></tr><tr><th id="L1905"><a href="#L1905">1905</a></th><td> * License.</td></tr><tr><th id="L1906"><a href="#L1906">1906</a></th><td> *</td></tr><tr><th id="L1907"><a href="#L1907">1907</a></th><td> * The Original Code is DomTemplate.</td></tr><tr><th id="L1908"><a href="#L1908">1908</a></th><td> *</td></tr><tr><th id="L1909"><a href="#L1909">1909</a></th><td> * The Initial Developer of the Original Code is Mozilla.</td></tr><tr><th id="L1910"><a href="#L1910">1910</a></th><td> * Portions created by the Initial Developer are Copyright (C) 2009</td></tr><tr><th id="L1911"><a href="#L1911">1911</a></th><td> * the Initial Developer. All Rights Reserved.</td></tr><tr><th id="L1912"><a href="#L1912">1912</a></th><td> *</td></tr><tr><th id="L1913"><a href="#L1913">1913</a></th><td> * Contributor(s):</td></tr><tr><th id="L1914"><a href="#L1914">1914</a></th><td> *   Joe Walker (jwalker@mozilla.com) (original author)</td></tr><tr><th id="L1915"><a href="#L1915">1915</a></th><td> *</td></tr><tr><th id="L1916"><a href="#L1916">1916</a></th><td> * Alternatively, the contents of this file may be used under the terms of</td></tr><tr><th id="L1917"><a href="#L1917">1917</a></th><td> * either the GNU General Public License Version 2 or later (the "GPL"), or</td></tr><tr><th id="L1918"><a href="#L1918">1918</a></th><td> * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),</td></tr><tr><th id="L1919"><a href="#L1919">1919</a></th><td> * in which case the provisions of the GPL or the LGPL are applicable instead</td></tr><tr><th id="L1920"><a href="#L1920">1920</a></th><td> * of those above. If you wish to allow use of your version of this file only</td></tr><tr><th id="L1921"><a href="#L1921">1921</a></th><td> * under the terms of either the GPL or the LGPL, and not to allow others to</td></tr><tr><th id="L1922"><a href="#L1922">1922</a></th><td> * use your version of this file under the terms of the MPL, indicate your</td></tr><tr><th id="L1923"><a href="#L1923">1923</a></th><td> * decision by deleting the provisions above and replace them with the notice</td></tr><tr><th id="L1924"><a href="#L1924">1924</a></th><td> * and other provisions required by the GPL or the LGPL. If you do not delete</td></tr><tr><th id="L1925"><a href="#L1925">1925</a></th><td> * the provisions above, a recipient may use your version of this file under</td></tr><tr><th id="L1926"><a href="#L1926">1926</a></th><td> * the terms of any one of the MPL, the GPL or the LGPL.</td></tr><tr><th id="L1927"><a href="#L1927">1927</a></th><td> *</td></tr><tr><th id="L1928"><a href="#L1928">1928</a></th><td> * ***** END LICENSE BLOCK ***** */</td></tr><tr><th id="L1929"><a href="#L1929">1929</a></th><td></td></tr><tr><th id="L1930"><a href="#L1930">1930</a></th><td>define('pilot/domtemplate', ['require', 'exports', 'module' ], function(require, exports, module) {</td></tr><tr><th id="L1931"><a href="#L1931">1931</a></th><td></td></tr><tr><th id="L1932"><a href="#L1932">1932</a></th><td></td></tr><tr><th id="L1933"><a href="#L1933">1933</a></th><td>// WARNING: do not 'use_strict' without reading the notes in envEval;</td></tr><tr><th id="L1934"><a href="#L1934">1934</a></th><td></td></tr><tr><th id="L1935"><a href="#L1935">1935</a></th><td>/**</td></tr><tr><th id="L1936"><a href="#L1936">1936</a></th><td> * A templater that allows one to quickly template DOM nodes.</td></tr><tr><th id="L1937"><a href="#L1937">1937</a></th><td> */</td></tr><tr><th id="L1938"><a href="#L1938">1938</a></th><td>function Templater() {</td></tr><tr><th id="L1939"><a href="#L1939">1939</a></th><td>  this.scope = [];</td></tr><tr><th id="L1940"><a href="#L1940">1940</a></th><td>};</td></tr><tr><th id="L1941"><a href="#L1941">1941</a></th><td></td></tr><tr><th id="L1942"><a href="#L1942">1942</a></th><td>/**</td></tr><tr><th id="L1943"><a href="#L1943">1943</a></th><td> * Recursive function to walk the tree processing the attributes as it goes.</td></tr><tr><th id="L1944"><a href="#L1944">1944</a></th><td> * @param node the node to process. If you pass a string in instead of a DOM</td></tr><tr><th id="L1945"><a href="#L1945">1945</a></th><td> * element, it is assumed to be an id for use with document.getElementById()</td></tr><tr><th id="L1946"><a href="#L1946">1946</a></th><td> * @param data the data to use for node processing.</td></tr><tr><th id="L1947"><a href="#L1947">1947</a></th><td> */</td></tr><tr><th id="L1948"><a href="#L1948">1948</a></th><td>Templater.prototype.processNode = function(node, data) {</td></tr><tr><th id="L1949"><a href="#L1949">1949</a></th><td>  if (typeof node === 'string') {</td></tr><tr><th id="L1950"><a href="#L1950">1950</a></th><td>    node = document.getElementById(node);</td></tr><tr><th id="L1951"><a href="#L1951">1951</a></th><td>  }</td></tr><tr><th id="L1952"><a href="#L1952">1952</a></th><td>  if (data === null || data === undefined) {</td></tr><tr><th id="L1953"><a href="#L1953">1953</a></th><td>    data = {};</td></tr><tr><th id="L1954"><a href="#L1954">1954</a></th><td>  }</td></tr><tr><th id="L1955"><a href="#L1955">1955</a></th><td>  this.scope.push(node.nodeName + (node.id ? '#' + node.id : ''));</td></tr><tr><th id="L1956"><a href="#L1956">1956</a></th><td>  try {</td></tr><tr><th id="L1957"><a href="#L1957">1957</a></th><td>    // Process attributes</td></tr><tr><th id="L1958"><a href="#L1958">1958</a></th><td>    if (node.attributes &amp;&amp; node.attributes.length) {</td></tr><tr><th id="L1959"><a href="#L1959">1959</a></th><td>      // We need to handle 'foreach' and 'if' first because they might stop</td></tr><tr><th id="L1960"><a href="#L1960">1960</a></th><td>      // some types of processing from happening, and foreach must come first</td></tr><tr><th id="L1961"><a href="#L1961">1961</a></th><td>      // because it defines new data on which 'if' might depend.</td></tr><tr><th id="L1962"><a href="#L1962">1962</a></th><td>      if (node.hasAttribute('foreach')) {</td></tr><tr><th id="L1963"><a href="#L1963">1963</a></th><td>        this.processForEach(node, data);</td></tr><tr><th id="L1964"><a href="#L1964">1964</a></th><td>        return;</td></tr><tr><th id="L1965"><a href="#L1965">1965</a></th><td>      }</td></tr><tr><th id="L1966"><a href="#L1966">1966</a></th><td>      if (node.hasAttribute('if')) {</td></tr><tr><th id="L1967"><a href="#L1967">1967</a></th><td>        if (!this.processIf(node, data)) {</td></tr><tr><th id="L1968"><a href="#L1968">1968</a></th><td>          return;</td></tr><tr><th id="L1969"><a href="#L1969">1969</a></th><td>        }</td></tr><tr><th id="L1970"><a href="#L1970">1970</a></th><td>      }</td></tr><tr><th id="L1971"><a href="#L1971">1971</a></th><td>      // Only make the node available once we know it's not going away</td></tr><tr><th id="L1972"><a href="#L1972">1972</a></th><td>      data.__element = node;</td></tr><tr><th id="L1973"><a href="#L1973">1973</a></th><td>      // It's good to clean up the attributes when we've processed them,</td></tr><tr><th id="L1974"><a href="#L1974">1974</a></th><td>      // but if we do it straight away, we mess up the array index</td></tr><tr><th id="L1975"><a href="#L1975">1975</a></th><td>      var attrs = Array.prototype.slice.call(node.attributes);</td></tr><tr><th id="L1976"><a href="#L1976">1976</a></th><td>      for (var i = 0; i &lt; attrs.length; i++) {</td></tr><tr><th id="L1977"><a href="#L1977">1977</a></th><td>        var value = attrs[i].value;</td></tr><tr><th id="L1978"><a href="#L1978">1978</a></th><td>        var name = attrs[i].name;</td></tr><tr><th id="L1979"><a href="#L1979">1979</a></th><td>        this.scope.push(name);</td></tr><tr><th id="L1980"><a href="#L1980">1980</a></th><td>        try {</td></tr><tr><th id="L1981"><a href="#L1981">1981</a></th><td>          if (name === 'save') {</td></tr><tr><th id="L1982"><a href="#L1982">1982</a></th><td>            // Save attributes are a setter using the node</td></tr><tr><th id="L1983"><a href="#L1983">1983</a></th><td>            value = this.stripBraces(value);</td></tr><tr><th id="L1984"><a href="#L1984">1984</a></th><td>            this.property(value, data, node);</td></tr><tr><th id="L1985"><a href="#L1985">1985</a></th><td>            node.removeAttribute('save');</td></tr><tr><th id="L1986"><a href="#L1986">1986</a></th><td>          } else if (name.substring(0, 2) === 'on') {</td></tr><tr><th id="L1987"><a href="#L1987">1987</a></th><td>            // Event registration relies on property doing a bind</td></tr><tr><th id="L1988"><a href="#L1988">1988</a></th><td>            value = this.stripBraces(value);</td></tr><tr><th id="L1989"><a href="#L1989">1989</a></th><td>            var func = this.property(value, data);</td></tr><tr><th id="L1990"><a href="#L1990">1990</a></th><td>            if (typeof func !== 'function') {</td></tr><tr><th id="L1991"><a href="#L1991">1991</a></th><td>              this.handleError('Expected ' + value +</td></tr><tr><th id="L1992"><a href="#L1992">1992</a></th><td>                ' to resolve to a function, but got ' + typeof func);</td></tr><tr><th id="L1993"><a href="#L1993">1993</a></th><td>            }</td></tr><tr><th id="L1994"><a href="#L1994">1994</a></th><td>            node.removeAttribute(name);</td></tr><tr><th id="L1995"><a href="#L1995">1995</a></th><td>            var capture = node.hasAttribute('capture' + name.substring(2));</td></tr><tr><th id="L1996"><a href="#L1996">1996</a></th><td>            node.addEventListener(name.substring(2), func, capture);</td></tr><tr><th id="L1997"><a href="#L1997">1997</a></th><td>            if (capture) {</td></tr><tr><th id="L1998"><a href="#L1998">1998</a></th><td>              node.removeAttribute('capture' + name.substring(2));</td></tr><tr><th id="L1999"><a href="#L1999">1999</a></th><td>            }</td></tr><tr><th id="L2000"><a href="#L2000">2000</a></th><td>          } else {</td></tr><tr><th id="L2001"><a href="#L2001">2001</a></th><td>            // Replace references in all other attributes</td></tr><tr><th id="L2002"><a href="#L2002">2002</a></th><td>            var self = this;</td></tr><tr><th id="L2003"><a href="#L2003">2003</a></th><td>            var newValue = value.replace(/\$\{[^}]*\}/g, function(path) {</td></tr><tr><th id="L2004"><a href="#L2004">2004</a></th><td>              return self.envEval(path.slice(2, -1), data, value);</td></tr><tr><th id="L2005"><a href="#L2005">2005</a></th><td>            });</td></tr><tr><th id="L2006"><a href="#L2006">2006</a></th><td>            // Remove '_' prefix of attribute names so the DOM won't try</td></tr><tr><th id="L2007"><a href="#L2007">2007</a></th><td>            // to use them before we've processed the template</td></tr><tr><th id="L2008"><a href="#L2008">2008</a></th><td>            if (name.charAt(0) === '_') {</td></tr><tr><th id="L2009"><a href="#L2009">2009</a></th><td>              node.removeAttribute(name);</td></tr><tr><th id="L2010"><a href="#L2010">2010</a></th><td>              node.setAttribute(name.substring(1), newValue);</td></tr><tr><th id="L2011"><a href="#L2011">2011</a></th><td>            } else if (value !== newValue) {</td></tr><tr><th id="L2012"><a href="#L2012">2012</a></th><td>              attrs[i].value = newValue;</td></tr><tr><th id="L2013"><a href="#L2013">2013</a></th><td>            }</td></tr><tr><th id="L2014"><a href="#L2014">2014</a></th><td>          }</td></tr><tr><th id="L2015"><a href="#L2015">2015</a></th><td>        } finally {</td></tr><tr><th id="L2016"><a href="#L2016">2016</a></th><td>          this.scope.pop();</td></tr><tr><th id="L2017"><a href="#L2017">2017</a></th><td>        }</td></tr><tr><th id="L2018"><a href="#L2018">2018</a></th><td>      }</td></tr><tr><th id="L2019"><a href="#L2019">2019</a></th><td>    }</td></tr><tr><th id="L2020"><a href="#L2020">2020</a></th><td></td></tr><tr><th id="L2021"><a href="#L2021">2021</a></th><td>    // Loop through our children calling processNode. First clone them, so the</td></tr><tr><th id="L2022"><a href="#L2022">2022</a></th><td>    // set of nodes that we visit will be unaffected by additions or removals.</td></tr><tr><th id="L2023"><a href="#L2023">2023</a></th><td>    var childNodes = Array.prototype.slice.call(node.childNodes);</td></tr><tr><th id="L2024"><a href="#L2024">2024</a></th><td>    for (var j = 0; j &lt; childNodes.length; j++) {</td></tr><tr><th id="L2025"><a href="#L2025">2025</a></th><td>      this.processNode(childNodes[j], data);</td></tr><tr><th id="L2026"><a href="#L2026">2026</a></th><td>    }</td></tr><tr><th id="L2027"><a href="#L2027">2027</a></th><td></td></tr><tr><th id="L2028"><a href="#L2028">2028</a></th><td>    if (node.nodeType === Node.TEXT_NODE) {</td></tr><tr><th id="L2029"><a href="#L2029">2029</a></th><td>      this.processTextNode(node, data);</td></tr><tr><th id="L2030"><a href="#L2030">2030</a></th><td>    }</td></tr><tr><th id="L2031"><a href="#L2031">2031</a></th><td>  } finally {</td></tr><tr><th id="L2032"><a href="#L2032">2032</a></th><td>    this.scope.pop();</td></tr><tr><th id="L2033"><a href="#L2033">2033</a></th><td>  }</td></tr><tr><th id="L2034"><a href="#L2034">2034</a></th><td>};</td></tr><tr><th id="L2035"><a href="#L2035">2035</a></th><td></td></tr><tr><th id="L2036"><a href="#L2036">2036</a></th><td>/**</td></tr><tr><th id="L2037"><a href="#L2037">2037</a></th><td> * Handle &lt;x if="${...}"&gt;</td></tr><tr><th id="L2038"><a href="#L2038">2038</a></th><td> * @param node An element with an 'if' attribute</td></tr><tr><th id="L2039"><a href="#L2039">2039</a></th><td> * @param data The data to use with envEval</td></tr><tr><th id="L2040"><a href="#L2040">2040</a></th><td> * @returns true if processing should continue, false otherwise</td></tr><tr><th id="L2041"><a href="#L2041">2041</a></th><td> */</td></tr><tr><th id="L2042"><a href="#L2042">2042</a></th><td>Templater.prototype.processIf = function(node, data) {</td></tr><tr><th id="L2043"><a href="#L2043">2043</a></th><td>  this.scope.push('if');</td></tr><tr><th id="L2044"><a href="#L2044">2044</a></th><td>  try {</td></tr><tr><th id="L2045"><a href="#L2045">2045</a></th><td>    var originalValue = node.getAttribute('if');</td></tr><tr><th id="L2046"><a href="#L2046">2046</a></th><td>    var value = this.stripBraces(originalValue);</td></tr><tr><th id="L2047"><a href="#L2047">2047</a></th><td>    var recurse = true;</td></tr><tr><th id="L2048"><a href="#L2048">2048</a></th><td>    try {</td></tr><tr><th id="L2049"><a href="#L2049">2049</a></th><td>      var reply = this.envEval(value, data, originalValue);</td></tr><tr><th id="L2050"><a href="#L2050">2050</a></th><td>      recurse = !!reply;</td></tr><tr><th id="L2051"><a href="#L2051">2051</a></th><td>    } catch (ex) {</td></tr><tr><th id="L2052"><a href="#L2052">2052</a></th><td>      this.handleError('Error with \'' + value + '\'', ex);</td></tr><tr><th id="L2053"><a href="#L2053">2053</a></th><td>      recurse = false;</td></tr><tr><th id="L2054"><a href="#L2054">2054</a></th><td>    }</td></tr><tr><th id="L2055"><a href="#L2055">2055</a></th><td>    if (!recurse) {</td></tr><tr><th id="L2056"><a href="#L2056">2056</a></th><td>      node.parentNode.removeChild(node);</td></tr><tr><th id="L2057"><a href="#L2057">2057</a></th><td>    }</td></tr><tr><th id="L2058"><a href="#L2058">2058</a></th><td>    node.removeAttribute('if');</td></tr><tr><th id="L2059"><a href="#L2059">2059</a></th><td>    return recurse;</td></tr><tr><th id="L2060"><a href="#L2060">2060</a></th><td>  } finally {</td></tr><tr><th id="L2061"><a href="#L2061">2061</a></th><td>    this.scope.pop();</td></tr><tr><th id="L2062"><a href="#L2062">2062</a></th><td>  }</td></tr><tr><th id="L2063"><a href="#L2063">2063</a></th><td>};</td></tr><tr><th id="L2064"><a href="#L2064">2064</a></th><td></td></tr><tr><th id="L2065"><a href="#L2065">2065</a></th><td>/**</td></tr><tr><th id="L2066"><a href="#L2066">2066</a></th><td> * Handle &lt;x foreach="param in ${array}"&gt; and the special case of</td></tr><tr><th id="L2067"><a href="#L2067">2067</a></th><td> * &lt;loop foreach="param in ${array}"&gt;</td></tr><tr><th id="L2068"><a href="#L2068">2068</a></th><td> * @param node An element with a 'foreach' attribute</td></tr><tr><th id="L2069"><a href="#L2069">2069</a></th><td> * @param data The data to use with envEval</td></tr><tr><th id="L2070"><a href="#L2070">2070</a></th><td> */</td></tr><tr><th id="L2071"><a href="#L2071">2071</a></th><td>Templater.prototype.processForEach = function(node, data) {</td></tr><tr><th id="L2072"><a href="#L2072">2072</a></th><td>  this.scope.push('foreach');</td></tr><tr><th id="L2073"><a href="#L2073">2073</a></th><td>  try {</td></tr><tr><th id="L2074"><a href="#L2074">2074</a></th><td>    var originalValue = node.getAttribute('foreach');</td></tr><tr><th id="L2075"><a href="#L2075">2075</a></th><td>    var value = originalValue;</td></tr><tr><th id="L2076"><a href="#L2076">2076</a></th><td></td></tr><tr><th id="L2077"><a href="#L2077">2077</a></th><td>    var paramName = 'param';</td></tr><tr><th id="L2078"><a href="#L2078">2078</a></th><td>    if (value.charAt(0) === '$') {</td></tr><tr><th id="L2079"><a href="#L2079">2079</a></th><td>      // No custom loop variable name. Use the default: 'param'</td></tr><tr><th id="L2080"><a href="#L2080">2080</a></th><td>      value = this.stripBraces(value);</td></tr><tr><th id="L2081"><a href="#L2081">2081</a></th><td>    } else {</td></tr><tr><th id="L2082"><a href="#L2082">2082</a></th><td>      // Extract the loop variable name from 'NAME in ${ARRAY}'</td></tr><tr><th id="L2083"><a href="#L2083">2083</a></th><td>      var nameArr = value.split(' in ');</td></tr><tr><th id="L2084"><a href="#L2084">2084</a></th><td>      paramName = nameArr[0].trim();</td></tr><tr><th id="L2085"><a href="#L2085">2085</a></th><td>      value = this.stripBraces(nameArr[1].trim());</td></tr><tr><th id="L2086"><a href="#L2086">2086</a></th><td>    }</td></tr><tr><th id="L2087"><a href="#L2087">2087</a></th><td>    node.removeAttribute('foreach');</td></tr><tr><th id="L2088"><a href="#L2088">2088</a></th><td>    try {</td></tr><tr><th id="L2089"><a href="#L2089">2089</a></th><td>      var self = this;</td></tr><tr><th id="L2090"><a href="#L2090">2090</a></th><td>      // Process a single iteration of a loop</td></tr><tr><th id="L2091"><a href="#L2091">2091</a></th><td>      var processSingle = function(member, clone, ref) {</td></tr><tr><th id="L2092"><a href="#L2092">2092</a></th><td>        ref.parentNode.insertBefore(clone, ref);</td></tr><tr><th id="L2093"><a href="#L2093">2093</a></th><td>        data[paramName] = member;</td></tr><tr><th id="L2094"><a href="#L2094">2094</a></th><td>        self.processNode(clone, data);</td></tr><tr><th id="L2095"><a href="#L2095">2095</a></th><td>        delete data[paramName];</td></tr><tr><th id="L2096"><a href="#L2096">2096</a></th><td>      };</td></tr><tr><th id="L2097"><a href="#L2097">2097</a></th><td></td></tr><tr><th id="L2098"><a href="#L2098">2098</a></th><td>      // processSingle is no good for &lt;loop&gt; nodes where we want to work on</td></tr><tr><th id="L2099"><a href="#L2099">2099</a></th><td>      // the childNodes rather than the node itself</td></tr><tr><th id="L2100"><a href="#L2100">2100</a></th><td>      var processAll = function(scope, member) {</td></tr><tr><th id="L2101"><a href="#L2101">2101</a></th><td>        self.scope.push(scope);</td></tr><tr><th id="L2102"><a href="#L2102">2102</a></th><td>        try {</td></tr><tr><th id="L2103"><a href="#L2103">2103</a></th><td>          if (node.nodeName === 'LOOP') {</td></tr><tr><th id="L2104"><a href="#L2104">2104</a></th><td>            for (var i = 0; i &lt; node.childNodes.length; i++) {</td></tr><tr><th id="L2105"><a href="#L2105">2105</a></th><td>              var clone = node.childNodes[i].cloneNode(true);</td></tr><tr><th id="L2106"><a href="#L2106">2106</a></th><td>              processSingle(member, clone, node);</td></tr><tr><th id="L2107"><a href="#L2107">2107</a></th><td>            }</td></tr><tr><th id="L2108"><a href="#L2108">2108</a></th><td>          } else {</td></tr><tr><th id="L2109"><a href="#L2109">2109</a></th><td>            var clone = node.cloneNode(true);</td></tr><tr><th id="L2110"><a href="#L2110">2110</a></th><td>            clone.removeAttribute('foreach');</td></tr><tr><th id="L2111"><a href="#L2111">2111</a></th><td>            processSingle(member, clone, node);</td></tr><tr><th id="L2112"><a href="#L2112">2112</a></th><td>          }</td></tr><tr><th id="L2113"><a href="#L2113">2113</a></th><td>        } finally {</td></tr><tr><th id="L2114"><a href="#L2114">2114</a></th><td>          self.scope.pop();</td></tr><tr><th id="L2115"><a href="#L2115">2115</a></th><td>        }</td></tr><tr><th id="L2116"><a href="#L2116">2116</a></th><td>      };</td></tr><tr><th id="L2117"><a href="#L2117">2117</a></th><td></td></tr><tr><th id="L2118"><a href="#L2118">2118</a></th><td>      var reply = this.envEval(value, data, originalValue);</td></tr><tr><th id="L2119"><a href="#L2119">2119</a></th><td>      if (Array.isArray(reply)) {</td></tr><tr><th id="L2120"><a href="#L2120">2120</a></th><td>        reply.forEach(function(data, i) {</td></tr><tr><th id="L2121"><a href="#L2121">2121</a></th><td>          processAll('' + i, data);</td></tr><tr><th id="L2122"><a href="#L2122">2122</a></th><td>        }, this);</td></tr><tr><th id="L2123"><a href="#L2123">2123</a></th><td>      } else {</td></tr><tr><th id="L2124"><a href="#L2124">2124</a></th><td>        for (var param in reply) {</td></tr><tr><th id="L2125"><a href="#L2125">2125</a></th><td>          if (reply.hasOwnProperty(param)) {</td></tr><tr><th id="L2126"><a href="#L2126">2126</a></th><td>            processAll(param, param);</td></tr><tr><th id="L2127"><a href="#L2127">2127</a></th><td>          }</td></tr><tr><th id="L2128"><a href="#L2128">2128</a></th><td>        }</td></tr><tr><th id="L2129"><a href="#L2129">2129</a></th><td>      }</td></tr><tr><th id="L2130"><a href="#L2130">2130</a></th><td>      node.parentNode.removeChild(node);</td></tr><tr><th id="L2131"><a href="#L2131">2131</a></th><td>    } catch (ex) {</td></tr><tr><th id="L2132"><a href="#L2132">2132</a></th><td>      this.handleError('Error with \'' + value + '\'', ex);</td></tr><tr><th id="L2133"><a href="#L2133">2133</a></th><td>    }</td></tr><tr><th id="L2134"><a href="#L2134">2134</a></th><td>  } finally {</td></tr><tr><th id="L2135"><a href="#L2135">2135</a></th><td>    this.scope.pop();</td></tr><tr><th id="L2136"><a href="#L2136">2136</a></th><td>  }</td></tr><tr><th id="L2137"><a href="#L2137">2137</a></th><td>};</td></tr><tr><th id="L2138"><a href="#L2138">2138</a></th><td></td></tr><tr><th id="L2139"><a href="#L2139">2139</a></th><td>/**</td></tr><tr><th id="L2140"><a href="#L2140">2140</a></th><td> * Take a text node and replace it with another text node with the ${...}</td></tr><tr><th id="L2141"><a href="#L2141">2141</a></th><td> * sections parsed out. We replace the node by altering node.parentNode but</td></tr><tr><th id="L2142"><a href="#L2142">2142</a></th><td> * we could probably use a DOM Text API to achieve the same thing.</td></tr><tr><th id="L2143"><a href="#L2143">2143</a></th><td> * @param node The Text node to work on</td></tr><tr><th id="L2144"><a href="#L2144">2144</a></th><td> * @param data The data to use in calls to envEval</td></tr><tr><th id="L2145"><a href="#L2145">2145</a></th><td> */</td></tr><tr><th id="L2146"><a href="#L2146">2146</a></th><td>Templater.prototype.processTextNode = function(node, data) {</td></tr><tr><th id="L2147"><a href="#L2147">2147</a></th><td>  // Replace references in other attributes</td></tr><tr><th id="L2148"><a href="#L2148">2148</a></th><td>  var value = node.data;</td></tr><tr><th id="L2149"><a href="#L2149">2149</a></th><td>  // We can't use the string.replace() with function trick (see generic</td></tr><tr><th id="L2150"><a href="#L2150">2150</a></th><td>  // attribute processing in processNode()) because we need to support</td></tr><tr><th id="L2151"><a href="#L2151">2151</a></th><td>  // functions that return DOM nodes, so we can't have the conversion to a</td></tr><tr><th id="L2152"><a href="#L2152">2152</a></th><td>  // string.</td></tr><tr><th id="L2153"><a href="#L2153">2153</a></th><td>  // Instead we process the string as an array of parts. In order to split</td></tr><tr><th id="L2154"><a href="#L2154">2154</a></th><td>  // the string up, we first replace '${' with '\uF001$' and '}' with '\uF002'</td></tr><tr><th id="L2155"><a href="#L2155">2155</a></th><td>  // We can then split using \uF001 or \uF002 to get an array of strings</td></tr><tr><th id="L2156"><a href="#L2156">2156</a></th><td>  // where scripts are prefixed with $.</td></tr><tr><th id="L2157"><a href="#L2157">2157</a></th><td>  // \uF001 and \uF002 are just unicode chars reserved for private use.</td></tr><tr><th id="L2158"><a href="#L2158">2158</a></th><td>  value = value.replace(/\$\{([^}]*)\}/g, '\uF001$$$1\uF002');</td></tr><tr><th id="L2159"><a href="#L2159">2159</a></th><td>  var parts = value.split(/\uF001|\uF002/);</td></tr><tr><th id="L2160"><a href="#L2160">2160</a></th><td>  if (parts.length &gt; 1) {</td></tr><tr><th id="L2161"><a href="#L2161">2161</a></th><td>    parts.forEach(function(part) {</td></tr><tr><th id="L2162"><a href="#L2162">2162</a></th><td>      if (part === null || part === undefined || part === '') {</td></tr><tr><th id="L2163"><a href="#L2163">2163</a></th><td>        return;</td></tr><tr><th id="L2164"><a href="#L2164">2164</a></th><td>      }</td></tr><tr><th id="L2165"><a href="#L2165">2165</a></th><td>      if (part.charAt(0) === '$') {</td></tr><tr><th id="L2166"><a href="#L2166">2166</a></th><td>        part = this.envEval(part.slice(1), data, node.data);</td></tr><tr><th id="L2167"><a href="#L2167">2167</a></th><td>      }</td></tr><tr><th id="L2168"><a href="#L2168">2168</a></th><td>      // It looks like this was done a few lines above but see envEval</td></tr><tr><th id="L2169"><a href="#L2169">2169</a></th><td>      if (part === null) {</td></tr><tr><th id="L2170"><a href="#L2170">2170</a></th><td>        part = "null";</td></tr><tr><th id="L2171"><a href="#L2171">2171</a></th><td>      }</td></tr><tr><th id="L2172"><a href="#L2172">2172</a></th><td>      if (part === undefined) {</td></tr><tr><th id="L2173"><a href="#L2173">2173</a></th><td>        part = "undefined";</td></tr><tr><th id="L2174"><a href="#L2174">2174</a></th><td>      }</td></tr><tr><th id="L2175"><a href="#L2175">2175</a></th><td>      // if (isDOMElement(part)) { ... }</td></tr><tr><th id="L2176"><a href="#L2176">2176</a></th><td>      if (typeof part.cloneNode !== 'function') {</td></tr><tr><th id="L2177"><a href="#L2177">2177</a></th><td>        part = node.ownerDocument.createTextNode(part.toString());</td></tr><tr><th id="L2178"><a href="#L2178">2178</a></th><td>      }</td></tr><tr><th id="L2179"><a href="#L2179">2179</a></th><td>      node.parentNode.insertBefore(part, node);</td></tr><tr><th id="L2180"><a href="#L2180">2180</a></th><td>    }, this);</td></tr><tr><th id="L2181"><a href="#L2181">2181</a></th><td>    node.parentNode.removeChild(node);</td></tr><tr><th id="L2182"><a href="#L2182">2182</a></th><td>  }</td></tr><tr><th id="L2183"><a href="#L2183">2183</a></th><td>};</td></tr><tr><th id="L2184"><a href="#L2184">2184</a></th><td></td></tr><tr><th id="L2185"><a href="#L2185">2185</a></th><td>/**</td></tr><tr><th id="L2186"><a href="#L2186">2186</a></th><td> * Warn of string does not begin '${' and end '}'</td></tr><tr><th id="L2187"><a href="#L2187">2187</a></th><td> * @param str the string to check.</td></tr><tr><th id="L2188"><a href="#L2188">2188</a></th><td> * @return The string stripped of ${ and }, or untouched if it does not match</td></tr><tr><th id="L2189"><a href="#L2189">2189</a></th><td> */</td></tr><tr><th id="L2190"><a href="#L2190">2190</a></th><td>Templater.prototype.stripBraces = function(str) {</td></tr><tr><th id="L2191"><a href="#L2191">2191</a></th><td>  if (!str.match(/\$\{.*\}/g)) {</td></tr><tr><th id="L2192"><a href="#L2192">2192</a></th><td>    this.handleError('Expected ' + str + ' to match ${...}');</td></tr><tr><th id="L2193"><a href="#L2193">2193</a></th><td>    return str;</td></tr><tr><th id="L2194"><a href="#L2194">2194</a></th><td>  }</td></tr><tr><th id="L2195"><a href="#L2195">2195</a></th><td>  return str.slice(2, -1);</td></tr><tr><th id="L2196"><a href="#L2196">2196</a></th><td>};</td></tr><tr><th id="L2197"><a href="#L2197">2197</a></th><td></td></tr><tr><th id="L2198"><a href="#L2198">2198</a></th><td>/**</td></tr><tr><th id="L2199"><a href="#L2199">2199</a></th><td> * Combined getter and setter that works with a path through some data set.</td></tr><tr><th id="L2200"><a href="#L2200">2200</a></th><td> * For example:</td></tr><tr><th id="L2201"><a href="#L2201">2201</a></th><td> * &lt;ul&gt;</td></tr><tr><th id="L2202"><a href="#L2202">2202</a></th><td> * &lt;li&gt;property('a.b', { a: { b: 99 }}); // returns 99</td></tr><tr><th id="L2203"><a href="#L2203">2203</a></th><td> * &lt;li&gt;property('a', { a: { b: 99 }}); // returns { b: 99 }</td></tr><tr><th id="L2204"><a href="#L2204">2204</a></th><td> * &lt;li&gt;property('a', { a: { b: 99 }}, 42); // returns 99 and alters the</td></tr><tr><th id="L2205"><a href="#L2205">2205</a></th><td> * input data to be { a: { b: 42 }}</td></tr><tr><th id="L2206"><a href="#L2206">2206</a></th><td> * &lt;/ul&gt;</td></tr><tr><th id="L2207"><a href="#L2207">2207</a></th><td> * @param path An array of strings indicating the path through the data, or</td></tr><tr><th id="L2208"><a href="#L2208">2208</a></th><td> * a string to be cut into an array using &lt;tt&gt;split('.')&lt;/tt&gt;</td></tr><tr><th id="L2209"><a href="#L2209">2209</a></th><td> * @param data An object to look in for the &lt;tt&gt;path&lt;/tt&gt; argument</td></tr><tr><th id="L2210"><a href="#L2210">2210</a></th><td> * @param newValue (optional) If defined, this value will replace the</td></tr><tr><th id="L2211"><a href="#L2211">2211</a></th><td> * original value for the data at the path specified.</td></tr><tr><th id="L2212"><a href="#L2212">2212</a></th><td> * @return The value pointed to by &lt;tt&gt;path&lt;/tt&gt; before any</td></tr><tr><th id="L2213"><a href="#L2213">2213</a></th><td> * &lt;tt&gt;newValue&lt;/tt&gt; is applied.</td></tr><tr><th id="L2214"><a href="#L2214">2214</a></th><td> */</td></tr><tr><th id="L2215"><a href="#L2215">2215</a></th><td>Templater.prototype.property = function(path, data, newValue) {</td></tr><tr><th id="L2216"><a href="#L2216">2216</a></th><td>  this.scope.push(path);</td></tr><tr><th id="L2217"><a href="#L2217">2217</a></th><td>  try {</td></tr><tr><th id="L2218"><a href="#L2218">2218</a></th><td>    if (typeof path === 'string') {</td></tr><tr><th id="L2219"><a href="#L2219">2219</a></th><td>      path = path.split('.');</td></tr><tr><th id="L2220"><a href="#L2220">2220</a></th><td>    }</td></tr><tr><th id="L2221"><a href="#L2221">2221</a></th><td>    var value = data[path[0]];</td></tr><tr><th id="L2222"><a href="#L2222">2222</a></th><td>    if (path.length === 1) {</td></tr><tr><th id="L2223"><a href="#L2223">2223</a></th><td>      if (newValue !== undefined) {</td></tr><tr><th id="L2224"><a href="#L2224">2224</a></th><td>        data[path[0]] = newValue;</td></tr><tr><th id="L2225"><a href="#L2225">2225</a></th><td>      }</td></tr><tr><th id="L2226"><a href="#L2226">2226</a></th><td>      if (typeof value === 'function') {</td></tr><tr><th id="L2227"><a href="#L2227">2227</a></th><td>        return function() {</td></tr><tr><th id="L2228"><a href="#L2228">2228</a></th><td>          return value.apply(data, arguments);</td></tr><tr><th id="L2229"><a href="#L2229">2229</a></th><td>        };</td></tr><tr><th id="L2230"><a href="#L2230">2230</a></th><td>      }</td></tr><tr><th id="L2231"><a href="#L2231">2231</a></th><td>      return value;</td></tr><tr><th id="L2232"><a href="#L2232">2232</a></th><td>    }</td></tr><tr><th id="L2233"><a href="#L2233">2233</a></th><td>    if (!value) {</td></tr><tr><th id="L2234"><a href="#L2234">2234</a></th><td>      this.handleError('Can\'t find path=' + path);</td></tr><tr><th id="L2235"><a href="#L2235">2235</a></th><td>      return null;</td></tr><tr><th id="L2236"><a href="#L2236">2236</a></th><td>    }</td></tr><tr><th id="L2237"><a href="#L2237">2237</a></th><td>    return this.property(path.slice(1), value, newValue);</td></tr><tr><th id="L2238"><a href="#L2238">2238</a></th><td>  } finally {</td></tr><tr><th id="L2239"><a href="#L2239">2239</a></th><td>    this.scope.pop();</td></tr><tr><th id="L2240"><a href="#L2240">2240</a></th><td>  }</td></tr><tr><th id="L2241"><a href="#L2241">2241</a></th><td>};</td></tr><tr><th id="L2242"><a href="#L2242">2242</a></th><td></td></tr><tr><th id="L2243"><a href="#L2243">2243</a></th><td>/**</td></tr><tr><th id="L2244"><a href="#L2244">2244</a></th><td> * Like eval, but that creates a context of the variables in &lt;tt&gt;env&lt;/tt&gt; in</td></tr><tr><th id="L2245"><a href="#L2245">2245</a></th><td> * which the script is evaluated.</td></tr><tr><th id="L2246"><a href="#L2246">2246</a></th><td> * WARNING: This script uses 'with' which is generally regarded to be evil.</td></tr><tr><th id="L2247"><a href="#L2247">2247</a></th><td> * The alternative is to create a Function at runtime that takes X parameters</td></tr><tr><th id="L2248"><a href="#L2248">2248</a></th><td> * according to the X keys in the env object, and then call that function using</td></tr><tr><th id="L2249"><a href="#L2249">2249</a></th><td> * the values in the env object. This is likely to be slow, but workable.</td></tr><tr><th id="L2250"><a href="#L2250">2250</a></th><td> * @param script The string to be evaluated.</td></tr><tr><th id="L2251"><a href="#L2251">2251</a></th><td> * @param env The environment in which to eval the script.</td></tr><tr><th id="L2252"><a href="#L2252">2252</a></th><td> * @param context Optional debugging string in case of failure</td></tr><tr><th id="L2253"><a href="#L2253">2253</a></th><td> * @return The return value of the script, or the error message if the script</td></tr><tr><th id="L2254"><a href="#L2254">2254</a></th><td> * execution failed.</td></tr><tr><th id="L2255"><a href="#L2255">2255</a></th><td> */</td></tr><tr><th id="L2256"><a href="#L2256">2256</a></th><td>Templater.prototype.envEval = function(script, env, context) {</td></tr><tr><th id="L2257"><a href="#L2257">2257</a></th><td>  with (env) {</td></tr><tr><th id="L2258"><a href="#L2258">2258</a></th><td>    try {</td></tr><tr><th id="L2259"><a href="#L2259">2259</a></th><td>      this.scope.push(context);</td></tr><tr><th id="L2260"><a href="#L2260">2260</a></th><td>      return eval(script);</td></tr><tr><th id="L2261"><a href="#L2261">2261</a></th><td>    } catch (ex) {</td></tr><tr><th id="L2262"><a href="#L2262">2262</a></th><td>      this.handleError('Template error evaluating \'' + script + '\'', ex);</td></tr><tr><th id="L2263"><a href="#L2263">2263</a></th><td>      return script;</td></tr><tr><th id="L2264"><a href="#L2264">2264</a></th><td>    } finally {</td></tr><tr><th id="L2265"><a href="#L2265">2265</a></th><td>      this.scope.pop();</td></tr><tr><th id="L2266"><a href="#L2266">2266</a></th><td>    }</td></tr><tr><th id="L2267"><a href="#L2267">2267</a></th><td>  }</td></tr><tr><th id="L2268"><a href="#L2268">2268</a></th><td>};</td></tr><tr><th id="L2269"><a href="#L2269">2269</a></th><td></td></tr><tr><th id="L2270"><a href="#L2270">2270</a></th><td>/**</td></tr><tr><th id="L2271"><a href="#L2271">2271</a></th><td> * A generic way of reporting errors, for easy overloading in different</td></tr><tr><th id="L2272"><a href="#L2272">2272</a></th><td> * environments.</td></tr><tr><th id="L2273"><a href="#L2273">2273</a></th><td> * @param message the error message to report.</td></tr><tr><th id="L2274"><a href="#L2274">2274</a></th><td> * @param ex optional associated exception.</td></tr><tr><th id="L2275"><a href="#L2275">2275</a></th><td> */</td></tr><tr><th id="L2276"><a href="#L2276">2276</a></th><td>Templater.prototype.handleError = function(message, ex) {</td></tr><tr><th id="L2277"><a href="#L2277">2277</a></th><td>  this.logError(message);</td></tr><tr><th id="L2278"><a href="#L2278">2278</a></th><td>  this.logError('In: ' + this.scope.join(' &gt; '));</td></tr><tr><th id="L2279"><a href="#L2279">2279</a></th><td>  if (ex) {</td></tr><tr><th id="L2280"><a href="#L2280">2280</a></th><td>    this.logError(ex);</td></tr><tr><th id="L2281"><a href="#L2281">2281</a></th><td>  }</td></tr><tr><th id="L2282"><a href="#L2282">2282</a></th><td>};</td></tr><tr><th id="L2283"><a href="#L2283">2283</a></th><td></td></tr><tr><th id="L2284"><a href="#L2284">2284</a></th><td></td></tr><tr><th id="L2285"><a href="#L2285">2285</a></th><td>/**</td></tr><tr><th id="L2286"><a href="#L2286">2286</a></th><td> * A generic way of reporting errors, for easy overloading in different</td></tr><tr><th id="L2287"><a href="#L2287">2287</a></th><td> * environments.</td></tr><tr><th id="L2288"><a href="#L2288">2288</a></th><td> * @param message the error message to report.</td></tr><tr><th id="L2289"><a href="#L2289">2289</a></th><td> */</td></tr><tr><th id="L2290"><a href="#L2290">2290</a></th><td>Templater.prototype.logError = function(message) {</td></tr><tr><th id="L2291"><a href="#L2291">2291</a></th><td>  window.console &amp;&amp; window.console.log &amp;&amp; console.log(message);</td></tr><tr><th id="L2292"><a href="#L2292">2292</a></th><td>};</td></tr><tr><th id="L2293"><a href="#L2293">2293</a></th><td></td></tr><tr><th id="L2294"><a href="#L2294">2294</a></th><td>exports.Templater = Templater;</td></tr><tr><th id="L2295"><a href="#L2295">2295</a></th><td></td></tr><tr><th id="L2296"><a href="#L2296">2296</a></th><td></td></tr><tr><th id="L2297"><a href="#L2297">2297</a></th><td>});</td></tr><tr><th id="L2298"><a href="#L2298">2298</a></th><td>/* ***** BEGIN LICENSE BLOCK *****</td></tr><tr><th id="L2299"><a href="#L2299">2299</a></th><td> * Version: MPL 1.1/GPL 2.0/LGPL 2.1</td></tr><tr><th id="L2300"><a href="#L2300">2300</a></th><td> *</td></tr><tr><th id="L2301"><a href="#L2301">2301</a></th><td> * The contents of this file are subject to the Mozilla Public License Version</td></tr><tr><th id="L2302"><a href="#L2302">2302</a></th><td> * 1.1 (the "License"); you may not use this file except in compliance with</td></tr><tr><th id="L2303"><a href="#L2303">2303</a></th><td> * the License. You may obtain a copy of the License at</td></tr><tr><th id="L2304"><a href="#L2304">2304</a></th><td> * http://www.mozilla.org/MPL/</td></tr><tr><th id="L2305"><a href="#L2305">2305</a></th><td> *</td></tr><tr><th id="L2306"><a href="#L2306">2306</a></th><td> * Software distributed under the License is distributed on an "AS IS" basis,</td></tr><tr><th id="L2307"><a href="#L2307">2307</a></th><td> * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</td></tr><tr><th id="L2308"><a href="#L2308">2308</a></th><td> * for the specific language governing rights and limitations under the</td></tr><tr><th id="L2309"><a href="#L2309">2309</a></th><td> * License.</td></tr><tr><th id="L2310"><a href="#L2310">2310</a></th><td> *</td></tr><tr><th id="L2311"><a href="#L2311">2311</a></th><td> * The Original Code is Skywriter.</td></tr><tr><th id="L2312"><a href="#L2312">2312</a></th><td> *</td></tr><tr><th id="L2313"><a href="#L2313">2313</a></th><td> * The Initial Developer of the Original Code is</td></tr><tr><th id="L2314"><a href="#L2314">2314</a></th><td> * Mozilla.</td></tr><tr><th id="L2315"><a href="#L2315">2315</a></th><td> * Portions created by the Initial Developer are Copyright (C) 2009</td></tr><tr><th id="L2316"><a href="#L2316">2316</a></th><td> * the Initial Developer. All Rights Reserved.</td></tr><tr><th id="L2317"><a href="#L2317">2317</a></th><td> *</td></tr><tr><th id="L2318"><a href="#L2318">2318</a></th><td> * Contributor(s):</td></tr><tr><th id="L2319"><a href="#L2319">2319</a></th><td> *   Skywriter Team (skywriter@mozilla.com)</td></tr><tr><th id="L2320"><a href="#L2320">2320</a></th><td> *</td></tr><tr><th id="L2321"><a href="#L2321">2321</a></th><td> * Alternatively, the contents of this file may be used under the terms of</td></tr><tr><th id="L2322"><a href="#L2322">2322</a></th><td> * either the GNU General Public License Version 2 or later (the "GPL"), or</td></tr><tr><th id="L2323"><a href="#L2323">2323</a></th><td> * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),</td></tr><tr><th id="L2324"><a href="#L2324">2324</a></th><td> * in which case the provisions of the GPL or the LGPL are applicable instead</td></tr><tr><th id="L2325"><a href="#L2325">2325</a></th><td> * of those above. If you wish to allow use of your version of this file only</td></tr><tr><th id="L2326"><a href="#L2326">2326</a></th><td> * under the terms of either the GPL or the LGPL, and not to allow others to</td></tr><tr><th id="L2327"><a href="#L2327">2327</a></th><td> * use your version of this file under the terms of the MPL, indicate your</td></tr><tr><th id="L2328"><a href="#L2328">2328</a></th><td> * decision by deleting the provisions above and replace them with the notice</td></tr><tr><th id="L2329"><a href="#L2329">2329</a></th><td> * and other provisions required by the GPL or the LGPL. If you do not delete</td></tr><tr><th id="L2330"><a href="#L2330">2330</a></th><td> * the provisions above, a recipient may use your version of this file under</td></tr><tr><th id="L2331"><a href="#L2331">2331</a></th><td> * the terms of any one of the MPL, the GPL or the LGPL.</td></tr><tr><th id="L2332"><a href="#L2332">2332</a></th><td> *</td></tr><tr><th id="L2333"><a href="#L2333">2333</a></th><td> * ***** END LICENSE BLOCK ***** */</td></tr><tr><th id="L2334"><a href="#L2334">2334</a></th><td></td></tr><tr><th id="L2335"><a href="#L2335">2335</a></th><td>define('cockpit/commands/basic', ['require', 'exports', 'module' , 'pilot/canon'], function(require, exports, module) {</td></tr><tr><th id="L2336"><a href="#L2336">2336</a></th><td></td></tr><tr><th id="L2337"><a href="#L2337">2337</a></th><td></td></tr><tr><th id="L2338"><a href="#L2338">2338</a></th><td>var canon = require('pilot/canon');</td></tr><tr><th id="L2339"><a href="#L2339">2339</a></th><td></td></tr><tr><th id="L2340"><a href="#L2340">2340</a></th><td>/**</td></tr><tr><th id="L2341"><a href="#L2341">2341</a></th><td> * '!' command</td></tr><tr><th id="L2342"><a href="#L2342">2342</a></th><td> */</td></tr><tr><th id="L2343"><a href="#L2343">2343</a></th><td>var bangCommandSpec = {</td></tr><tr><th id="L2344"><a href="#L2344">2344</a></th><td>    name: 'sh',</td></tr><tr><th id="L2345"><a href="#L2345">2345</a></th><td>    description: 'Execute a system command (requires server support)',</td></tr><tr><th id="L2346"><a href="#L2346">2346</a></th><td>    params: [</td></tr><tr><th id="L2347"><a href="#L2347">2347</a></th><td>        {</td></tr><tr><th id="L2348"><a href="#L2348">2348</a></th><td>            name: 'command',</td></tr><tr><th id="L2349"><a href="#L2349">2349</a></th><td>            type: 'text',</td></tr><tr><th id="L2350"><a href="#L2350">2350</a></th><td>            description: 'The string to send to the os shell.'</td></tr><tr><th id="L2351"><a href="#L2351">2351</a></th><td>        }</td></tr><tr><th id="L2352"><a href="#L2352">2352</a></th><td>    ],</td></tr><tr><th id="L2353"><a href="#L2353">2353</a></th><td>    exec: function(env, args, request) {</td></tr><tr><th id="L2354"><a href="#L2354">2354</a></th><td>        var req = new XMLHttpRequest();</td></tr><tr><th id="L2355"><a href="#L2355">2355</a></th><td>        req.open('GET', '/exec?args=' + args.command, true);</td></tr><tr><th id="L2356"><a href="#L2356">2356</a></th><td>        req.onreadystatechange = function(ev) {</td></tr><tr><th id="L2357"><a href="#L2357">2357</a></th><td>          if (req.readyState == 4) {</td></tr><tr><th id="L2358"><a href="#L2358">2358</a></th><td>            if (req.status == 200) {</td></tr><tr><th id="L2359"><a href="#L2359">2359</a></th><td>              request.done('&lt;pre&gt;' + req.responseText + '&lt;/pre&gt;');</td></tr><tr><th id="L2360"><a href="#L2360">2360</a></th><td>            }</td></tr><tr><th id="L2361"><a href="#L2361">2361</a></th><td>          }</td></tr><tr><th id="L2362"><a href="#L2362">2362</a></th><td>        };</td></tr><tr><th id="L2363"><a href="#L2363">2363</a></th><td>        req.send(null);</td></tr><tr><th id="L2364"><a href="#L2364">2364</a></th><td>    }</td></tr><tr><th id="L2365"><a href="#L2365">2365</a></th><td>};</td></tr><tr><th id="L2366"><a href="#L2366">2366</a></th><td></td></tr><tr><th id="L2367"><a href="#L2367">2367</a></th><td>var canon = require('pilot/canon');</td></tr><tr><th id="L2368"><a href="#L2368">2368</a></th><td></td></tr><tr><th id="L2369"><a href="#L2369">2369</a></th><td>exports.startup = function(data, reason) {</td></tr><tr><th id="L2370"><a href="#L2370">2370</a></th><td>    canon.addCommand(bangCommandSpec);</td></tr><tr><th id="L2371"><a href="#L2371">2371</a></th><td>};</td></tr><tr><th id="L2372"><a href="#L2372">2372</a></th><td></td></tr><tr><th id="L2373"><a href="#L2373">2373</a></th><td>exports.shutdown = function(data, reason) {</td></tr><tr><th id="L2374"><a href="#L2374">2374</a></th><td>    canon.removeCommand(bangCommandSpec);</td></tr><tr><th id="L2375"><a href="#L2375">2375</a></th><td>};</td></tr><tr><th id="L2376"><a href="#L2376">2376</a></th><td></td></tr><tr><th id="L2377"><a href="#L2377">2377</a></th><td></td></tr><tr><th id="L2378"><a href="#L2378">2378</a></th><td>});</td></tr><tr><th id="L2379"><a href="#L2379">2379</a></th><td>define("text!cockpit/ui/cli_view.css", [], "" +</td></tr><tr><th id="L2380"><a href="#L2380">2380</a></th><td>  "#cockpitInput { padding-left: 16px; }" +</td></tr><tr><th id="L2381"><a href="#L2381">2381</a></th><td>  "" +</td></tr><tr><th id="L2382"><a href="#L2382">2382</a></th><td>  ".cptOutput { overflow: auto; position: absolute; z-index: 999; display: none; }" +</td></tr><tr><th id="L2383"><a href="#L2383">2383</a></th><td>  "" +</td></tr><tr><th id="L2384"><a href="#L2384">2384</a></th><td>  ".cptCompletion { padding: 0; position: absolute; z-index: -1000; }" +</td></tr><tr><th id="L2385"><a href="#L2385">2385</a></th><td>  ".cptCompletion.VALID { background: #FFF; }" +</td></tr><tr><th id="L2386"><a href="#L2386">2386</a></th><td>  ".cptCompletion.INCOMPLETE { background: #DDD; }" +</td></tr><tr><th id="L2387"><a href="#L2387">2387</a></th><td>  ".cptCompletion.INVALID { background: #DDD; }" +</td></tr><tr><th id="L2388"><a href="#L2388">2388</a></th><td>  ".cptCompletion span { color: #FFF; }" +</td></tr><tr><th id="L2389"><a href="#L2389">2389</a></th><td>  ".cptCompletion span.INCOMPLETE { color: #DDD; border-bottom: 2px dotted #F80; }" +</td></tr><tr><th id="L2390"><a href="#L2390">2390</a></th><td>  ".cptCompletion span.INVALID { color: #DDD; border-bottom: 2px dotted #F00; }" +</td></tr><tr><th id="L2391"><a href="#L2391">2391</a></th><td>  "span.cptPrompt { color: #66F; font-weight: bold; }" +</td></tr><tr><th id="L2392"><a href="#L2392">2392</a></th><td>  "" +</td></tr><tr><th id="L2393"><a href="#L2393">2393</a></th><td>  "" +</td></tr><tr><th id="L2394"><a href="#L2394">2394</a></th><td>  ".cptHints {" +</td></tr><tr><th id="L2395"><a href="#L2395">2395</a></th><td>  "  color: #000;" +</td></tr><tr><th id="L2396"><a href="#L2396">2396</a></th><td>  "  position: absolute;" +</td></tr><tr><th id="L2397"><a href="#L2397">2397</a></th><td>  "  border: 1px solid rgba(230, 230, 230, 0.8);" +</td></tr><tr><th id="L2398"><a href="#L2398">2398</a></th><td>  "  background: rgba(250, 250, 250, 0.8);" +</td></tr><tr><th id="L2399"><a href="#L2399">2399</a></th><td>  "  -moz-border-radius-topleft: 10px;" +</td></tr><tr><th id="L2400"><a href="#L2400">2400</a></th><td>  "  -moz-border-radius-topright: 10px;" +</td></tr><tr><th id="L2401"><a href="#L2401">2401</a></th><td>  "  border-top-left-radius: 10px; border-top-right-radius: 10px;" +</td></tr><tr><th id="L2402"><a href="#L2402">2402</a></th><td>  "  z-index: 1000;" +</td></tr><tr><th id="L2403"><a href="#L2403">2403</a></th><td>  "  padding: 8px;" +</td></tr><tr><th id="L2404"><a href="#L2404">2404</a></th><td>  "  display: none;" +</td></tr><tr><th id="L2405"><a href="#L2405">2405</a></th><td>  "}" +</td></tr><tr><th id="L2406"><a href="#L2406">2406</a></th><td>  "" +</td></tr><tr><th id="L2407"><a href="#L2407">2407</a></th><td>  ".cptFocusPopup { display: block; }" +</td></tr><tr><th id="L2408"><a href="#L2408">2408</a></th><td>  ".cptFocusPopup.cptNoPopup { display: none; }" +</td></tr><tr><th id="L2409"><a href="#L2409">2409</a></th><td>  "" +</td></tr><tr><th id="L2410"><a href="#L2410">2410</a></th><td>  ".cptHints ul { margin: 0; padding: 0 15px; }" +</td></tr><tr><th id="L2411"><a href="#L2411">2411</a></th><td>  "" +</td></tr><tr><th id="L2412"><a href="#L2412">2412</a></th><td>  ".cptGt { font-weight: bold; font-size: 120%; }" +</td></tr><tr><th id="L2413"><a href="#L2413">2413</a></th><td>  "");</td></tr><tr><th id="L2414"><a href="#L2414">2414</a></th><td></td></tr><tr><th id="L2415"><a href="#L2415">2415</a></th><td>define("text!cockpit/ui/request_view.css", [], "" +</td></tr><tr><th id="L2416"><a href="#L2416">2416</a></th><td>  ".cptRowIn {" +</td></tr><tr><th id="L2417"><a href="#L2417">2417</a></th><td>  "  display: box; display: -moz-box; display: -webkit-box;" +</td></tr><tr><th id="L2418"><a href="#L2418">2418</a></th><td>  "  box-orient: horizontal; -moz-box-orient: horizontal; -webkit-box-orient: horizontal;" +</td></tr><tr><th id="L2419"><a href="#L2419">2419</a></th><td>  "  box-align: center; -moz-box-align: center; -webkit-box-align: center;" +</td></tr><tr><th id="L2420"><a href="#L2420">2420</a></th><td>  "  color: #333;" +</td></tr><tr><th id="L2421"><a href="#L2421">2421</a></th><td>  "  background-color: #EEE;" +</td></tr><tr><th id="L2422"><a href="#L2422">2422</a></th><td>  "  width: 100%;" +</td></tr><tr><th id="L2423"><a href="#L2423">2423</a></th><td>  "  font-family: consolas, courier, monospace;" +</td></tr><tr><th id="L2424"><a href="#L2424">2424</a></th><td>  "}" +</td></tr><tr><th id="L2425"><a href="#L2425">2425</a></th><td>  ".cptRowIn &gt; * { padding-left: 2px; padding-right: 2px; }" +</td></tr><tr><th id="L2426"><a href="#L2426">2426</a></th><td>  ".cptRowIn &gt; img { cursor: pointer; }" +</td></tr><tr><th id="L2427"><a href="#L2427">2427</a></th><td>  ".cptHover { display: none; }" +</td></tr><tr><th id="L2428"><a href="#L2428">2428</a></th><td>  ".cptRowIn:hover &gt; .cptHover { display: block; }" +</td></tr><tr><th id="L2429"><a href="#L2429">2429</a></th><td>  ".cptRowIn:hover &gt; .cptHover.cptHidden { display: none; }" +</td></tr><tr><th id="L2430"><a href="#L2430">2430</a></th><td>  ".cptOutTyped {" +</td></tr><tr><th id="L2431"><a href="#L2431">2431</a></th><td>  "  box-flex: 1; -moz-box-flex: 1; -webkit-box-flex: 1;" +</td></tr><tr><th id="L2432"><a href="#L2432">2432</a></th><td>  "  font-weight: bold; color: #000; font-size: 120%;" +</td></tr><tr><th id="L2433"><a href="#L2433">2433</a></th><td>  "}" +</td></tr><tr><th id="L2434"><a href="#L2434">2434</a></th><td>  ".cptRowOutput { padding-left: 10px; line-height: 1.2em; }" +</td></tr><tr><th id="L2435"><a href="#L2435">2435</a></th><td>  ".cptRowOutput strong," +</td></tr><tr><th id="L2436"><a href="#L2436">2436</a></th><td>  ".cptRowOutput b," +</td></tr><tr><th id="L2437"><a href="#L2437">2437</a></th><td>  ".cptRowOutput th," +</td></tr><tr><th id="L2438"><a href="#L2438">2438</a></th><td>  ".cptRowOutput h1," +</td></tr><tr><th id="L2439"><a href="#L2439">2439</a></th><td>  ".cptRowOutput h2," +</td></tr><tr><th id="L2440"><a href="#L2440">2440</a></th><td>  ".cptRowOutput h3 { color: #000; }" +</td></tr><tr><th id="L2441"><a href="#L2441">2441</a></th><td>  ".cptRowOutput a { font-weight: bold; color: #666; text-decoration: none; }" +</td></tr><tr><th id="L2442"><a href="#L2442">2442</a></th><td>  ".cptRowOutput a: hover { text-decoration: underline; cursor: pointer; }" +</td></tr><tr><th id="L2443"><a href="#L2443">2443</a></th><td>  ".cptRowOutput input[type=password]," +</td></tr><tr><th id="L2444"><a href="#L2444">2444</a></th><td>  ".cptRowOutput input[type=text]," +</td></tr><tr><th id="L2445"><a href="#L2445">2445</a></th><td>  ".cptRowOutput textarea {" +</td></tr><tr><th id="L2446"><a href="#L2446">2446</a></th><td>  "  color: #000; font-size: 120%;" +</td></tr><tr><th id="L2447"><a href="#L2447">2447</a></th><td>  "  background: transparent; padding: 3px;" +</td></tr><tr><th id="L2448"><a href="#L2448">2448</a></th><td>  "  border-radius: 5px; -moz-border-radius: 5px; -webkit-border-radius: 5px;" +</td></tr><tr><th id="L2449"><a href="#L2449">2449</a></th><td>  "}" +</td></tr><tr><th id="L2450"><a href="#L2450">2450</a></th><td>  ".cptRowOutput table," +</td></tr><tr><th id="L2451"><a href="#L2451">2451</a></th><td>  ".cptRowOutput td," +</td></tr><tr><th id="L2452"><a href="#L2452">2452</a></th><td>  ".cptRowOutput th { border: 0; padding: 0 2px; }" +</td></tr><tr><th id="L2453"><a href="#L2453">2453</a></th><td>  ".cptRowOutput .right { text-align: right; }" +</td></tr><tr><th id="L2454"><a href="#L2454">2454</a></th><td>  "");</td></tr><tr><th id="L2455"><a href="#L2455">2455</a></th><td></td></tr><tr><th id="L2456"><a href="#L2456">2456</a></th><td>define("text!cockpit/ui/request_view.html", [], "" +</td></tr><tr><th id="L2457"><a href="#L2457">2457</a></th><td>  "&lt;div class=cptRow&gt;" +</td></tr><tr><th id="L2458"><a href="#L2458">2458</a></th><td>  "  &lt;!-- The div for the input (i.e. what was typed) --&gt;" +</td></tr><tr><th id="L2459"><a href="#L2459">2459</a></th><td>  "  &lt;div class=\"cptRowIn\" save=\"${rowin}\"" +</td></tr><tr><th id="L2460"><a href="#L2460">2460</a></th><td>  "      onclick=\"${copyToInput}\"" +</td></tr><tr><th id="L2461"><a href="#L2461">2461</a></th><td>  "      ondblclick=\"${executeRequest}\"&gt;" +</td></tr><tr><th id="L2462"><a href="#L2462">2462</a></th><td>  "" +</td></tr><tr><th id="L2463"><a href="#L2463">2463</a></th><td>  "    &lt;!-- What the user actually typed --&gt;" +</td></tr><tr><th id="L2464"><a href="#L2464">2464</a></th><td>  "    &lt;div class=\"cptGt\"&gt;&amp;gt; &lt;/div&gt;" +</td></tr><tr><th id="L2465"><a href="#L2465">2465</a></th><td>  "    &lt;div class=\"cptOutTyped\"&gt;${request.typed}&lt;/div&gt;" +</td></tr><tr><th id="L2466"><a href="#L2466">2466</a></th><td>  "" +</td></tr><tr><th id="L2467"><a href="#L2467">2467</a></th><td>  "    &lt;!-- The extra details that appear on hover --&gt;" +</td></tr><tr><th id="L2468"><a href="#L2468">2468</a></th><td>  "    &lt;div class=cptHover save=\"${duration}\"&gt;&lt;/div&gt;" +</td></tr><tr><th id="L2469"><a href="#L2469">2469</a></th><td>  "    &lt;img class=cptHover onclick=\"${hideOutput}\" save=\"${hide}\"" +</td></tr><tr><th id="L2470"><a href="#L2470">2470</a></th><td>  "        alt=\"Hide command output\" _src=\"${imageUrl('images/minus.png')}\"/&gt;" +</td></tr><tr><th id="L2471"><a href="#L2471">2471</a></th><td>  "    &lt;img class=\"cptHover cptHidden\" onclick=\"${showOutput}\" save=\"${show}\"" +</td></tr><tr><th id="L2472"><a href="#L2472">2472</a></th><td>  "        alt=\"Show command output\" _src=\"${imageUrl('images/plus.png')}\"/&gt;" +</td></tr><tr><th id="L2473"><a href="#L2473">2473</a></th><td>  "    &lt;img class=cptHover onclick=\"${remove}\"" +</td></tr><tr><th id="L2474"><a href="#L2474">2474</a></th><td>  "        alt=\"Remove this command from the history\"" +</td></tr><tr><th id="L2475"><a href="#L2475">2475</a></th><td>  "        _src=\"${imageUrl('images/closer.png')}\"/&gt;" +</td></tr><tr><th id="L2476"><a href="#L2476">2476</a></th><td>  "" +</td></tr><tr><th id="L2477"><a href="#L2477">2477</a></th><td>  "  &lt;/div&gt;" +</td></tr><tr><th id="L2478"><a href="#L2478">2478</a></th><td>  "" +</td></tr><tr><th id="L2479"><a href="#L2479">2479</a></th><td>  "  &lt;!-- The div for the command output --&gt;" +</td></tr><tr><th id="L2480"><a href="#L2480">2480</a></th><td>  "  &lt;div class=\"cptRowOut\" save=\"${rowout}\"&gt;" +</td></tr><tr><th id="L2481"><a href="#L2481">2481</a></th><td>  "    &lt;div class=\"cptRowOutput\" save=\"${output}\"&gt;&lt;/div&gt;" +</td></tr><tr><th id="L2482"><a href="#L2482">2482</a></th><td>  "    &lt;img _src=\"${imageUrl('images/throbber.gif')}\" save=\"${throb}\"/&gt;" +</td></tr><tr><th id="L2483"><a href="#L2483">2483</a></th><td>  "  &lt;/div&gt;" +</td></tr><tr><th id="L2484"><a href="#L2484">2484</a></th><td>  "&lt;/div&gt;" +</td></tr><tr><th id="L2485"><a href="#L2485">2485</a></th><td>  "");</td></tr><tr><th id="L2486"><a href="#L2486">2486</a></th><td></td></tr><tr><th id="L2487"><a href="#L2487">2487</a></th><td>define("text!cockpit/ui/images/closer.png", [], "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAj9JREFUeNp0ks+LUlEUx7/vV1o8Z8wUx3IEHcQmiBiQlomjRNCiZpEuEqF/oEUwq/6EhvoHggmRcJUQBM1CRJAW0aLIaGQimZJxJsWxyV/P9/R1zzWlFl04vPvOPZ9z7rnnK5imidmKRCIq+zxgdoPZ1T/ut8xeM3tcKpW6s1hhBkaj0Qj7bDebTX+324WmadxvsVigqipcLleN/d4rFoulORiLxTZY8ItOp8MBCpYkiYPj8Xjus9vtlORWoVB4KcTjcQc732dLpSRXvCZaAws6Q4WDdqsO52kNH+oCRFGEz+f7ydwBKRgMPmTXi49GI1x2D/DsznesB06ws2eDbI7w9HYN6bVjvGss4KAjwDAMq81mM2SW5Wa/3weBbz42UL9uYnVpiO2Nr9ANHSGXib2Wgm9tCYIggGKJEVkvlwgi5/FQRmTLxO6hgJVzI1x0T/fJrBtHJxPeL6tI/fsZLA6ot8lkQi8HRVbw94gkWYI5MaHrOjcCGSNRxZosy9y5cErDzn0Dqx7gcwO8WtBp4PndI35GMYqiUMUvBL5yOBz8yRfFNpbPmqgcCFh/IuHa1nR/YXGM8+oUpFhihEQiwcdRLpfVRqOBtWXWq34Gra6AXq8Hp2piZcmKT4cKnE4nwuHwdByVSmWQz+d32WCTlHG/qaHHREN9kgi0sYQfv0R4PB4EAgESQDKXy72fSy6VSnHJVatVf71eR7vd5n66mtfrRSgU4pLLZrOlf7RKK51Ok8g3/yPyR5lMZi7y3wIMAME4EigHWgKnAAAAAElFTkSuQmCC");</td></tr><tr><th id="L2488"><a href="#L2488">2488</a></th><td></td></tr><tr><th id="L2489"><a href="#L2489">2489</a></th><td>define("text!cockpit/ui/images/dot_clear.gif", [], "data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAEBMgA7");</td></tr><tr><th id="L2490"><a href="#L2490">2490</a></th><td></td></tr><tr><th id="L2491"><a href="#L2491">2491</a></th><td>define("text!cockpit/ui/images/minus.png", [], "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAAZiS0dEANIA0gDS7KbF4AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kFGw4xMrIJw5EAAAHcSURBVCjPhZIxSxtxGMZ/976XhJA/RA5EAyJcFksnp64hjUPBoXRyCYLQTyD0UxScu0nFwalCQSgFCVk7dXAwUAiBDA2RO4W7yN1x9+9gcyhU+pteHt4H3pfncay1LOl0OgY4BN4Ar/7KP4BvwNFwOIyWu87S2O12O8DxfD73oygiSRIAarUaxhhWV1fHwMFgMBiWxl6v9y6Koi+3t7ckSUKtVkNVAcjzvNRWVlYwxry9vLz86uzs7HjAZDKZGGstjUaDfxHHMSLC5ubmHdB2VfVwNpuZ5clxHPMcRVFwc3PTXFtbO3RFZHexWJCmabnweAaoVqvlv4vFAhHZdVX1ZZqmOI5DURR8fz/lxbp9Yrz+7bD72SfPcwBU1XdF5N5aWy2KgqIoeBzPEnWVLMseYnAcRERdVR27rrsdxzGqyutP6898+GBsNBqo6i9XVS88z9sOggAR4X94noeqXoiIHPm+H9XrdYIgIAxDwjAkTVPCMESzBy3LMprNJr7v34nIkV5dXd2fn59fG2P2siwjSRIqlQrWWlSVJFcqlQqtVot2u40xZu/s7OxnWbl+v98BjkejkT+dTgmCoDxtY2ODra2tMXBweno6fNJVgP39fQN8eKbkH09OTsqS/wHFRdHPfTSfjwAAAABJRU5ErkJggg==");</td></tr><tr><th id="L2492"><a href="#L2492">2492</a></th><td></td></tr><tr><th id="L2493"><a href="#L2493">2493</a></th><td>define("text!cockpit/ui/images/pinaction.png", [], "data:image/png;base64,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");</td></tr><tr><th id="L2494"><a href="#L2494">2494</a></th><td></td></tr><tr><th id="L2495"><a href="#L2495">2495</a></th><td>define("text!cockpit/ui/images/pinin.png", [], "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAC7mlDQ1BJQ0MgUHJvZmlsZQAAeAGFVM9rE0EU/jZuqdAiCFprDrJ4kCJJWatoRdQ2/RFiawzbH7ZFkGQzSdZuNuvuJrWliOTi0SreRe2hB/+AHnrwZC9KhVpFKN6rKGKhFy3xzW5MtqXqwM5+8943731vdt8ADXLSNPWABOQNx1KiEWlsfEJq/IgAjqIJQTQlVdvsTiQGQYNz+Xvn2HoPgVtWw3v7d7J3rZrStpoHhP1A4Eea2Sqw7xdxClkSAog836Epx3QI3+PY8uyPOU55eMG1Dys9xFkifEA1Lc5/TbhTzSXTQINIOJT1cVI+nNeLlNcdB2luZsbIEL1PkKa7zO6rYqGcTvYOkL2d9H5Os94+wiHCCxmtP0a4jZ71jNU/4mHhpObEhj0cGDX0+GAVtxqp+DXCFF8QTSeiVHHZLg3xmK79VvJKgnCQOMpkYYBzWkhP10xu+LqHBX0m1xOv4ndWUeF5jxNn3tTd70XaAq8wDh0MGgyaDUhQEEUEYZiwUECGPBoxNLJyPyOrBhuTezJ1JGq7dGJEsUF7Ntw9t1Gk3Tz+KCJxlEO1CJL8Qf4qr8lP5Xn5y1yw2Fb3lK2bmrry4DvF5Zm5Gh7X08jjc01efJXUdpNXR5aseXq8muwaP+xXlzHmgjWPxHOw+/EtX5XMlymMFMXjVfPqS4R1WjE3359sfzs94i7PLrXWc62JizdWm5dn/WpI++6qvJPmVflPXvXx/GfNxGPiKTEmdornIYmXxS7xkthLqwviYG3HCJ2VhinSbZH6JNVgYJq89S9dP1t4vUZ/DPVRlBnM0lSJ93/CKmQ0nbkOb/qP28f8F+T3iuefKAIvbODImbptU3HvEKFlpW5zrgIXv9F98LZua6N+OPwEWDyrFq1SNZ8gvAEcdod6HugpmNOWls05Uocsn5O66cpiUsxQ20NSUtcl12VLFrOZVWLpdtiZ0x1uHKE5QvfEp0plk/qv8RGw/bBS+fmsUtl+ThrWgZf6b8C8/UXAeIuJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZ0lEQVQ4Ea2TPUsDQRCGZ89Eo4FACkULEQs1CH4Uamfjn7GxEYJFIFXgChFsbPwzNnZioREkaiHBQtEiEEiMRm/dZ8OEGAxR4sBxx877Pju7M2estTJIxLrNuVwuMxQEx0ZkzcFHyRtjXt02559RtB2GYanTYzoryOfz+6l4Nbszf2niwffKmpGRo9sVW22mDgqFwp5C2gDMm+P32a3JB1N+n5JifUGeP9JeNxGryPLYjcwMP8rJ07Q9fZltQzyAstOJ2vVu5sKc1ZZkRBrOcKeb+HexPidvkpCN5JUcllZtpZFc5DgBWc5M2eysZuMuofMBSA4NWjx4PUCsXefMlI0QY3ewRg4NWi4ZTQsgrjYXema+e4VqtEMK6KXvu+4B9Bklt90vVKMeD2BI6DOt4rZ/Gk7WyKFBi4fNPIAJY0joM61SCCZ9tI1o0OIB8D+DBIkYaJRbCBH9mZgNt+bb++ufSSF/eX8BYcDeAzuQJVUAAAAASUVORK5CYII=");</td></tr><tr><th id="L2496"><a href="#L2496">2496</a></th><td></td></tr><tr><th id="L2497"><a href="#L2497">2497</a></th><td>define("text!cockpit/ui/images/pinout.png", [], "data:image/png;base64,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");</td></tr><tr><th id="L2498"><a href="#L2498">2498</a></th><td></td></tr><tr><th id="L2499"><a href="#L2499">2499</a></th><td>define("text!cockpit/ui/images/pins.png", [], "data:image/png;base64,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");</td></tr><tr><th id="L2500"><a href="#L2500">2500</a></th><td></td></tr><tr><th id="L2501"><a href="#L2501">2501</a></th><td>define("text!cockpit/ui/images/plus.png", [], "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAAZiS0dEANIA0gDS7KbF4AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kFGw4yFTwuJTkAAAH7SURBVCjPdZKxa1NRFMZ/956XZMgFyyMlCZRA4hBx6lBcQ00GoYi4tEstFPwLAs7iLDi7FWuHThaUggihBDI5OWRoQAmBQFISQgvvpbwX3rsOaR4K+o2H8zvfOZxPWWtZqVarGaAJPAEe3ZW/A1+Bd+1221v1qhW4vb1dA44mk0nZ8zyCIAAgk8lgjGF9fb0PHF5cXLQTsF6vP/c879P19TVBEJDJZBARAKIoSmpra2sYY561Wq3PqtFouMBgMBgYay3ZbJZ/yfd9tNaUSqUboOKISPPq6sqsVvZ9H4AvL34B8PTj/QSO45jpdHovn883Ha31znw+JwzDpCEMQx4UloM8zyOdTif3zudztNY7jog8DMMQpRRxHPPt5TCBAEZvxlyOFTsfykRRBICIlB2t9a21Nh3HMXEc8+d7VhJHWCwWyzcohdZaHBHpO46z6fs+IsLj94XECaD4unCHL8FsNouI/HRE5Nx13c3ZbIbWOnG5HKtl+53TSq7rIiLnand31wUGnU7HjEYjlFLJZN/3yRnL1FMYY8jlcmxtbd0AFel2u7dnZ2eXxpi9xWJBEASkUimstYgIQSSkUimKxSKVSgVjzN7p6emPJHL7+/s14KjX65WHwyGz2SxZbWNjg2q12gcOT05O2n9lFeDg4MAAr/4T8rfHx8dJyH8DvvbYGzKvWukAAAAASUVORK5CYII=");</td></tr><tr><th id="L2502"><a href="#L2502">2502</a></th><td></td></tr><tr><th id="L2503"><a href="#L2503">2503</a></th><td>define("text!cockpit/ui/images/throbber.gif", [], "data:image/gif;base64,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");</td></tr><tr><th id="L2504"><a href="#L2504">2504</a></th><td></td></tr></tbody></table>
      </div>
      <div id="help">
        <strong>Note:</strong> See <a href="/wiki/TracBrowser">TracBrowser</a>
        for help on using the browser.
      </div>
      <div id="anydiff">
        <form action="/diff" method="get">
          <div class="buttons">
            <input type="hidden" name="new_path" value="/seattle/trunk/repy/apps/tryrepy/web/js/ace/cockpit-uncompressed.js" />
            <input type="hidden" name="old_path" value="/seattle/trunk/repy/apps/tryrepy/web/js/ace/cockpit-uncompressed.js" />
            <input type="hidden" name="new_rev" />
            <input type="hidden" name="old_rev" />
            <input type="submit" value="View changes..." title="Select paths and revs for Diff" />
          </div>
        </form>
      </div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/browser/seattle/trunk/repy/apps/tryrepy/web/js/ace/cockpit-uncompressed.js?format=txt">Plain Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/export/7591/seattle/trunk/repy/apps/tryrepy/web/js/ace/cockpit-uncompressed.js">Original Format</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">
        Powered by <a href="/about"><strong>Trac 0.11.6</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.
      </p>
      <p class="right"><p><table><tr><td>This material is based upon work supported by the National Science Foundation under Grant No.s (0834243, 1205415, and 1223588). Any opinions, findings, and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of GPO Technologies, Corp., the GENI Project Office, or the National Science Foundation.</td></tr></table> </p></p>
    </div>
  
<!-- Google Analytics Widget Code -->
<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    jQuery(document).ready( function() {
      var pageTracker = _gat._getTracker("UA-6429088-1");
      jQuery('a').each( function() {
        var url;
        if ( this.href.match("http:\/\/seattle.poly.edu") ) {
          if ( this.href.match(/\.(zip|tar|tar.gz|tar.bzip|py|repy|txt)$/) ) {
            url = this.pathname + this.search;
          };
        } else {
          var port = '';
          if ( this.port != '') port = ':'+this.port;
          url = '/external/' + this.hostname + port + this.pathname + this.search;
        };
        if ( url ) {
          if ( ! url.match('^\/attachment\/') ) {
            jQuery(this).click( function() {
              pageTracker._trackPageview(url);
            });
          };
        };
      });
    pageTracker._trackPageview();
    });
  } catch(err) {}
</script>
<!-- Google Analytics Widget Code Ended -->
</body>
</html>